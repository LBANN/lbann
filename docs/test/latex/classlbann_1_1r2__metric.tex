\hypertarget{classlbann_1_1r2__metric}{}\section{lbann\+:\+:r2\+\_\+metric Class Reference}
\label{classlbann_1_1r2__metric}\index{lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}}


{\ttfamily \#include $<$r2.\+hpp$>$}



Inheritance diagram for lbann\+:\+:r2\+\_\+metric\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=168pt]{classlbann_1_1r2__metric__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for lbann\+:\+:r2\+\_\+metric\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1r2__metric__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classlbann_1_1r2__metric_a9c6bffbb4724c77a8e6f8b1a2e7b27c7}{r2\+\_\+metric} (\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm})
\item 
\hyperlink{classlbann_1_1r2__metric_a42a125bad0a3ba5e6b229d89b893d3e6}{r2\+\_\+metric} (const \hyperlink{classlbann_1_1r2__metric}{r2\+\_\+metric} \&other)=default
\item 
\hyperlink{classlbann_1_1r2__metric}{r2\+\_\+metric} \& \hyperlink{classlbann_1_1r2__metric_a83078b4784031fc91f7f145cf22e5571}{operator=} (const \hyperlink{classlbann_1_1r2__metric}{r2\+\_\+metric} \&other)=default
\item 
virtual \hyperlink{classlbann_1_1r2__metric_a9f2d864400bc44be329f7caf6d98cf01}{$\sim$r2\+\_\+metric} ()=default
\item 
\hyperlink{classlbann_1_1r2__metric}{r2\+\_\+metric} $\ast$ \hyperlink{classlbann_1_1r2__metric_a2536209f1d575b639ab351854d54f207}{copy} () const override
\item 
std\+::string \hyperlink{classlbann_1_1r2__metric_a66f9280c69b9b079d40b70b9c9c43ad9}{name} () const override
\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type} \hyperlink{classlbann_1_1r2__metric_a06c84d7944d1d5be896de6b98950e05e}{evaluate\+\_\+compute} (const \hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat} \&prediction, const \hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat} \&ground\+\_\+truth) override
\end{DoxyCompactItemize}


\subsection{Detailed Description}
R$^\wedge$2 (coefficient of determination) regression metric. 

Definition at line 36 of file r2.\+hpp.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classlbann_1_1r2__metric_a9c6bffbb4724c77a8e6f8b1a2e7b27c7}\label{classlbann_1_1r2__metric_a9c6bffbb4724c77a8e6f8b1a2e7b27c7}} 
\index{lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}!r2\+\_\+metric@{r2\+\_\+metric}}
\index{r2\+\_\+metric@{r2\+\_\+metric}!lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}}
\subsubsection{\texorpdfstring{r2\+\_\+metric()}{r2\_metric()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily lbann\+::r2\+\_\+metric\+::r2\+\_\+metric (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$}]{comm }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}

Constructor. 

Definition at line 41 of file r2.\+hpp.


\begin{DoxyCode}
41 : \hyperlink{classlbann_1_1metric_a3cd2d4f7dcbf94f70b3b8560a3171d9d}{metric}(\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}) \{\}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1r2__metric_a9c6bffbb4724c77a8e6f8b1a2e7b27c7_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=333pt]{classlbann_1_1r2__metric_a9c6bffbb4724c77a8e6f8b1a2e7b27c7_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1r2__metric_a42a125bad0a3ba5e6b229d89b893d3e6}\label{classlbann_1_1r2__metric_a42a125bad0a3ba5e6b229d89b893d3e6}} 
\index{lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}!r2\+\_\+metric@{r2\+\_\+metric}}
\index{r2\+\_\+metric@{r2\+\_\+metric}!lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}}
\subsubsection{\texorpdfstring{r2\+\_\+metric()}{r2\_metric()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily lbann\+::r2\+\_\+metric\+::r2\+\_\+metric (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1r2__metric}{r2\+\_\+metric} \&}]{other }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [default]}}

Copy constructor. \mbox{\Hypertarget{classlbann_1_1r2__metric_a9f2d864400bc44be329f7caf6d98cf01}\label{classlbann_1_1r2__metric_a9f2d864400bc44be329f7caf6d98cf01}} 
\index{lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}!````~r2\+\_\+metric@{$\sim$r2\+\_\+metric}}
\index{````~r2\+\_\+metric@{$\sim$r2\+\_\+metric}!lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}}
\subsubsection{\texorpdfstring{$\sim$r2\+\_\+metric()}{~r2\_metric()}}
{\footnotesize\ttfamily virtual lbann\+::r2\+\_\+metric\+::$\sim$r2\+\_\+metric (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}, {\ttfamily [default]}}

Destructor. Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1r2__metric_a9f2d864400bc44be329f7caf6d98cf01_icgraph}
\end{center}
\end{figure}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classlbann_1_1r2__metric_a2536209f1d575b639ab351854d54f207}\label{classlbann_1_1r2__metric_a2536209f1d575b639ab351854d54f207}} 
\index{lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}!copy@{copy}}
\index{copy@{copy}!lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}}
\subsubsection{\texorpdfstring{copy()}{copy()}}
{\footnotesize\ttfamily \hyperlink{classlbann_1_1r2__metric}{r2\+\_\+metric}$\ast$ lbann\+::r2\+\_\+metric\+::copy (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Copy function. 

Implements \hyperlink{classlbann_1_1metric_a2a4498d41f77da8585552f485caab167}{lbann\+::metric}.



Definition at line 50 of file r2.\+hpp.


\begin{DoxyCode}
50                                    \{
51     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \hyperlink{classlbann_1_1r2__metric_a9c6bffbb4724c77a8e6f8b1a2e7b27c7}{r2\_metric}(*\textcolor{keyword}{this});
52   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1r2__metric_a2536209f1d575b639ab351854d54f207_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1r2__metric_a06c84d7944d1d5be896de6b98950e05e}\label{classlbann_1_1r2__metric_a06c84d7944d1d5be896de6b98950e05e}} 
\index{lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}!evaluate\+\_\+compute@{evaluate\+\_\+compute}}
\index{evaluate\+\_\+compute@{evaluate\+\_\+compute}!lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}}
\subsubsection{\texorpdfstring{evaluate\+\_\+compute()}{evaluate\_compute()}}
{\footnotesize\ttfamily \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type} lbann\+::r2\+\_\+metric\+::evaluate\+\_\+compute (\begin{DoxyParamCaption}\item[{const \hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat} \&}]{prediction,  }\item[{const \hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat} \&}]{ground\+\_\+truth }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [protected]}, {\ttfamily [virtual]}}

Computation to evaluate the metric function. numerator = Sum(Square(ground\+\_\+truth -\/ prediction) denominator = Sum(Square(ground\+\_\+truth -\/ Mean(ground\+\_\+truth))) return (1 -\/ numerator/(denominator + epsilon)) 

Implements \hyperlink{classlbann_1_1metric_aab79147ff480675db2e01d7a889a4296}{lbann\+::metric}.



Definition at line 32 of file r2.\+cpp.


\begin{DoxyCode}
33                                                                                      \{
34 
35   \textcolor{comment}{// Get matrix dimensions}
36   \textcolor{keyword}{const} \textcolor{keywordtype}{int} local\_height = \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8ac41b9ec75e920b610e8907e066074b30}{prediction}.LocalHeight();
37   \textcolor{keyword}{const} \textcolor{keywordtype}{int} local\_width = \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8ac41b9ec75e920b610e8907e066074b30}{prediction}.LocalWidth();
38   \textcolor{keyword}{const} \textcolor{keywordtype}{int} width = \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8ac41b9ec75e920b610e8907e066074b30}{prediction}.Width();
39   
40   \textcolor{comment}{// Get local matrices}
41   \textcolor{keyword}{const} \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat}& prediction\_local = \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8ac41b9ec75e920b610e8907e066074b30}{prediction}.LockedMatrix();
42   \textcolor{keyword}{const} \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat}& ground\_truth\_local = ground\_truth.LockedMatrix();
43 
44   DataType gt\_mean, gt\_std;
45   \textcolor{comment}{// Entry-wise mean of ground truth}
46   \textcolor{comment}{//@todo fix stat class not to compute stdev if not needed }
47   \hyperlink{namespacelbann_a604ae9da0173b8be2bfb6877997d6d5c}{entrywise\_mean\_and\_stdev}(ground\_truth, gt\_mean, gt\_std);
48 
49   \textcolor{comment}{// Compute residual sum of squares ss\_res}
50   \textcolor{comment}{// and sum of squares ss\_tot as sum(square(ground\_truth - mean(ground\_truth)))}
51   \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType} ss\_res = 0;
52   \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType} ss\_tot = 0;
53 \textcolor{preprocessor}{  #pragma omp parallel for reduction(+:ss\_res,ss\_tot) collapse(2)}
54   \textcolor{keywordflow}{for}(El::Int col = 0; col < local\_width; ++col) \{
55     \textcolor{keywordflow}{for}(El::Int row = 0; row < local\_height; ++row) \{
56       \textcolor{keyword}{const} \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType} true\_val = ground\_truth\_local(row, col);
57       \textcolor{keyword}{const} \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType} pred\_val = prediction\_local(row, col);
58       \textcolor{keyword}{const} \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType} val1 = true\_val - pred\_val;
59       \textcolor{keyword}{const} \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType} val2 = true\_val - gt\_mean;
60       ss\_res += val1 * val1;
61       ss\_tot += val2 * val2;
62     \}
63   \}
64 
65   \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType} res\_tot[2] = \{ss\_res, ss\_tot\};  \textcolor{comment}{// Pack to do one allreduce.}
66   El::mpi::AllReduce(res\_tot, 2, \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8ac41b9ec75e920b610e8907e066074b30}{prediction}.DistComm());
67   \textcolor{comment}{//Keras and TF add epsilon (1e-07) to denominator to avoid inf score}
68   \textcolor{comment}{//We might actually need to do this here and other places too}
69   \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType} ss\_tot\_eps = res\_tot[1] + 0.0000001;
70   \textcolor{comment}{//Multiply by width because base class divide by mini-batch size}
71   \textcolor{keywordflow}{return} ((1-(res\_tot[0]/ss\_tot\_eps))*width); 
72 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1r2__metric_a06c84d7944d1d5be896de6b98950e05e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1r2__metric_a06c84d7944d1d5be896de6b98950e05e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1r2__metric_a66f9280c69b9b079d40b70b9c9c43ad9}\label{classlbann_1_1r2__metric_a66f9280c69b9b079d40b70b9c9c43ad9}} 
\index{lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}!name@{name}}
\index{name@{name}!lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}}
\subsubsection{\texorpdfstring{name()}{name()}}
{\footnotesize\ttfamily std\+::string lbann\+::r2\+\_\+metric\+::name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Return a string name for this metric. 

Implements \hyperlink{classlbann_1_1metric_af455d7b6874d3491bc04f0f2ebfcab51}{lbann\+::metric}.



Definition at line 55 of file r2.\+hpp.


\begin{DoxyCode}
55 \{ \textcolor{keywordflow}{return} \textcolor{stringliteral}{"r2"}; \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1r2__metric_a66f9280c69b9b079d40b70b9c9c43ad9_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1r2__metric_a83078b4784031fc91f7f145cf22e5571}\label{classlbann_1_1r2__metric_a83078b4784031fc91f7f145cf22e5571}} 
\index{lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}!operator=@{operator=}}
\index{operator=@{operator=}!lbann\+::r2\+\_\+metric@{lbann\+::r2\+\_\+metric}}
\subsubsection{\texorpdfstring{operator=()}{operator=()}}
{\footnotesize\ttfamily \hyperlink{classlbann_1_1r2__metric}{r2\+\_\+metric}\& lbann\+::r2\+\_\+metric\+::operator= (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1r2__metric}{r2\+\_\+metric} \&}]{other }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [default]}}

Copy assignment operator. Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1r2__metric_a83078b4784031fc91f7f145cf22e5571_icgraph}
\end{center}
\end{figure}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/include/lbann/metrics/\hyperlink{r2_8hpp}{r2.\+hpp}\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/src/metrics/\hyperlink{r2_8cpp}{r2.\+cpp}\end{DoxyCompactItemize}
