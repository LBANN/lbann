\hypertarget{init__image__data__readers_8cpp}{}\section{/\+Users/mckinney27/doxy-\/testbed/lbann/src/proto/init\+\_\+image\+\_\+data\+\_\+readers.cpp File Reference}
\label{init__image__data__readers_8cpp}\index{/\+Users/mckinney27/doxy-\/testbed/lbann/src/proto/init\+\_\+image\+\_\+data\+\_\+readers.\+cpp@{/\+Users/mckinney27/doxy-\/testbed/lbann/src/proto/init\+\_\+image\+\_\+data\+\_\+readers.\+cpp}}
{\ttfamily \#include \char`\"{}lbann/proto/init\+\_\+image\+\_\+data\+\_\+readers.\+hpp\char`\"{}}\newline
{\ttfamily \#include $<$google/protobuf/io/coded\+\_\+stream.\+h$>$}\newline
{\ttfamily \#include $<$google/protobuf/io/zero\+\_\+copy\+\_\+stream\+\_\+impl.\+h$>$}\newline
{\ttfamily \#include $<$google/protobuf/text\+\_\+format.\+h$>$}\newline
{\ttfamily \#include $<$memory$>$}\newline
Include dependency graph for init\+\_\+image\+\_\+data\+\_\+readers.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{init__image__data__readers_8cpp__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{init__image__data__readers_8cpp_a12164f699122209432c4f8ae7505683d}{init\+\_\+image\+\_\+preprocessor} (const lbann\+\_\+data\+::\+Reader \&pb\+\_\+readme, const bool master, std\+::shared\+\_\+ptr$<$ cv\+\_\+process $>$ \&pp, int \&width, int \&height, int \&channels)
\item 
void \hyperlink{init__image__data__readers_8cpp_afbbec9e8aa0c25aac424999eae6c39df}{init\+\_\+image\+\_\+data\+\_\+reader} (const lbann\+\_\+data\+::\+Reader \&pb\+\_\+readme, const bool master, \hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$\&reader)
\item 
void \hyperlink{init__image__data__readers_8cpp_a0e66a70e8fd1805c0a7433d359f73b85}{init\+\_\+generic\+\_\+preprocessor} (const lbann\+\_\+data\+::\+Reader \&pb\+\_\+readme, const bool master, \hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$reader)
\item 
void \hyperlink{init__image__data__readers_8cpp_a671d9d841466d2bf6ee67336e7d45cd6}{init\+\_\+org\+\_\+image\+\_\+data\+\_\+reader} (const lbann\+\_\+data\+::\+Reader \&pb\+\_\+readme, const bool master, \hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$\&reader)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{init__image__data__readers_8cpp_a0e66a70e8fd1805c0a7433d359f73b85}\label{init__image__data__readers_8cpp_a0e66a70e8fd1805c0a7433d359f73b85}} 
\index{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp@{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp}!init\+\_\+generic\+\_\+preprocessor@{init\+\_\+generic\+\_\+preprocessor}}
\index{init\+\_\+generic\+\_\+preprocessor@{init\+\_\+generic\+\_\+preprocessor}!init\+\_\+image\+\_\+data\+\_\+readers.\+cpp@{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp}}
\subsubsection{\texorpdfstring{init\+\_\+generic\+\_\+preprocessor()}{init\_generic\_preprocessor()}}
{\footnotesize\ttfamily void init\+\_\+generic\+\_\+preprocessor (\begin{DoxyParamCaption}\item[{const lbann\+\_\+data\+::\+Reader \&}]{pb\+\_\+readme,  }\item[{const bool}]{master,  }\item[{\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$}]{reader }\end{DoxyParamCaption})}



Definition at line 334 of file init\+\_\+image\+\_\+data\+\_\+readers.\+cpp.


\begin{DoxyCode}
334                                                                                                            
             \{
335   \textcolor{keywordflow}{if} (!pb\_readme.has\_image\_preprocessor()) \textcolor{keywordflow}{return};
336 
337   \textcolor{keyword}{const} lbann\_data::ImagePreprocessor& pb\_preprocessor = pb\_readme.image\_preprocessor();
338   \textcolor{keywordflow}{if} (pb\_preprocessor.disable()) \textcolor{keywordflow}{return};
339 
340   \textcolor{comment}{// set up augmenter if necessary}
341   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_augmenter()) \{
342     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Augmenter& pb\_augmenter = pb\_preprocessor.augmenter();
343     \textcolor{keywordflow}{if} (!pb\_augmenter.disable() &&
344         (pb\_augmenter.name() == \textcolor{stringliteral}{""}) &&
345         (pb\_augmenter.horizontal\_flip() ||
346          pb\_augmenter.vertical\_flip() ||
347          pb\_augmenter.rotation() != 0.0 ||
348          pb\_augmenter.horizontal\_shift() != 0.0 ||
349          pb\_augmenter.vertical\_shift() != 0.0 ||
350          pb\_augmenter.shear\_range() != 0.0))
351     \{
352       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a4ba2de0a781dfa0a2652ad4d777a241f}{horizontal\_flip}( pb\_augmenter.horizontal\_flip() );
353       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_aeb7d75e4d3361ae2836afabc14510d74}{vertical\_flip}( pb\_augmenter.vertical\_flip() );
354       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a1a293733368dd9eceba3e99cf9e5ae24}{rotation}( pb\_augmenter.rotation() );
355       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_ae62596b4af5d1940aa0499cde2bdd005}{horizontal\_shift}( pb\_augmenter.horizontal\_shift() );
356       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a50ac63e1f6b1b9806cbf6c06f53f4aca}{vertical\_shift}( pb\_augmenter.vertical\_shift() );
357       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_aef1e2375fd518e69df800b0dcbcb37d0}{shear\_range}( pb\_augmenter.shear\_range() );
358       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: augmenter is set"} << std::endl;
359     \} \textcolor{keywordflow}{else} \{
360       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a871cb543ee6c132a76e16045a1a2a9f3}{disable\_augmentation}();
361     \}
362   \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{// For backward compatibility. TODO: will be deprecated}
363     \textcolor{keywordflow}{if} (!pb\_preprocessor.disable\_augmentation() &&
364         (pb\_preprocessor.horizontal\_flip() ||
365          pb\_preprocessor.vertical\_flip() ||
366          pb\_preprocessor.rotation() != 0.0 ||
367          pb\_preprocessor.horizontal\_shift() != 0.0 ||
368          pb\_preprocessor.vertical\_shift() != 0.0 ||
369          pb\_preprocessor.shear\_range() != 0.0)) \{
370       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a4ba2de0a781dfa0a2652ad4d777a241f}{horizontal\_flip}( pb\_preprocessor.horizontal\_flip() );
371       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_aeb7d75e4d3361ae2836afabc14510d74}{vertical\_flip}( pb\_preprocessor.vertical\_flip() );
372       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a1a293733368dd9eceba3e99cf9e5ae24}{rotation}( pb\_preprocessor.rotation() );
373       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_ae62596b4af5d1940aa0499cde2bdd005}{horizontal\_shift}( pb\_preprocessor.horizontal\_shift() );
374       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a50ac63e1f6b1b9806cbf6c06f53f4aca}{vertical\_shift}( pb\_preprocessor.vertical\_shift() );
375       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_aef1e2375fd518e69df800b0dcbcb37d0}{shear\_range}( pb\_preprocessor.shear\_range() );
376       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: deprecated syntax for augmenter"} << std::endl;
377     \}
378   \}
379 
380   \textcolor{comment}{// set up the normalizer}
381   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_normalizer()) \{
382     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Normalizer& pb\_normalizer = pb\_preprocessor.normalizer();
383     \textcolor{keywordflow}{if} (!pb\_normalizer.disable() &&
384         (pb\_normalizer.name() == \textcolor{stringliteral}{""})) \{
385       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_afa470b696ba435c20050187a0232717d}{subtract\_mean}( pb\_normalizer.subtract\_mean() );
386       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a05c4cb5cb842df5d46eebe15c6ea9de3}{unit\_variance}( pb\_normalizer.unit\_variance() );
387       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a977b2fdd417acb1eb37dbea0cfdd4b60}{scale}( pb\_normalizer.scale() );
388       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a02cfd4d8c26a317540b587eb52cef0d5}{z\_score}( pb\_normalizer.z\_score() );
389       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: normalizer is set"} << std::endl;
390     \}
391   \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{// For backward compatibility. TODO: will be deprecated}
392       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_afa470b696ba435c20050187a0232717d}{subtract\_mean}( pb\_preprocessor.subtract\_mean() );
393       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a05c4cb5cb842df5d46eebe15c6ea9de3}{unit\_variance}( pb\_preprocessor.unit\_variance() );
394       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a977b2fdd417acb1eb37dbea0cfdd4b60}{scale}( pb\_preprocessor.scale() );
395       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a02cfd4d8c26a317540b587eb52cef0d5}{z\_score}( pb\_preprocessor.z\_score() );
396       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: deprecated syntax for normalizer"} << std::endl;
397   \}
398 
399   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_noiser()) \{
400     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Noiser& pb\_noiser = pb\_preprocessor.noiser();
401     \textcolor{keywordflow}{if} (!pb\_noiser.disable() &&
402         (pb\_noiser.name() == \textcolor{stringliteral}{""})) \{
403       reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a1726baf71e931108dc9192539e90c583}{add\_noise}( pb\_noiser.factor() );
404       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: noiser is set"} << std::endl;
405     \}
406   \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{// For backward compatibility. TODO: will be deprecated}
407     reader->\hyperlink{classlbann_1_1lbann__image__preprocessor_a1726baf71e931108dc9192539e90c583}{add\_noise}( pb\_preprocessor.noise\_factor() );
408     \textcolor{keywordflow}{if} (master && (pb\_preprocessor.noise\_factor()>0.0)) std::cout << \textcolor{stringliteral}{"image processor: deprecated syntax
       for noiser"} << std::endl;
409   \}
410 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{init__image__data__readers_8cpp_a0e66a70e8fd1805c0a7433d359f73b85_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{init__image__data__readers_8cpp_a0e66a70e8fd1805c0a7433d359f73b85_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{init__image__data__readers_8cpp_afbbec9e8aa0c25aac424999eae6c39df}\label{init__image__data__readers_8cpp_afbbec9e8aa0c25aac424999eae6c39df}} 
\index{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp@{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp}!init\+\_\+image\+\_\+data\+\_\+reader@{init\+\_\+image\+\_\+data\+\_\+reader}}
\index{init\+\_\+image\+\_\+data\+\_\+reader@{init\+\_\+image\+\_\+data\+\_\+reader}!init\+\_\+image\+\_\+data\+\_\+readers.\+cpp@{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp}}
\subsubsection{\texorpdfstring{init\+\_\+image\+\_\+data\+\_\+reader()}{init\_image\_data\_reader()}}
{\footnotesize\ttfamily void init\+\_\+image\+\_\+data\+\_\+reader (\begin{DoxyParamCaption}\item[{const lbann\+\_\+data\+::\+Reader \&}]{pb\+\_\+readme,  }\item[{const bool}]{master,  }\item[{\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$\&}]{reader }\end{DoxyParamCaption})}



Definition at line 263 of file init\+\_\+image\+\_\+data\+\_\+readers.\+cpp.


\begin{DoxyCode}
263                                                                                                            
           \{
264   \textcolor{comment}{// data reader name}
265   \textcolor{keyword}{const} std::string& name = pb\_readme.name();
266   \textcolor{comment}{// whether to shuffle data}
267   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} shuffle = pb\_readme.shuffle();
268   \textcolor{comment}{// number of labels}
269   \textcolor{keyword}{const} \textcolor{keywordtype}{int} n\_labels = pb\_readme.num\_labels();
270 
271   std::shared\_ptr<cv\_process> pp;
272   \textcolor{comment}{// set up the image preprocessor}
273   \textcolor{keywordflow}{if} ((name == \textcolor{stringliteral}{"imagenet"}) || (name == \textcolor{stringliteral}{"imagenet\_single"}) ||
274       (name == \textcolor{stringliteral}{"triplet"}) || (name == \textcolor{stringliteral}{"mnist\_siamese"}) || (name == \textcolor{stringliteral}{"multi\_images"})) \{
275     pp = std::make\_shared<cv\_process>();
276   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"imagenet\_patches"}) \{
277     pp = std::make\_shared<cv\_process\_patches>();
278   \} \textcolor{keywordflow}{else} \{
279     \textcolor{keywordflow}{if} (master) \{
280       std::stringstream err;
281       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" :: unknown name for image data reader: "}
282           << name;
283       \textcolor{keywordflow}{throw} \hyperlink{classlbann_1_1lbann__exception}{lbann\_exception}(err.str());
284     \}
285   \}
286 
287   \textcolor{comment}{// final size of image}
288   \textcolor{keywordtype}{int} width = 0, height = 0;
289   \textcolor{keywordtype}{int} channels = 3;
290 
291   \textcolor{comment}{// setup preprocessor}
292   \hyperlink{init__image__data__readers_8cpp_a12164f699122209432c4f8ae7505683d}{init\_image\_preprocessor}(pb\_readme, master, pp, width, height, channels);
293 
294   \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"imagenet\_patches"}) \{
295     std::shared\_ptr<cv\_process\_patches> ppp = std::dynamic\_pointer\_cast<cv\_process\_patches>(pp);
296     reader = \textcolor{keyword}{new} \hyperlink{classlbann_1_1imagenet__reader__patches}{imagenet\_reader\_patches}(ppp, shuffle);
297   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"imagenet"}) \{
298     reader = \textcolor{keyword}{new} \hyperlink{classlbann_1_1imagenet__reader}{imagenet\_reader}(pp, shuffle);
299   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"triplet"}) \{
300     reader = \textcolor{keyword}{new} \hyperlink{classlbann_1_1data__reader__triplet}{data\_reader\_triplet}(pp, shuffle);
301   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"mnist\_siamese"}) \{
302     reader = \textcolor{keyword}{new} \hyperlink{classlbann_1_1data__reader__mnist__siamese}{data\_reader\_mnist\_siamese}(pp, shuffle);
303   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"multi\_images"}) \{
304     reader = \textcolor{keyword}{new} \hyperlink{classlbann_1_1data__reader__multi__images}{data\_reader\_multi\_images}(pp, shuffle);
305   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"imagenet\_single"}) \{ \textcolor{comment}{// imagenet\_single}
306     reader = \textcolor{keyword}{new} \hyperlink{classlbann_1_1imagenet__reader__single}{imagenet\_reader\_single}(pp, shuffle);
307   \}
308 
309   \textcolor{keyword}{auto}* image\_data\_reader\_ptr = \textcolor{keyword}{dynamic\_cast<}\hyperlink{classlbann_1_1image__data__reader}{image\_data\_reader}*\textcolor{keyword}{>}(reader);
310   \textcolor{keywordflow}{if} (!image\_data\_reader\_ptr && master) \{
311     std::stringstream err;
312     err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" :: invalid image data reader pointer"};
313     \textcolor{keywordflow}{throw} \hyperlink{classlbann_1_1lbann__exception}{lbann\_exception}(err.str());
314   \}
315   \textcolor{keywordflow}{if} (master) std::cout << reader->\hyperlink{classlbann_1_1generic__data__reader_abeb849fb8e10b4fa317c90bc33f61758}{get\_type}() << \textcolor{stringliteral}{" is set"} << std::endl;
316 
317   \textcolor{comment}{// configure the data reader}
318   \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"multi\_images"}) \{
319     \textcolor{keyword}{const} \textcolor{keywordtype}{int} n\_img\_srcs = pb\_readme.num\_image\_srcs();
320     \hyperlink{classlbann_1_1data__reader__multi__images}{data\_reader\_multi\_images}* multi\_image\_dr\_ptr
321       = \textcolor{keyword}{dynamic\_cast<}\hyperlink{classlbann_1_1data__reader__multi__images}{data\_reader\_multi\_images}*\textcolor{keyword}{>}(image\_data\_reader\_ptr);
322     \textcolor{keywordflow}{if} (multi\_image\_dr\_ptr == \textcolor{keyword}{nullptr}) \{
323       std::stringstream err;
324       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" no data\_reader\_multi\_images"};
325       \textcolor{keywordflow}{throw} \hyperlink{classlbann_1_1lbann__exception}{lbann\_exception}(err.str());
326     \}
327     multi\_image\_dr\_ptr->\hyperlink{classlbann_1_1data__reader__multi__images_a57824ec9de5c1131b2f15a0cb3d4ab75}{set\_input\_params}(width, height, channels, n\_labels, n\_img\_srcs);
328   \} \textcolor{keywordflow}{else} \{
329     image\_data\_reader\_ptr->set\_input\_params(width, height, channels, n\_labels);
330   \}
331 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{init__image__data__readers_8cpp_afbbec9e8aa0c25aac424999eae6c39df_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=330pt]{init__image__data__readers_8cpp_afbbec9e8aa0c25aac424999eae6c39df_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{init__image__data__readers_8cpp_a12164f699122209432c4f8ae7505683d}\label{init__image__data__readers_8cpp_a12164f699122209432c4f8ae7505683d}} 
\index{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp@{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp}!init\+\_\+image\+\_\+preprocessor@{init\+\_\+image\+\_\+preprocessor}}
\index{init\+\_\+image\+\_\+preprocessor@{init\+\_\+image\+\_\+preprocessor}!init\+\_\+image\+\_\+data\+\_\+readers.\+cpp@{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp}}
\subsubsection{\texorpdfstring{init\+\_\+image\+\_\+preprocessor()}{init\_image\_preprocessor()}}
{\footnotesize\ttfamily void init\+\_\+image\+\_\+preprocessor (\begin{DoxyParamCaption}\item[{const lbann\+\_\+data\+::\+Reader \&}]{pb\+\_\+readme,  }\item[{const bool}]{master,  }\item[{std\+::shared\+\_\+ptr$<$ cv\+\_\+process $>$ \&}]{pp,  }\item[{int \&}]{width,  }\item[{int \&}]{height,  }\item[{int \&}]{channels }\end{DoxyParamCaption})}



Definition at line 37 of file init\+\_\+image\+\_\+data\+\_\+readers.\+cpp.


\begin{DoxyCode}
38                                                                                                     \{
39 \textcolor{comment}{// Currently we set width and height for image\_data\_reader here considering the transform}
40 \textcolor{comment}{// pipeline. image\_data\_reader reports the final dimension of data to the child layer based}
41 \textcolor{comment}{// on these information.}
42 \textcolor{comment}{// TODO: However, for composible pipeline, this needs to be automatically determined by each}
43 \textcolor{comment}{// cv\_process at the setup finalization stage.}
44   \textcolor{keywordflow}{if} (!pb\_readme.has\_image\_preprocessor()) \textcolor{keywordflow}{return};
45 
46   \textcolor{keyword}{const} lbann\_data::ImagePreprocessor& pb\_preprocessor = pb\_readme.image\_preprocessor();
47   \textcolor{keywordflow}{if} (pb\_preprocessor.disable()) \textcolor{keywordflow}{return};
48 
49   \textcolor{comment}{// data reader name}
50   \textcolor{keyword}{const} std::string& name = pb\_readme.name();
51   \textcolor{comment}{// final size of image}
52   width = pb\_preprocessor.raw\_width();
53   height = pb\_preprocessor.raw\_height();
54 
55   \textcolor{comment}{// set up a subtractor}
56   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_subtractor()) \{
57     \textcolor{keywordflow}{if} (pb\_preprocessor.has\_colorizer()) \{
58       \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Colorizer& pb\_colorizer = pb\_preprocessor.colorizer();
59       \textcolor{keywordflow}{if}  (!pb\_colorizer.disable()) \{
60         \textcolor{keyword}{const} std::string colorizer\_name = ((pb\_colorizer.name() == \textcolor{stringliteral}{""})? \textcolor{stringliteral}{"default\_colorizer"} : pb\_colorizer
      .name());
61         \textcolor{comment}{// If every image in the dataset is a color image, this is not needed}
62         std::unique\_ptr<lbann::cv\_colorizer> colorizer(\textcolor{keyword}{new}(lbann::cv\_colorizer));
63         colorizer->set\_name(colorizer\_name);
64         pp->add\_transform(std::move(colorizer));
65         channels = 3;
66         \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: "} << colorizer\_name << \textcolor{stringliteral}{" colorizer is set"} << std::endl;
67       \}
68     \}
69     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Subtractor& pb\_subtractor = pb\_preprocessor.subtractor();
70     \textcolor{keywordflow}{if}  (!pb\_subtractor.disable()) \{
71       \textcolor{keyword}{const} std::string subtractor\_name = ((pb\_subtractor.name() == \textcolor{stringliteral}{""})? \textcolor{stringliteral}{"default\_subtractor"} : 
      pb\_subtractor.name());
72       \textcolor{comment}{// If every image in the dataset is a color image, this is not needed}
73       std::unique\_ptr<lbann::cv\_subtractor> subtractor(\textcolor{keyword}{new}(lbann::cv\_subtractor));
74       subtractor->set\_name(subtractor\_name);
75       subtractor->set(pb\_subtractor.image\_to\_sub());
76       pp->add\_normalizer(std::move(subtractor));
77       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: "} << subtractor\_name << \textcolor{stringliteral}{" subtractor is set"} << std::endl;
78     \}
79   \}
80 
81   \textcolor{comment}{// set up a cropper}
82   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_cropper()) \{
83     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Cropper& pb\_cropper = pb\_preprocessor.cropper();
84     \textcolor{keywordflow}{if} (!pb\_cropper.disable()) \{
85       \textcolor{keyword}{const} std::string cropper\_name = ((pb\_cropper.name() == \textcolor{stringliteral}{""})? \textcolor{stringliteral}{"default\_cropper"} : pb\_cropper.name());
86       std::unique\_ptr<lbann::cv\_cropper> cropper(\textcolor{keyword}{new}(lbann::cv\_cropper));
87       cropper->set\_name(cropper\_name);
88       cropper->set(pb\_cropper.crop\_width(),
89                    pb\_cropper.crop\_height(),
90                    pb\_cropper.crop\_randomly(),
91                    std::make\_pair<int,int>(pb\_cropper.resized\_width(),
92                                            pb\_cropper.resized\_height()),
93                    pb\_cropper.adaptive\_interpolation());
94       pp->add\_transform(std::move(cropper));
95       width = pb\_cropper.crop\_width();
96       height = pb\_cropper.crop\_height();
97       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: "} << cropper\_name << \textcolor{stringliteral}{" cropper is set"} << std::endl;
98     \}
99   \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{// For backward compatibility. TODO: will be deprecated}
100     \textcolor{keywordflow}{if}(pb\_preprocessor.crop\_first()) \{
101       std::unique\_ptr<lbann::cv\_cropper> cropper(\textcolor{keyword}{new}(lbann::cv\_cropper));
102       cropper->set(pb\_preprocessor.crop\_width(),
103                    pb\_preprocessor.crop\_height(),
104                    pb\_preprocessor.crop\_randomly(),
105                    std::make\_pair<int,int>(pb\_preprocessor.resized\_width(),
106                                            pb\_preprocessor.resized\_height()),
107                    pb\_preprocessor.adaptive\_interpolation());
108       pp->add\_transform(std::move(cropper));
109       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: cropper is set (deprecated syntax)"} << std::endl;
110     \}
111   \}
112 
113   \textcolor{comment}{// set up an augmenter}
114   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_augmenter()) \{
115     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Augmenter& pb\_augmenter = pb\_preprocessor.augmenter();
116     \textcolor{keywordflow}{if} (!pb\_augmenter.disable() &&
117         (pb\_augmenter.horizontal\_flip() ||
118          pb\_augmenter.vertical\_flip() ||
119          pb\_augmenter.rotation() != 0.0 ||
120          pb\_augmenter.horizontal\_shift() != 0.0 ||
121          pb\_augmenter.vertical\_shift() != 0.0 ||
122          pb\_augmenter.shear\_range() != 0.0))
123     \{
124       \textcolor{keyword}{const} std::string augmenter\_name = ((pb\_augmenter.name() == \textcolor{stringliteral}{""})? \textcolor{stringliteral}{"default\_augmenter"} : pb\_augmenter.
      name());
125       std::unique\_ptr<lbann::cv\_augmenter> augmenter(\textcolor{keyword}{new}(lbann::cv\_augmenter));
126       augmenter->set\_name(augmenter\_name);
127       augmenter->set(pb\_augmenter.horizontal\_flip(),
128                      pb\_augmenter.vertical\_flip(),
129                      pb\_augmenter.rotation(),
130                      pb\_augmenter.horizontal\_shift(),
131                      pb\_augmenter.vertical\_shift(),
132                      pb\_augmenter.shear\_range());
133       pp->add\_transform(std::move(augmenter));
134       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: "} << augmenter\_name << \textcolor{stringliteral}{" augmenter is set"} << std::endl;
135     \}
136   \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{// For backward compatibility. TODO: will be deprecated}
137     \textcolor{keywordflow}{if} (!pb\_preprocessor.disable\_augmentation()) \{
138       std::unique\_ptr<lbann::cv\_augmenter> augmenter(\textcolor{keyword}{new}(lbann::cv\_augmenter));
139       augmenter->set(pb\_preprocessor.horizontal\_flip(),
140                    pb\_preprocessor.vertical\_flip(),
141                    pb\_preprocessor.rotation(),
142                    pb\_preprocessor.horizontal\_shift(),
143                    pb\_preprocessor.vertical\_shift(),
144                    pb\_preprocessor.shear\_range());
145       pp->add\_transform(std::move(augmenter));
146       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: augmenter is set (deprecated syntax)"} << std::endl;
147     \}
148   \}
149 
150   \textcolor{comment}{// set up a decolorizer}
151   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_decolorizer()) \{
152     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Decolorizer& pb\_decolorizer = pb\_preprocessor.decolorizer();
153     \textcolor{keywordflow}{if}  (!pb\_decolorizer.disable()) \{
154       \textcolor{keyword}{const} std::string decolorizer\_name = ((pb\_decolorizer.name() == \textcolor{stringliteral}{""})? \textcolor{stringliteral}{"default\_decolorizer"} : 
      pb\_decolorizer.name());
155       \textcolor{comment}{// If every image in the dataset is a color image, this is not needed}
156       std::unique\_ptr<lbann::cv\_decolorizer> decolorizer(\textcolor{keyword}{new}(lbann::cv\_decolorizer));
157       decolorizer->set\_name(decolorizer\_name);
158       decolorizer->set(pb\_decolorizer.pick\_1ch());
159       pp->add\_transform(std::move(decolorizer));
160       channels = 1;
161       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: "} << decolorizer\_name << \textcolor{stringliteral}{" decolorizer is set"} << 
      std::endl;
162     \}
163   \}
164 
165   \textcolor{comment}{// set up a colorizer}
166   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_colorizer()) \{
167     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Colorizer& pb\_colorizer = pb\_preprocessor.colorizer();
168     \textcolor{keywordflow}{if}  (!pb\_colorizer.disable()) \{
169      \textcolor{keywordflow}{if} (!pb\_preprocessor.has\_subtractor()) \{
170       \textcolor{keyword}{const} std::string colorizer\_name = ((pb\_colorizer.name() == \textcolor{stringliteral}{""})? \textcolor{stringliteral}{"default\_colorizer"} : pb\_colorizer.
      name());
171       \textcolor{comment}{// If every image in the dataset is a color image, this is not needed}
172       std::unique\_ptr<lbann::cv\_colorizer> colorizer(\textcolor{keyword}{new}(lbann::cv\_colorizer));
173       colorizer->set\_name(colorizer\_name);
174       pp->add\_transform(std::move(colorizer));
175       channels = 3;
176       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: "} << colorizer\_name << \textcolor{stringliteral}{" colorizer is set"} << std::endl;
177      \}
178     \}
179   \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{// For backward compatibility. TODO: will be deprecated}
180     \textcolor{keywordflow}{if} (!pb\_preprocessor.no\_colorize()) \{
181       std::unique\_ptr<lbann::cv\_colorizer> colorizer(\textcolor{keyword}{new}(lbann::cv\_colorizer));
182       pp->add\_transform(std::move(colorizer));
183       channels = 3;
184       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: colorizer is set (deprecated syntax)"} << std::endl;
185     \}
186   \}
187 
188   \textcolor{comment}{// set up a normalizer}
189   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_normalizer()) \{
190     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Normalizer& pb\_normalizer = pb\_preprocessor.normalizer();
191     \textcolor{keywordflow}{if} (!pb\_normalizer.disable()) \{
192       \textcolor{keyword}{const} std::string normalizer\_name = ((pb\_normalizer.name() == \textcolor{stringliteral}{""})? \textcolor{stringliteral}{"default\_normalizer"} : 
      pb\_normalizer.name());
193       std::unique\_ptr<lbann::cv\_normalizer> normalizer(\textcolor{keyword}{new}(lbann::cv\_normalizer));
194       normalizer->set\_name(normalizer\_name);
195       normalizer->unit\_scale(pb\_normalizer.scale());
196       normalizer->subtract\_mean(pb\_normalizer.subtract\_mean());
197       normalizer->unit\_variance(pb\_normalizer.unit\_variance());
198       normalizer->z\_score(pb\_normalizer.z\_score());
199       pp->add\_normalizer(std::move(normalizer));
200       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: "} << normalizer\_name << \textcolor{stringliteral}{" normalizer is set"} << std::endl;
201     \}
202   \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{// For backward compatibility. TODO: will be deprecated}
203     std::unique\_ptr<lbann::cv\_normalizer> normalizer(\textcolor{keyword}{new}(lbann::cv\_normalizer));
204     normalizer->unit\_scale(pb\_preprocessor.scale());
205     normalizer->subtract\_mean(pb\_preprocessor.subtract\_mean());
206     normalizer->unit\_variance(pb\_preprocessor.unit\_variance());
207     normalizer->z\_score(pb\_preprocessor.z\_score());
208     pp->add\_normalizer(std::move(normalizer));
209     \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: normalizer is set (deprecated syntax)"} << std::endl;
210   \}
211 
212   \textcolor{comment}{// set up a noiser}
213   \textcolor{keywordflow}{if} (pb\_preprocessor.has\_noiser()) \{
214     \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::Noiser& pb\_noiser = pb\_preprocessor.noiser();
215     \textcolor{keywordflow}{if} (!pb\_noiser.disable()) \{
216       \textcolor{keyword}{const} std::string noiser\_name = ((pb\_noiser.name() == \textcolor{stringliteral}{""})? \textcolor{stringliteral}{"default\_noiser"} : pb\_noiser.name());
217 \textcolor{comment}{/* TODO: implement noiser in opencv}
218 \textcolor{comment}{      std::unique\_ptr<lbann::cv\_noiser> noiser(new(lbann::cv\_noiser));}
219 \textcolor{comment}{      noiser->set\_name(noiser\_name);}
220 \textcolor{comment}{      noiser->set(pb\_noiser.factor());}
221 \textcolor{comment}{      pp->add\_transform(std::move(noiser));}
222 \textcolor{comment}{*/}
223       \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: "} << noiser\_name << \textcolor{stringliteral}{" noiser is not supported yet"} << 
      std::endl;
224     \}
225   \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{// For backward compatibility. TODO: will be deprecated}
226 \textcolor{comment}{/* TODO: implement noiser in opencv}
227 \textcolor{comment}{    std::unique\_ptr<lbann::cv\_noiser> noiser(new(lbann::cv\_noiser));}
228 \textcolor{comment}{    noiser->set(pb\_preprocessor.noise\_factor());}
229 \textcolor{comment}{    pp->add\_transform(std::move(noiser));}
230 \textcolor{comment}{*/}
231     \textcolor{keywordflow}{if} (master && (pb\_preprocessor.noise\_factor() > 0.0))
232         std::cout << \textcolor{stringliteral}{"image processor: noiser is not supported yet (deprecated syntax)"} << std::endl;
233   \}
234 
235   \textcolor{comment}{// create a data reader}
236   \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"imagenet\_patches"}) \{
237     std::shared\_ptr<cv\_process\_patches> ppp = std::dynamic\_pointer\_cast<cv\_process\_patches>(pp);
238     \textcolor{keywordflow}{if} (pb\_preprocessor.has\_patch\_extractor()) \{
239       \textcolor{keyword}{const} lbann\_data::ImagePreprocessor::PatchExtractor& pb\_patch\_extractor = pb\_preprocessor.
      patch\_extractor();
240       \textcolor{keywordflow}{if} (!pb\_patch\_extractor.disable()) \{
241         \textcolor{keyword}{const} std::string patch\_extractor\_name = ((pb\_patch\_extractor.name() == \textcolor{stringliteral}{""})? \textcolor{stringliteral}{"
      default\_patch\_extractor"} : pb\_patch\_extractor.name());
242         lbann::patchworks::patch\_descriptor \hyperlink{namespaceanonymous__namespace_02image__preprocessor_8cpp_03_a9624405339d16214b745f28f39979c6d}{pi};
243         pi.set\_sample\_image(static\_cast<unsigned int>(width),
244                             static\_cast<unsigned int>(height));
245         pi.set\_size(pb\_patch\_extractor.patch\_width(), pb\_patch\_extractor.patch\_height());
246         pi.set\_gap(pb\_patch\_extractor.patch\_gap());
247         pi.set\_jitter(pb\_patch\_extractor.patch\_jitter());
248         pi.set\_mode\_centering(pb\_patch\_extractor.centering\_mode());
249         pi.set\_mode\_chromatic\_aberration(pb\_patch\_extractor.ca\_correction\_mode());
250         pi.set\_self\_label();
251         pi.define\_patch\_set();
252         width = pb\_patch\_extractor.patch\_width();
253         height = pb\_patch\_extractor.patch\_height();
254         ppp->set\_name(patch\_extractor\_name);
255         ppp->set\_patch\_descriptor(pi);
256         \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"image processor: "} << patch\_extractor\_name << \textcolor{stringliteral}{" patch\_extractor is set"} <
      < std::endl;
257       \}
258     \}
259   \}
260 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{init__image__data__readers_8cpp_a12164f699122209432c4f8ae7505683d_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{init__image__data__readers_8cpp_a671d9d841466d2bf6ee67336e7d45cd6}\label{init__image__data__readers_8cpp_a671d9d841466d2bf6ee67336e7d45cd6}} 
\index{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp@{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp}!init\+\_\+org\+\_\+image\+\_\+data\+\_\+reader@{init\+\_\+org\+\_\+image\+\_\+data\+\_\+reader}}
\index{init\+\_\+org\+\_\+image\+\_\+data\+\_\+reader@{init\+\_\+org\+\_\+image\+\_\+data\+\_\+reader}!init\+\_\+image\+\_\+data\+\_\+readers.\+cpp@{init\+\_\+image\+\_\+data\+\_\+readers.\+cpp}}
\subsubsection{\texorpdfstring{init\+\_\+org\+\_\+image\+\_\+data\+\_\+reader()}{init\_org\_image\_data\_reader()}}
{\footnotesize\ttfamily void init\+\_\+org\+\_\+image\+\_\+data\+\_\+reader (\begin{DoxyParamCaption}\item[{const lbann\+\_\+data\+::\+Reader \&}]{pb\+\_\+readme,  }\item[{const bool}]{master,  }\item[{\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$\&}]{reader }\end{DoxyParamCaption})}



Definition at line 413 of file init\+\_\+image\+\_\+data\+\_\+readers.\+cpp.


\begin{DoxyCode}
413                                                                                                            
               \{
414   \textcolor{keyword}{const} lbann\_data::ImagePreprocessor& pb\_preprocessor = pb\_readme.image\_preprocessor();
415 
416   \textcolor{comment}{// data reader name}
417   \textcolor{keyword}{const} std::string& name = pb\_readme.name();
418   \textcolor{comment}{// whether to shuffle data}
419   \textcolor{keyword}{const} \textcolor{keywordtype}{bool} shuffle = pb\_readme.shuffle();
420   \textcolor{comment}{// final size of image. If image\_preprocessor is not set, the type-default value}
421   \textcolor{comment}{// (i,e., 0) is used. Then,set\_input\_params() will not modify the current member value.}
422   \textcolor{keyword}{const} \textcolor{keywordtype}{int} width = pb\_preprocessor.raw\_width();
423   \textcolor{keyword}{const} \textcolor{keywordtype}{int} height = pb\_preprocessor.raw\_height();
424 
425   \textcolor{comment}{// number of labels}
426   \textcolor{keyword}{const} \textcolor{keywordtype}{int} n\_labels = pb\_readme.num\_labels();
427 
428   \textcolor{comment}{// TODO: as imagenet\_org phases out, and mnist and cifar10 convert to use new}
429   \textcolor{comment}{// imagenet data reader, this function will disappear}
430   \textcolor{comment}{// create data reader}
431   \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"imagenet\_org"}) \{
432     reader = \textcolor{keyword}{new} \hyperlink{classlbann_1_1imagenet__reader__org}{imagenet\_reader\_org}(shuffle);
433     \textcolor{keyword}{dynamic\_cast<}\hyperlink{classlbann_1_1imagenet__reader__org}{imagenet\_reader\_org}*\textcolor{keyword}{>}(reader)->set\_input\_params(width, height, 3, 
      n\_labels);
434     \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"imagenet\_reader\_org is set"} << std::endl;
435   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"mnist"}) \{
436     reader = \textcolor{keyword}{new} \hyperlink{classlbann_1_1mnist__reader}{mnist\_reader}(shuffle);
437     \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"mnist\_reader is set"} << std::endl;
438   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"cifar10"}) \{
439     reader = \textcolor{keyword}{new} \hyperlink{classlbann_1_1cifar10__reader}{cifar10\_reader}(shuffle);
440     \textcolor{keywordflow}{if} (master) std::cout << \textcolor{stringliteral}{"cifar10\_reader is set"} << std::endl;
441   \} \textcolor{keywordflow}{else} \{
442     \textcolor{keywordflow}{if} (master) \{
443       std::stringstream err;
444       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" :: unknown name for image data reader: "}
445           << name;
446       \textcolor{keywordflow}{throw} \hyperlink{classlbann_1_1lbann__exception}{lbann\_exception}(err.str());
447     \}
448   \}
449 
450   \textcolor{comment}{// setup preprocessor}
451   \hyperlink{init__image__data__readers_8cpp_a0e66a70e8fd1805c0a7433d359f73b85}{init\_generic\_preprocessor}(pb\_readme, master, reader);
452 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{init__image__data__readers_8cpp_a671d9d841466d2bf6ee67336e7d45cd6_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=316pt]{init__image__data__readers_8cpp_a671d9d841466d2bf6ee67336e7d45cd6_icgraph}
\end{center}
\end{figure}
