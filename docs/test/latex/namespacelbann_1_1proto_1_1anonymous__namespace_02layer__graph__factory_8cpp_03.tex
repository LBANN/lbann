\hypertarget{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03}{}\section{lbann\+:\+:proto\+:\+:anonymous\+\_\+namespace\{layer\+\_\+graph\+\_\+factory.\+cpp\} Namespace Reference}
\label{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03}\index{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}@{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_abbebb0b2e6ba1befb14b0b790eac96a0}{setup\+\_\+parents\+\_\+and\+\_\+children} (\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}, std\+::vector$<$ \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&layers, std\+::unordered\+\_\+map$<$ std\+::string, \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&names\+\_\+to\+\_\+layers, const lbann\+\_\+data\+::\+Model \&proto\+\_\+model)
\item 
void \hyperlink{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a049fcca970d819d3c08bfdf71883de5c}{setup\+\_\+target\+\_\+pointers} (\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}, std\+::vector$<$ \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&layers, std\+::unordered\+\_\+map$<$ std\+::string, \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&names\+\_\+to\+\_\+layers, const lbann\+\_\+data\+::\+Model \&proto\+\_\+model)
\item 
void \hyperlink{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_ac0c3ac49d16d6926308c336149a2f039}{setup\+\_\+reconstruction\+\_\+pointers} (\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}, std\+::vector$<$ \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&layers, std\+::unordered\+\_\+map$<$ std\+::string, \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&names\+\_\+to\+\_\+layers, const lbann\+\_\+data\+::\+Model \&proto\+\_\+model)
\item 
void \hyperlink{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a68f963a80592c01832cacf2acd4bacc1}{setup\+\_\+unpooling\+\_\+pointers} (\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}, std\+::vector$<$ \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&layers, std\+::unordered\+\_\+map$<$ std\+::string, \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&names\+\_\+to\+\_\+layers, const lbann\+\_\+data\+::\+Model \&proto\+\_\+model)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_abbebb0b2e6ba1befb14b0b790eac96a0}\label{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_abbebb0b2e6ba1befb14b0b790eac96a0}} 
\index{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}@{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}}!setup\+\_\+parents\+\_\+and\+\_\+children@{setup\+\_\+parents\+\_\+and\+\_\+children}}
\index{setup\+\_\+parents\+\_\+and\+\_\+children@{setup\+\_\+parents\+\_\+and\+\_\+children}!lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}@{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}}}
\subsubsection{\texorpdfstring{setup\+\_\+parents\+\_\+and\+\_\+children()}{setup\_parents\_and\_children()}}
{\footnotesize\ttfamily void lbann\+::proto\+::anonymous\+\_\+namespace\{layer\+\_\+graph\+\_\+factory.\+cpp\}\+::setup\+\_\+parents\+\_\+and\+\_\+children (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$}]{comm,  }\item[{std\+::vector$<$ \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&}]{layers,  }\item[{std\+::unordered\+\_\+map$<$ std\+::string, \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&}]{names\+\_\+to\+\_\+layers,  }\item[{const lbann\+\_\+data\+::\+Model \&}]{proto\+\_\+model }\end{DoxyParamCaption})}

Setup parent/child relationships between layers. 

Definition at line 35 of file layer\+\_\+graph\+\_\+factory.\+cpp.


\begin{DoxyCode}
38                                                                     \{
39   std::stringstream err;
40   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<proto\_model.layer\_size(); ++i) \{
41     \textcolor{keyword}{const} \textcolor{keyword}{auto}& proto\_layer = proto\_model.layer(i);
42     \textcolor{keyword}{const} \textcolor{keyword}{auto}& parents = parse\_list<std::string>(proto\_layer.parents());
43     \textcolor{keyword}{const} \textcolor{keyword}{auto}& children = parse\_list<std::string>(proto\_layer.children());
44     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}& parent : parents) \{
45       \textcolor{keywordflow}{if} (names\_to\_layers.count(parent) == 0) \{
46         err << \textcolor{stringliteral}{"could not find parent layer "} << parent << \textcolor{stringliteral}{" "} 
47             << \textcolor{stringliteral}{"for layer "} << layers[i]->get\_name();
48         \hyperlink{base_8hpp_a80b1d707117e968a6951b7222e4b2b87}{LBANN\_ERROR}(err.str());
49       \}
50       layers[i]->add\_parent\_layer(names\_to\_layers[parent]);
51     \}
52     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}& child : children) \{
53       \textcolor{keywordflow}{if} (names\_to\_layers.count(child) == 0) \{
54         err << \textcolor{stringliteral}{"could not find child layer "} << child << \textcolor{stringliteral}{" "} 
55             << \textcolor{stringliteral}{"for layer "} << layers[i]->get\_name();
56         \hyperlink{base_8hpp_a80b1d707117e968a6951b7222e4b2b87}{LBANN\_ERROR}(err.str());
57       \}
58       layers[i]->add\_child\_layer(names\_to\_layers[child]);
59     \}
60   \}
61 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_abbebb0b2e6ba1befb14b0b790eac96a0_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_ac0c3ac49d16d6926308c336149a2f039}\label{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_ac0c3ac49d16d6926308c336149a2f039}} 
\index{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}@{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}}!setup\+\_\+reconstruction\+\_\+pointers@{setup\+\_\+reconstruction\+\_\+pointers}}
\index{setup\+\_\+reconstruction\+\_\+pointers@{setup\+\_\+reconstruction\+\_\+pointers}!lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}@{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}}}
\subsubsection{\texorpdfstring{setup\+\_\+reconstruction\+\_\+pointers()}{setup\_reconstruction\_pointers()}}
{\footnotesize\ttfamily void lbann\+::proto\+::anonymous\+\_\+namespace\{layer\+\_\+graph\+\_\+factory.\+cpp\}\+::setup\+\_\+reconstruction\+\_\+pointers (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$}]{comm,  }\item[{std\+::vector$<$ \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&}]{layers,  }\item[{std\+::unordered\+\_\+map$<$ std\+::string, \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&}]{names\+\_\+to\+\_\+layers,  }\item[{const lbann\+\_\+data\+::\+Model \&}]{proto\+\_\+model }\end{DoxyParamCaption})}

Setup original layers for reconstruction layers. 

Definition at line 99 of file layer\+\_\+graph\+\_\+factory.\+cpp.


\begin{DoxyCode}
102                                                                        \{
103   std::stringstream err;
104   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<proto\_model.layer\_size(); ++i) \{
105     \textcolor{keyword}{const} \textcolor{keyword}{auto}& proto\_layer = proto\_model.layer(i);
106     Layer* l = layers[i];
107     \textcolor{keywordflow}{if} (proto\_layer.has\_reconstruction()) \{
108       Layer* original = \textcolor{keyword}{nullptr};
109       \textcolor{keyword}{const} \textcolor{keyword}{auto}& original\_name = proto\_layer.reconstruction().original\_layer();
110       \textcolor{keywordflow}{if} (!original\_name.empty()) \{
111         original = names\_to\_layers[original\_name];
112       \} \textcolor{keywordflow}{else} \{
113         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& other : layers) \{
114           original = \textcolor{keyword}{dynamic\_cast<}generic\_input\_layer*\textcolor{keyword}{>}(other);
115           \textcolor{keywordflow}{if} (original != \textcolor{keyword}{nullptr}) \{ \textcolor{keywordflow}{break}; \}
116         \}
117       \}
118       \textcolor{keywordflow}{if} (original == \textcolor{keyword}{nullptr}) \{
119         err << \textcolor{stringliteral}{"could not find original layer "} << original\_name << \textcolor{stringliteral}{" "}
120             << \textcolor{stringliteral}{"for reconstruction layer "} << l->get\_name();
121         \hyperlink{base_8hpp_a80b1d707117e968a6951b7222e4b2b87}{LBANN\_ERROR}(err.str());
122       \}
123       \textcolor{keyword}{auto}&& recon\_dp = \textcolor{keyword}{dynamic\_cast<}reconstruction\_layer<data\_layout::DATA\_PARALLEL>*\textcolor{keyword}{>}(l);
124       \textcolor{keyword}{auto}&& recon\_mp = \textcolor{keyword}{dynamic\_cast<}reconstruction\_layer<data\_layout::MODEL\_PARALLEL>*\textcolor{keyword}{>}(l);
125       \textcolor{keywordflow}{if} (recon\_dp != \textcolor{keyword}{nullptr}) \{ recon\_dp->set\_original\_layer(original); \}
126       \textcolor{keywordflow}{if} (recon\_mp != \textcolor{keyword}{nullptr}) \{ recon\_mp->set\_original\_layer(original); \}
127     \}
128   \}  
129 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_ac0c3ac49d16d6926308c336149a2f039_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_ac0c3ac49d16d6926308c336149a2f039_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a049fcca970d819d3c08bfdf71883de5c}\label{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a049fcca970d819d3c08bfdf71883de5c}} 
\index{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}@{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}}!setup\+\_\+target\+\_\+pointers@{setup\+\_\+target\+\_\+pointers}}
\index{setup\+\_\+target\+\_\+pointers@{setup\+\_\+target\+\_\+pointers}!lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}@{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}}}
\subsubsection{\texorpdfstring{setup\+\_\+target\+\_\+pointers()}{setup\_target\_pointers()}}
{\footnotesize\ttfamily void lbann\+::proto\+::anonymous\+\_\+namespace\{layer\+\_\+graph\+\_\+factory.\+cpp\}\+::setup\+\_\+target\+\_\+pointers (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$}]{comm,  }\item[{std\+::vector$<$ \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&}]{layers,  }\item[{std\+::unordered\+\_\+map$<$ std\+::string, \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&}]{names\+\_\+to\+\_\+layers,  }\item[{const lbann\+\_\+data\+::\+Model \&}]{proto\+\_\+model }\end{DoxyParamCaption})}

Setup paired input layers for target layers. 

Definition at line 64 of file layer\+\_\+graph\+\_\+factory.\+cpp.


\begin{DoxyCode}
67                                                                \{
68   std::stringstream err;
69   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<proto\_model.layer\_size(); ++i) \{
70     generic\_target\_layer* target = \textcolor{keyword}{dynamic\_cast<}generic\_target\_layer*\textcolor{keyword}{>}(layers[i]);
71     \textcolor{keywordflow}{if} (target != \textcolor{keyword}{nullptr}) \{
72       generic\_input\_layer* input = \textcolor{keyword}{nullptr};
73       \textcolor{keyword}{const} \textcolor{keyword}{auto}& input\_name = proto\_model.layer(i).target().paired\_input\_layer();
74       \textcolor{keywordflow}{if} (!input\_name.empty()) \{
75         input = \textcolor{keyword}{dynamic\_cast<}generic\_input\_layer*\textcolor{keyword}{>}(names\_to\_layers[input\_name]);
76       \} \textcolor{keywordflow}{else} \{
77         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& other : layers) \{
78           input = \textcolor{keyword}{dynamic\_cast<}generic\_input\_layer*\textcolor{keyword}{>}(other);
79           \textcolor{keywordflow}{if} (input != \textcolor{keyword}{nullptr}) \{ \textcolor{keywordflow}{break}; \}
80         \}
81       \}
82       \textcolor{keywordflow}{if} (input == \textcolor{keyword}{nullptr}) \{
83         err << \textcolor{stringliteral}{"could not find input layer "} << input\_name << \textcolor{stringliteral}{" "}
84             << \textcolor{stringliteral}{"to pair with target layer "} << target->get\_name();
85         \hyperlink{base_8hpp_a80b1d707117e968a6951b7222e4b2b87}{LBANN\_ERROR}(err.str());
86       \}
87       \textcolor{keywordflow}{if} (input->is\_for\_regression() != target->is\_for\_regression()) \{
88         err << \textcolor{stringliteral}{"target layer "} << target->get\_name() << \textcolor{stringliteral}{" "}
89             << \textcolor{stringliteral}{"and its paired input layer "} << input->get\_name()
90             << \textcolor{stringliteral}{"are not consistent regarding regression/classification"};
91         \hyperlink{base_8hpp_a80b1d707117e968a6951b7222e4b2b87}{LBANN\_ERROR}(err.str());
92       \}
93       target->set\_paired\_input\_layer(input);
94     \}
95   \}
96 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a049fcca970d819d3c08bfdf71883de5c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a049fcca970d819d3c08bfdf71883de5c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a68f963a80592c01832cacf2acd4bacc1}\label{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a68f963a80592c01832cacf2acd4bacc1}} 
\index{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}@{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}}!setup\+\_\+unpooling\+\_\+pointers@{setup\+\_\+unpooling\+\_\+pointers}}
\index{setup\+\_\+unpooling\+\_\+pointers@{setup\+\_\+unpooling\+\_\+pointers}!lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}@{lbann\+::proto\+::anonymous\+\_\+namespace\lcurly{}layer\+\_\+graph\+\_\+factory.\+cpp\rcurly{}}}
\subsubsection{\texorpdfstring{setup\+\_\+unpooling\+\_\+pointers()}{setup\_unpooling\_pointers()}}
{\footnotesize\ttfamily void lbann\+::proto\+::anonymous\+\_\+namespace\{layer\+\_\+graph\+\_\+factory.\+cpp\}\+::setup\+\_\+unpooling\+\_\+pointers (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$}]{comm,  }\item[{std\+::vector$<$ \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&}]{layers,  }\item[{std\+::unordered\+\_\+map$<$ std\+::string, \hyperlink{classlbann_1_1Layer}{Layer} $\ast$$>$ \&}]{names\+\_\+to\+\_\+layers,  }\item[{const lbann\+\_\+data\+::\+Model \&}]{proto\+\_\+model }\end{DoxyParamCaption})}

Setup paired pooling layers for unpooling layers. 

Definition at line 132 of file layer\+\_\+graph\+\_\+factory.\+cpp.


\begin{DoxyCode}
135                                                                   \{
136   std::stringstream err;
137   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<proto\_model.layer\_size(); ++i) \{
138     unpooling\_layer<data\_layout::DATA\_PARALLEL>* unpool
139       = \textcolor{keyword}{dynamic\_cast<}unpooling\_layer<data\_layout::DATA\_PARALLEL>*\textcolor{keyword}{>}(layers[i]);
140     \textcolor{keywordflow}{if} (unpool != \textcolor{keyword}{nullptr}) \{
141       \textcolor{keyword}{const} \textcolor{keyword}{auto}& pool\_name = proto\_model.layer(i).unpooling().pooling\_layer();
142       pooling\_layer<data\_layout::DATA\_PARALLEL>* pool
143         = \textcolor{keyword}{dynamic\_cast<}pooling\_layer<data\_layout::DATA\_PARALLEL>*\textcolor{keyword}{>}(names\_to\_layers[pool\_name]);
144       \textcolor{keywordflow}{if} (pool == \textcolor{keyword}{nullptr}) \{
145         err << \textcolor{stringliteral}{"could not find pooling layer "} << pool\_name << \textcolor{stringliteral}{" "}
146             << \textcolor{stringliteral}{"to pair with unpooling layer "} << unpool->get\_name();
147         \hyperlink{base_8hpp_a80b1d707117e968a6951b7222e4b2b87}{LBANN\_ERROR}(err.str());
148       \}
149       unpool->set\_pooling\_layer(pool);
150     \}
151   \}
152 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a68f963a80592c01832cacf2acd4bacc1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacelbann_1_1proto_1_1anonymous__namespace_02layer__graph__factory_8cpp_03_a68f963a80592c01832cacf2acd4bacc1_icgraph}
\end{center}
\end{figure}
