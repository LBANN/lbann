\hypertarget{classlbann_1_1lbann__callback__variable__minibatch}{}\section{lbann\+:\+:lbann\+\_\+callback\+\_\+variable\+\_\+minibatch Class Reference}
\label{classlbann_1_1lbann__callback__variable__minibatch}\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}


{\ttfamily \#include $<$callback\+\_\+variable\+\_\+minibatch.\+hpp$>$}



Inheritance diagram for lbann\+:\+:lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=322pt]{classlbann_1_1lbann__callback__variable__minibatch__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for lbann\+:\+:lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=207pt]{classlbann_1_1lbann__callback__variable__minibatch__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a970a03f0d297f8447020e85d23f5ee73}{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch} (int starting\+\_\+mbsize)
\item 
\hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a7ffbb380f1a58b164cfb49ab1b407648}{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch} (const \hyperlink{classlbann_1_1lbann__callback__variable__minibatch}{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch} \&)=default
\item 
\hyperlink{classlbann_1_1lbann__callback__variable__minibatch}{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch} \& \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a154f749e29203562d41faf81202e5656}{operator=} (const \hyperlink{classlbann_1_1lbann__callback__variable__minibatch}{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch} \&)=default
\item 
void \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a4f5d8ab04ab3e1cc3aa66327d3712f51}{on\+\_\+train\+\_\+begin} (\hyperlink{classlbann_1_1model}{model} $\ast$m) override
\begin{DoxyCompactList}\small\item\em Set the initial mini-\/batch size. \end{DoxyCompactList}\item 
void \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a091e7563b5a7a90638e2521fe39cbf8f}{on\+\_\+epoch\+\_\+end} (\hyperlink{classlbann_1_1model}{model} $\ast$m) override
\begin{DoxyCompactList}\small\item\em Potentially change the mini-\/batch size. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
virtual bool \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_ace13e8941491ddd28ef35c277cecb1ad}{schedule} (\hyperlink{classlbann_1_1model}{model} $\ast$m, int \&new\+\_\+mbsize, float \&new\+\_\+lr, int \&ramp\+\_\+time)=0
\item 
void \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_af078f30f9c206b89bdd542ce1fc6d2ad}{change\+\_\+learning\+\_\+rate} (\hyperlink{classlbann_1_1model}{model} $\ast$m, float new\+\_\+lr) const
\begin{DoxyCompactList}\small\item\em Change the learning rate of every layer in m to new\+\_\+lr. \end{DoxyCompactList}\item 
float \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a9de892c44231eadbbc7d27cfcc340ce2}{get\+\_\+current\+\_\+learning\+\_\+rate} (\hyperlink{classlbann_1_1model}{model} $\ast$m) const
\begin{DoxyCompactList}\small\item\em Get the current learning rate (assumes every layer has the same one). \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
const int \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a8e1a314b320f6131d0eecbff69aeb2b8}{m\+\_\+starting\+\_\+mbsize}
\begin{DoxyCompactList}\small\item\em Initial mini-\/batch size. \end{DoxyCompactList}\item 
int \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a6488bd1f45110a1cb22553e5035003de}{m\+\_\+current\+\_\+mini\+\_\+batch\+\_\+size}
\item 
int \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a7beea78ef7107c88cb8782d3af618117}{m\+\_\+ramp\+\_\+count} = 0
\begin{DoxyCompactList}\small\item\em Current number of epochs left to ramp the learning rate. \end{DoxyCompactList}\item 
float \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_ac78d3d357e1c16b3303cf358aee8a83d}{m\+\_\+lr\+\_\+incr} = 0.\+0f
\begin{DoxyCompactList}\small\item\em Amount to increment the learning rate by when ramping. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Support changing the mini-\/batch size on different schedules. Implementations should override implement the abstract methods to define concrete schedules. 

Definition at line 41 of file callback\+\_\+variable\+\_\+minibatch.\+hpp.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_a970a03f0d297f8447020e85d23f5ee73}\label{classlbann_1_1lbann__callback__variable__minibatch_a970a03f0d297f8447020e85d23f5ee73}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\index{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch()}{lbann\_callback\_variable\_minibatch()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch (\begin{DoxyParamCaption}\item[{int}]{starting\+\_\+mbsize }\end{DoxyParamCaption})}



Definition at line 36 of file callback\+\_\+variable\+\_\+minibatch.\+cpp.


\begin{DoxyCode}
37                        : \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a8e1a314b320f6131d0eecbff69aeb2b8}{m\_starting\_mbsize}(starting\_mbsize),
38                          \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a6488bd1f45110a1cb22553e5035003de}{m\_current\_mini\_batch\_size}(starting\_mbsize) \{\}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_a7ffbb380f1a58b164cfb49ab1b407648}\label{classlbann_1_1lbann__callback__variable__minibatch_a7ffbb380f1a58b164cfb49ab1b407648}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\index{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch()}{lbann\_callback\_variable\_minibatch()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1lbann__callback__variable__minibatch}{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [default]}}



\subsection{Member Function Documentation}
\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_af078f30f9c206b89bdd542ce1fc6d2ad}\label{classlbann_1_1lbann__callback__variable__minibatch_af078f30f9c206b89bdd542ce1fc6d2ad}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!change\+\_\+learning\+\_\+rate@{change\+\_\+learning\+\_\+rate}}
\index{change\+\_\+learning\+\_\+rate@{change\+\_\+learning\+\_\+rate}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{change\+\_\+learning\+\_\+rate()}{change\_learning\_rate()}}
{\footnotesize\ttfamily void lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::change\+\_\+learning\+\_\+rate (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1model}{model} $\ast$}]{m,  }\item[{float}]{new\+\_\+lr }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [protected]}}



Change the learning rate of every layer in m to new\+\_\+lr. 



Definition at line 127 of file callback\+\_\+variable\+\_\+minibatch.\+cpp.


\begin{DoxyCode}
128                                 \{
129   \textcolor{keywordflow}{for} (weights *w : m->get\_weights()) \{
130     optimizer *opt = w->get\_optimizer();
131     \textcolor{keywordflow}{if} (opt != \textcolor{keyword}{nullptr}) \{
132       opt->set\_learning\_rate(new\_lr);
133     \}
134   \}
135 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1lbann__callback__variable__minibatch_af078f30f9c206b89bdd542ce1fc6d2ad_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=341pt]{classlbann_1_1lbann__callback__variable__minibatch_af078f30f9c206b89bdd542ce1fc6d2ad_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_a9de892c44231eadbbc7d27cfcc340ce2}\label{classlbann_1_1lbann__callback__variable__minibatch_a9de892c44231eadbbc7d27cfcc340ce2}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!get\+\_\+current\+\_\+learning\+\_\+rate@{get\+\_\+current\+\_\+learning\+\_\+rate}}
\index{get\+\_\+current\+\_\+learning\+\_\+rate@{get\+\_\+current\+\_\+learning\+\_\+rate}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{get\+\_\+current\+\_\+learning\+\_\+rate()}{get\_current\_learning\_rate()}}
{\footnotesize\ttfamily float lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::get\+\_\+current\+\_\+learning\+\_\+rate (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1model}{model} $\ast$}]{m }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [protected]}}



Get the current learning rate (assumes every layer has the same one). 



Definition at line 137 of file callback\+\_\+variable\+\_\+minibatch.\+cpp.


\begin{DoxyCode}
138                   \{
139   \textcolor{keywordflow}{for} (weights *w : m->get\_weights()) \{
140     optimizer *opt = w->get\_optimizer();
141     \textcolor{keywordflow}{if} (opt != \textcolor{keyword}{nullptr}) \{
142       \textcolor{keywordflow}{return} opt->get\_learning\_rate();
143     \}
144   \}
145   \textcolor{keywordflow}{return} 0.0f;
146 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1lbann__callback__variable__minibatch_a9de892c44231eadbbc7d27cfcc340ce2_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1lbann__callback__variable__minibatch_a9de892c44231eadbbc7d27cfcc340ce2_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_a091e7563b5a7a90638e2521fe39cbf8f}\label{classlbann_1_1lbann__callback__variable__minibatch_a091e7563b5a7a90638e2521fe39cbf8f}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!on\+\_\+epoch\+\_\+end@{on\+\_\+epoch\+\_\+end}}
\index{on\+\_\+epoch\+\_\+end@{on\+\_\+epoch\+\_\+end}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{on\+\_\+epoch\+\_\+end()}{on\_epoch\_end()}}
{\footnotesize\ttfamily void lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::on\+\_\+epoch\+\_\+end (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1model}{model} $\ast$}]{m }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Potentially change the mini-\/batch size. 



Reimplemented from \hyperlink{classlbann_1_1lbann__callback_a1fc71110e7f754bf73c9e0f344a448a5}{lbann\+::lbann\+\_\+callback}.



Definition at line 66 of file callback\+\_\+variable\+\_\+minibatch.\+cpp.


\begin{DoxyCode}
66                                                              \{
67 
68   \textcolor{comment}{// Get first input layer in model}
69   generic\_input\_layer* input = \textcolor{keyword}{nullptr};
70   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& l : m->get\_layers()) \{
71     input = \textcolor{keyword}{dynamic\_cast<}generic\_input\_layer*\textcolor{keyword}{>}(l);
72     \textcolor{keywordflow}{if} (input != \textcolor{keyword}{nullptr}) \{ \textcolor{keywordflow}{break}; \}
73   \}
74   \textcolor{keywordflow}{if} (input == \textcolor{keyword}{nullptr}) \{ \hyperlink{base_8hpp_a80b1d707117e968a6951b7222e4b2b87}{LBANN\_ERROR}(\textcolor{stringliteral}{"could not get input layer"}); \}
75 
76   lbann\_comm *\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm} = m->get\_comm();
77   \textcolor{keywordtype}{int} new\_mbsize = 0;
78   \textcolor{keywordtype}{float} new\_lr = 0.0f;
79   \textcolor{keywordtype}{int} ramp\_time = 0;
80   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1lbann__callback__variable__minibatch_ace13e8941491ddd28ef35c277cecb1ad}{schedule}(m, new\_mbsize, new\_lr, ramp\_time)) \{
81     \textcolor{keywordflow}{if} (new\_mbsize > m->get\_max\_mini\_batch\_size()) \{
82       \textcolor{keywordflow}{if} (comm->am\_model\_master()) \{
83         std::cout << \textcolor{stringliteral}{"Model "} << comm->get\_model\_rank() << \textcolor{stringliteral}{": WARNING "} <<
84           \textcolor{stringliteral}{"requested new mini-batch size "} << new\_mbsize <<
85           \textcolor{stringliteral}{" is greater than the model maximum mini-batch size "} <<
86           m->get\_max\_mini\_batch\_size() << std::endl;
87       \}
88       new\_mbsize = m->get\_max\_mini\_batch\_size();
89     \}
90     input->calculate\_num\_iterations\_per\_epoch\_training\_spans\_models(new\_mbsize);
91     \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a6488bd1f45110a1cb22553e5035003de}{m\_current\_mini\_batch\_size} = new\_mbsize;
92     \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a7beea78ef7107c88cb8782d3af618117}{m\_ramp\_count} = ramp\_time;
93     \textcolor{keywordflow}{if} (new\_lr != 0.0f) \{
94       \textcolor{keywordflow}{if} (ramp\_time == 0) \{
95         \textcolor{comment}{// Change learning rate immediately.}
96         \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_af078f30f9c206b89bdd542ce1fc6d2ad}{change\_learning\_rate}(m, new\_lr);
97       \} \textcolor{keywordflow}{else} \{
98         \textcolor{comment}{// Compute the per-epoch learning rate increment.}
99         \textcolor{keywordtype}{float} cur\_lr = \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a9de892c44231eadbbc7d27cfcc340ce2}{get\_current\_learning\_rate}(m);
100         \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_ac78d3d357e1c16b3303cf358aee8a83d}{m\_lr\_incr} = (new\_lr - cur\_lr) / ramp\_time;
101       \}
102       \textcolor{keywordflow}{if} (comm->am\_model\_master()) \{
103         std::cout << \textcolor{stringliteral}{"Model "} << comm->get\_model\_rank() <<
104           \textcolor{stringliteral}{": Changing mini-batch size to "} << new\_mbsize <<
105           \textcolor{stringliteral}{" and learning rate to "} << new\_lr << \textcolor{stringliteral}{" at epoch "} <<
106           m->get\_cur\_epoch() << std::endl;
107       \}
108     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (comm->am\_model\_master()) \{
109       std::cout << \textcolor{stringliteral}{"Model "} << comm->get\_model\_rank() <<
110         \textcolor{stringliteral}{": Changing mini-batch size to "} << new\_mbsize <<
111         \textcolor{stringliteral}{" at epoch "} << m->get\_cur\_epoch() << std::endl;
112     \}
113   \}
114   \textcolor{comment}{// Ramp the learning rate, if needed.}
115   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a7beea78ef7107c88cb8782d3af618117}{m\_ramp\_count} > 0) \{
116     --\hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a7beea78ef7107c88cb8782d3af618117}{m\_ramp\_count};
117     \textcolor{keywordtype}{float} target\_lr = \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a9de892c44231eadbbc7d27cfcc340ce2}{get\_current\_learning\_rate}(m) + 
      \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_ac78d3d357e1c16b3303cf358aee8a83d}{m\_lr\_incr};
118     \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_af078f30f9c206b89bdd542ce1fc6d2ad}{change\_learning\_rate}(m, target\_lr);
119     \textcolor{keywordflow}{if} (comm->am\_model\_master()) \{
120       std::cout << \textcolor{stringliteral}{"Model "} << comm->get\_model\_rank() <<
121         \textcolor{stringliteral}{": Variable-size mini-batch ramping learning rate to "} <<
122         target\_lr << std::endl;
123     \}
124   \}
125 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1lbann__callback__variable__minibatch_a091e7563b5a7a90638e2521fe39cbf8f_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_a4f5d8ab04ab3e1cc3aa66327d3712f51}\label{classlbann_1_1lbann__callback__variable__minibatch_a4f5d8ab04ab3e1cc3aa66327d3712f51}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!on\+\_\+train\+\_\+begin@{on\+\_\+train\+\_\+begin}}
\index{on\+\_\+train\+\_\+begin@{on\+\_\+train\+\_\+begin}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{on\+\_\+train\+\_\+begin()}{on\_train\_begin()}}
{\footnotesize\ttfamily void lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::on\+\_\+train\+\_\+begin (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1model}{model} $\ast$}]{m }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Set the initial mini-\/batch size. 



Reimplemented from \hyperlink{classlbann_1_1lbann__callback_a7c8f0d211967ccc5219144e92571ab26}{lbann\+::lbann\+\_\+callback}.



Definition at line 40 of file callback\+\_\+variable\+\_\+minibatch.\+cpp.


\begin{DoxyCode}
40                                                                \{
41   \textcolor{comment}{// Avoid issues with the train method being called multiple times.}
42   \textcolor{keywordflow}{if} (m->get\_cur\_epoch() != 0) \{ \textcolor{keywordflow}{return}; \}
43 
44   \textcolor{comment}{// Get first input layer in model}
45   generic\_input\_layer* input = \textcolor{keyword}{nullptr};
46   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& l : m->get\_layers()) \{
47     input = \textcolor{keyword}{dynamic\_cast<}generic\_input\_layer*\textcolor{keyword}{>}(l);
48     \textcolor{keywordflow}{if} (input != \textcolor{keyword}{nullptr}) \{ \textcolor{keywordflow}{break}; \}
49   \}
50   \textcolor{keywordflow}{if} (input == \textcolor{keyword}{nullptr}) \{ \hyperlink{base_8hpp_a80b1d707117e968a6951b7222e4b2b87}{LBANN\_ERROR}(\textcolor{stringliteral}{"could not get input layer"}); \}
51 
52   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a8e1a314b320f6131d0eecbff69aeb2b8}{m\_starting\_mbsize} > m->get\_max\_mini\_batch\_size()) \{
53     \textcolor{keywordflow}{throw} lbann\_exception(
54       \textcolor{stringliteral}{"variable\_minibatch: starting mini-batch size is larger than max"});
55   \}
56   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a8e1a314b320f6131d0eecbff69aeb2b8}{m\_starting\_mbsize} == m->get\_max\_mini\_batch\_size()) \{
57     \textcolor{keywordflow}{if} (m->get\_comm()->am\_world\_master()) \{
58       std::cout << \textcolor{stringliteral}{"WARNING: starting mini-batch size equals max mini-batch "}
59                 << \textcolor{stringliteral}{"size and using variable-sized mini-batches"} << std::endl;
60     \}
61   \}
62   input->calculate\_num\_iterations\_per\_epoch\_training\_spans\_models(
63     \hyperlink{classlbann_1_1lbann__callback__variable__minibatch_a8e1a314b320f6131d0eecbff69aeb2b8}{m\_starting\_mbsize});
64 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1lbann__callback__variable__minibatch_a4f5d8ab04ab3e1cc3aa66327d3712f51_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_a154f749e29203562d41faf81202e5656}\label{classlbann_1_1lbann__callback__variable__minibatch_a154f749e29203562d41faf81202e5656}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!operator=@{operator=}}
\index{operator=@{operator=}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{operator=()}{operator=()}}
{\footnotesize\ttfamily \hyperlink{classlbann_1_1lbann__callback__variable__minibatch}{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}\& lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::operator= (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1lbann__callback__variable__minibatch}{lbann\+\_\+callback\+\_\+variable\+\_\+minibatch} \&}]{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [default]}}

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1lbann__callback__variable__minibatch_a154f749e29203562d41faf81202e5656_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_ace13e8941491ddd28ef35c277cecb1ad}\label{classlbann_1_1lbann__callback__variable__minibatch_ace13e8941491ddd28ef35c277cecb1ad}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!schedule@{schedule}}
\index{schedule@{schedule}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{schedule()}{schedule()}}
{\footnotesize\ttfamily virtual bool lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::schedule (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1model}{model} $\ast$}]{m,  }\item[{int \&}]{new\+\_\+mbsize,  }\item[{float \&}]{new\+\_\+lr,  }\item[{int \&}]{ramp\+\_\+time }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [pure virtual]}}

Implemented by child classes to provide the mini-\/batch/learning schedule. This is called at the end of every training epoch. If it returns false, no changes are made from the currently established schedule. If this returns true, the mini-\/batch size will be changed accordingly. If the mini-\/batch size is larger than the model\textquotesingle{}s maximum mini-\/batch size, a warning is printed and the maximum mini-\/batch size is used. If new\+\_\+lr also non-\/zero, the learning rate will be changed to new\+\_\+lr, with a linear ramp time. (If ramp\+\_\+time is 0, it is changed immediately.) Note changing the learning rate while in a ramp may lead to unexpected behavior; also be aware of interactions with other learning rate schedules. 

Implemented in \hyperlink{classlbann_1_1lbann__callback__minibatch__schedule_af95cbe83a587590219174cb17828ea4b}{lbann\+::lbann\+\_\+callback\+\_\+minibatch\+\_\+schedule}, and \hyperlink{classlbann_1_1lbann__callback__step__minibatch_a9ed85aa78f6e4fe4cf3427f9257a4610}{lbann\+::lbann\+\_\+callback\+\_\+step\+\_\+minibatch}.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1lbann__callback__variable__minibatch_ace13e8941491ddd28ef35c277cecb1ad_icgraph}
\end{center}
\end{figure}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_a6488bd1f45110a1cb22553e5035003de}\label{classlbann_1_1lbann__callback__variable__minibatch_a6488bd1f45110a1cb22553e5035003de}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!m\+\_\+current\+\_\+mini\+\_\+batch\+\_\+size@{m\+\_\+current\+\_\+mini\+\_\+batch\+\_\+size}}
\index{m\+\_\+current\+\_\+mini\+\_\+batch\+\_\+size@{m\+\_\+current\+\_\+mini\+\_\+batch\+\_\+size}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{m\+\_\+current\+\_\+mini\+\_\+batch\+\_\+size}{m\_current\_mini\_batch\_size}}
{\footnotesize\ttfamily int lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::m\+\_\+current\+\_\+mini\+\_\+batch\+\_\+size\hspace{0.3cm}{\ttfamily [protected]}}

The current mini-\/batch size for this epoch. This is kept separately from the model\textquotesingle{}s get\+\_\+current\+\_\+mini\+\_\+batch\+\_\+size() method, as calling that in on\+\_\+epoch\+\_\+end returns the size of the last mini-\/ batch, not the \char`\"{}base\char`\"{} mini-\/batch. 

Definition at line 80 of file callback\+\_\+variable\+\_\+minibatch.\+hpp.

\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_ac78d3d357e1c16b3303cf358aee8a83d}\label{classlbann_1_1lbann__callback__variable__minibatch_ac78d3d357e1c16b3303cf358aee8a83d}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!m\+\_\+lr\+\_\+incr@{m\+\_\+lr\+\_\+incr}}
\index{m\+\_\+lr\+\_\+incr@{m\+\_\+lr\+\_\+incr}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{m\+\_\+lr\+\_\+incr}{m\_lr\_incr}}
{\footnotesize\ttfamily float lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::m\+\_\+lr\+\_\+incr = 0.\+0f\hspace{0.3cm}{\ttfamily [protected]}}



Amount to increment the learning rate by when ramping. 



Definition at line 84 of file callback\+\_\+variable\+\_\+minibatch.\+hpp.

\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_a7beea78ef7107c88cb8782d3af618117}\label{classlbann_1_1lbann__callback__variable__minibatch_a7beea78ef7107c88cb8782d3af618117}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!m\+\_\+ramp\+\_\+count@{m\+\_\+ramp\+\_\+count}}
\index{m\+\_\+ramp\+\_\+count@{m\+\_\+ramp\+\_\+count}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{m\+\_\+ramp\+\_\+count}{m\_ramp\_count}}
{\footnotesize\ttfamily int lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::m\+\_\+ramp\+\_\+count = 0\hspace{0.3cm}{\ttfamily [protected]}}



Current number of epochs left to ramp the learning rate. 



Definition at line 82 of file callback\+\_\+variable\+\_\+minibatch.\+hpp.

\mbox{\Hypertarget{classlbann_1_1lbann__callback__variable__minibatch_a8e1a314b320f6131d0eecbff69aeb2b8}\label{classlbann_1_1lbann__callback__variable__minibatch_a8e1a314b320f6131d0eecbff69aeb2b8}} 
\index{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}!m\+\_\+starting\+\_\+mbsize@{m\+\_\+starting\+\_\+mbsize}}
\index{m\+\_\+starting\+\_\+mbsize@{m\+\_\+starting\+\_\+mbsize}!lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch@{lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch}}
\subsubsection{\texorpdfstring{m\+\_\+starting\+\_\+mbsize}{m\_starting\_mbsize}}
{\footnotesize\ttfamily const int lbann\+::lbann\+\_\+callback\+\_\+variable\+\_\+minibatch\+::m\+\_\+starting\+\_\+mbsize\hspace{0.3cm}{\ttfamily [protected]}}



Initial mini-\/batch size. 



Definition at line 73 of file callback\+\_\+variable\+\_\+minibatch.\+hpp.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/include/lbann/callbacks/\hyperlink{callback__variable__minibatch_8hpp}{callback\+\_\+variable\+\_\+minibatch.\+hpp}\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/src/callbacks/\hyperlink{callback__variable__minibatch_8cpp}{callback\+\_\+variable\+\_\+minibatch.\+cpp}\end{DoxyCompactItemize}
