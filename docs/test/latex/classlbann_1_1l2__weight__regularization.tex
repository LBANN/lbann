\hypertarget{classlbann_1_1l2__weight__regularization}{}\section{lbann\+:\+:l2\+\_\+weight\+\_\+regularization Class Reference}
\label{classlbann_1_1l2__weight__regularization}\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}


{\ttfamily \#include $<$l2.\+hpp$>$}



Inheritance diagram for lbann\+:\+:l2\+\_\+weight\+\_\+regularization\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=234pt]{classlbann_1_1l2__weight__regularization__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for lbann\+:\+:l2\+\_\+weight\+\_\+regularization\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=234pt]{classlbann_1_1l2__weight__regularization__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classlbann_1_1l2__weight__regularization_aa2a01507574b4d349ae8bb9bb784ecaf}{l2\+\_\+weight\+\_\+regularization} (\hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type} scale\+\_\+factor=\hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type}(1))
\item 
\hyperlink{classlbann_1_1l2__weight__regularization}{l2\+\_\+weight\+\_\+regularization} $\ast$ \hyperlink{classlbann_1_1l2__weight__regularization_ac00a969efe6c3fd911a0d69428bb5b95}{copy} () const override
\item 
std\+::string \hyperlink{classlbann_1_1l2__weight__regularization_acf602d51617f6730343948b72ace8dfe}{name} () const override
\item 
void \hyperlink{classlbann_1_1l2__weight__regularization_a0320afab573fbe77b5ba6d22ea5e0898}{setup} (\hyperlink{classlbann_1_1model}{model} \&m) override
\item 
void \hyperlink{classlbann_1_1l2__weight__regularization_ab3a47d8ef5b8c8e16f076659e864f683}{start\+\_\+evaluation} () override
\item 
\hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type} \hyperlink{classlbann_1_1l2__weight__regularization_a5517e1fa9da8a28f39cf208054f6138a}{finish\+\_\+evaluation} () override
\item 
void \hyperlink{classlbann_1_1l2__weight__regularization_a64f5cd1a4a30727a81f112e51367700e}{differentiate} () override
\item 
void \hyperlink{classlbann_1_1l2__weight__regularization_a1dce8a486660335097f5ad239b343e39}{compute\+\_\+weight\+\_\+regularization} () override
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::vector$<$ \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type} $>$ \hyperlink{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}{m\+\_\+sqsums}
\item 
std\+::vector$<$ \hyperlink{structlbann_1_1Al_1_1request}{Al\+::request} $>$ \hyperlink{classlbann_1_1l2__weight__regularization_adf7350e151736d9bae4aa5cf410acd80}{m\+\_\+allreduce\+\_\+reqs}
\item 
std\+::vector$<$ bool $>$ \hyperlink{classlbann_1_1l2__weight__regularization_a0ae4858adb3279c0019f5e0500bdcf4f}{m\+\_\+allreduce\+\_\+started}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
Objective function term for L2 weight regularization. Given weights $w_1,\cdots,w_n$, the L2 weight regularization term is \[ L2(w) = \frac{1}{2} \sum\limits_{i} w_i \] Note the $1/2$ scaling factor. 

Definition at line 42 of file l2.\+hpp.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_aa2a01507574b4d349ae8bb9bb784ecaf}\label{classlbann_1_1l2__weight__regularization_aa2a01507574b4d349ae8bb9bb784ecaf}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!l2\+\_\+weight\+\_\+regularization@{l2\+\_\+weight\+\_\+regularization}}
\index{l2\+\_\+weight\+\_\+regularization@{l2\+\_\+weight\+\_\+regularization}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{l2\+\_\+weight\+\_\+regularization()}{l2\_weight\_regularization()}}
{\footnotesize\ttfamily lbann\+::l2\+\_\+weight\+\_\+regularization\+::l2\+\_\+weight\+\_\+regularization (\begin{DoxyParamCaption}\item[{\hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type}}]{scale\+\_\+factor = {\ttfamily \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type}(1)} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 45 of file l2.\+hpp.


\begin{DoxyCode}
46     : \hyperlink{classlbann_1_1objective__function__term_a8c019e3c880f38dc20275e395acaeca1}{objective\_function\_term}(scale\_factor) \{\}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_aa2a01507574b4d349ae8bb9bb784ecaf_icgraph}
\end{center}
\end{figure}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_a1dce8a486660335097f5ad239b343e39}\label{classlbann_1_1l2__weight__regularization_a1dce8a486660335097f5ad239b343e39}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!compute\+\_\+weight\+\_\+regularization@{compute\+\_\+weight\+\_\+regularization}}
\index{compute\+\_\+weight\+\_\+regularization@{compute\+\_\+weight\+\_\+regularization}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{compute\+\_\+weight\+\_\+regularization()}{compute\_weight\_regularization()}}
{\footnotesize\ttfamily void lbann\+::l2\+\_\+weight\+\_\+regularization\+::compute\+\_\+weight\+\_\+regularization (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Compute the gradient w.\+r.\+t. the weights. The gradient w.\+r.\+t. the weights is \[ \nabla_w L2(w) = w \] 

Implements \hyperlink{classlbann_1_1objective__function__term_a134cf89caed45527bbe9d811a0b93dfc}{lbann\+::objective\+\_\+function\+\_\+term}.



Definition at line 168 of file l2.\+cpp.


\begin{DoxyCode}
168                                                              \{
169   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1objective__function__term_a59a544b8ff0455ed5091de3bf0d81c3c}{m\_scale\_factor} == \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType}(0)) \{ \textcolor{keywordflow}{return}; \}
170 
171 \textcolor{preprocessor}{#ifdef LBANN\_HAS\_CUDNN}
172   \textcolor{comment}{// Compute gradient of L2 regularization term for GPU weights}
173   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& w : \hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}) \{
174     \textcolor{keywordflow}{if} (w->get\_cudnn\_manager() != \textcolor{keyword}{nullptr}) \{
175       cudnn::matrix values\_d(m\_cudnn);
176       values\_d.locked\_attach(w->get\_values\_gpu(), w->get\_size());
177       w->get\_optimizer()->add\_to\_gradient(values\_d, \hyperlink{classlbann_1_1objective__function__term_a59a544b8ff0455ed5091de3bf0d81c3c}{m\_scale\_factor});
178     \}
179   \}
180 \textcolor{preprocessor}{#endif // LBANN\_HAS\_CUDNN}
181 
182   \textcolor{comment}{// Compute gradient of L2 regularization term for CPU weights}
183   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& w : m\_weights) \{
184     \textcolor{keywordflow}{if} (w->get\_cudnn\_manager() == \textcolor{keyword}{nullptr}) \{
185       w->get\_optimizer()->add\_to\_gradient(w->get\_values(), \hyperlink{classlbann_1_1objective__function__term_a59a544b8ff0455ed5091de3bf0d81c3c}{m\_scale\_factor});
186     \}
187   \}
188 
189 \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_a1dce8a486660335097f5ad239b343e39_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_ac00a969efe6c3fd911a0d69428bb5b95}\label{classlbann_1_1l2__weight__regularization_ac00a969efe6c3fd911a0d69428bb5b95}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!copy@{copy}}
\index{copy@{copy}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{copy()}{copy()}}
{\footnotesize\ttfamily \hyperlink{classlbann_1_1l2__weight__regularization}{l2\+\_\+weight\+\_\+regularization}$\ast$ lbann\+::l2\+\_\+weight\+\_\+regularization\+::copy (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Copy function. 

Implements \hyperlink{classlbann_1_1objective__function__term_ae98a4ec173a602ad55d1df20dadd4cb9}{lbann\+::objective\+\_\+function\+\_\+term}.



Definition at line 47 of file l2.\+hpp.


\begin{DoxyCode}
47 \{ \textcolor{keywordflow}{return} \textcolor{keyword}{new} \hyperlink{classlbann_1_1l2__weight__regularization_aa2a01507574b4d349ae8bb9bb784ecaf}{l2\_weight\_regularization}(*\textcolor{keyword}{this}); \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_ac00a969efe6c3fd911a0d69428bb5b95_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_a64f5cd1a4a30727a81f112e51367700e}\label{classlbann_1_1l2__weight__regularization_a64f5cd1a4a30727a81f112e51367700e}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!differentiate@{differentiate}}
\index{differentiate@{differentiate}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{differentiate()}{differentiate()}}
{\footnotesize\ttfamily void lbann\+::l2\+\_\+weight\+\_\+regularization\+::differentiate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Compute the gradient w.\+r.\+t. the activations. L2 weight regularization is independent of the activations. 

Implements \hyperlink{classlbann_1_1objective__function__term_ad009c3cfbe1cf2fbb6cce015b16fdac5}{lbann\+::objective\+\_\+function\+\_\+term}.



Definition at line 56 of file l2.\+hpp.


\begin{DoxyCode}
56 \{\};
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_a64f5cd1a4a30727a81f112e51367700e_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_a5517e1fa9da8a28f39cf208054f6138a}\label{classlbann_1_1l2__weight__regularization_a5517e1fa9da8a28f39cf208054f6138a}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!finish\+\_\+evaluation@{finish\+\_\+evaluation}}
\index{finish\+\_\+evaluation@{finish\+\_\+evaluation}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{finish\+\_\+evaluation()}{finish\_evaluation()}}
{\footnotesize\ttfamily \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type} lbann\+::l2\+\_\+weight\+\_\+regularization\+::finish\+\_\+evaluation (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Complete evaluation of the objective function term. 

Implements \hyperlink{classlbann_1_1objective__function__term_a7a82f2cdbc954655ac860896306aed0c}{lbann\+::objective\+\_\+function\+\_\+term}.



Definition at line 155 of file l2.\+cpp.


\begin{DoxyCode}
155                                                      \{
156   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1objective__function__term_a59a544b8ff0455ed5091de3bf0d81c3c}{m\_scale\_factor} == \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType}(0)) \{ \textcolor{keywordflow}{return} \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType}(0); \}
157   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < \hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}.size(); ++i) \{
158     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1l2__weight__regularization_a0ae4858adb3279c0019f5e0500bdcf4f}{m\_allreduce\_started}[i]) \{
159       \hyperlink{classlbann_1_1objective__function__term_a5f89b676a26a6b76ddc26563ac87beb9}{get\_comm}().\hyperlink{classlbann_1_1lbann__comm_a30439f28cf615e1406090799c5499321}{wait}(\hyperlink{classlbann_1_1l2__weight__regularization_adf7350e151736d9bae4aa5cf410acd80}{m\_allreduce\_reqs}[i]);
160     \}
161   \}
162   \textcolor{keyword}{const} \textcolor{keyword}{auto}& sqsum = std::accumulate(\hyperlink{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}{m\_sqsums}.begin(),
163                                       \hyperlink{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}{m\_sqsums}.end(),
164                                       \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType}(0));
165   \textcolor{keywordflow}{return} \hyperlink{classlbann_1_1objective__function__term_a59a544b8ff0455ed5091de3bf0d81c3c}{m\_scale\_factor} * sqsum / 2;
166 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_a5517e1fa9da8a28f39cf208054f6138a_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_a5517e1fa9da8a28f39cf208054f6138a_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_acf602d51617f6730343948b72ace8dfe}\label{classlbann_1_1l2__weight__regularization_acf602d51617f6730343948b72ace8dfe}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!name@{name}}
\index{name@{name}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{name()}{name()}}
{\footnotesize\ttfamily std\+::string lbann\+::l2\+\_\+weight\+\_\+regularization\+::name (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Get the name of the objective function term. 

Implements \hyperlink{classlbann_1_1objective__function__term_a964fbfad3dd0434aa8f32c5fedf1079a}{lbann\+::objective\+\_\+function\+\_\+term}.



Definition at line 48 of file l2.\+hpp.


\begin{DoxyCode}
48 \{ \textcolor{keywordflow}{return} \textcolor{stringliteral}{"L2 weight regularization"}; \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_acf602d51617f6730343948b72ace8dfe_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_a0320afab573fbe77b5ba6d22ea5e0898}\label{classlbann_1_1l2__weight__regularization_a0320afab573fbe77b5ba6d22ea5e0898}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!setup@{setup}}
\index{setup@{setup}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{setup()}{setup()}}
{\footnotesize\ttfamily void lbann\+::l2\+\_\+weight\+\_\+regularization\+::setup (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1model}{model} \&}]{m }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Setup objective function term. 

Reimplemented from \hyperlink{classlbann_1_1objective__function__term_a6c8dbdf18aac8676098189fb7b178e91}{lbann\+::objective\+\_\+function\+\_\+term}.



Definition at line 67 of file l2.\+cpp.


\begin{DoxyCode}
67                                              \{
68   \hyperlink{classlbann_1_1objective__function__term_a6c8dbdf18aac8676098189fb7b178e91}{objective\_function\_term::setup}(m);
69 
70   \textcolor{comment}{// Check that term has no layer pointers}
71   \textcolor{keywordflow}{if} (!\hyperlink{classlbann_1_1objective__function__term_a9269cf0a237eacd1e220ba2739f44334}{m\_layers}.empty()) \{
72     \hyperlink{base_8hpp_a80b1d707117e968a6951b7222e4b2b87}{LBANN\_ERROR}(\textcolor{stringliteral}{"attempted to setup L2 weight regularization with layer pointers"});
73   \}
74 
75   \textcolor{comment}{// Add all weights in model if no weights pointers are provided}
76   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}.empty()) \{
77     \textcolor{keywordflow}{for} (weights* w : m.get\_weights()) \{
78       \textcolor{keywordflow}{if} (w->get\_optimizer() != \textcolor{keyword}{nullptr}) \{
79         \hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}.push\_back(w);
80       \}
81     \}
82   \}
83   \hyperlink{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}{m\_sqsums}.resize(\hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}.size(), \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType}(0));
84   \hyperlink{classlbann_1_1l2__weight__regularization_a0ae4858adb3279c0019f5e0500bdcf4f}{m\_allreduce\_started}.resize(\hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}.size(), \textcolor{keyword}{false});
85   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < \hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}.size(); ++i) \{
86     \hyperlink{classlbann_1_1l2__weight__regularization_adf7350e151736d9bae4aa5cf410acd80}{m\_allreduce\_reqs}.emplace\_back();
87   \}
88 
89 \textcolor{preprocessor}{#ifdef LBANN\_HAS\_CUDNN}
90   \textcolor{comment}{// Get cuDNN manager}
91   m\_cudnn = \textcolor{keyword}{nullptr};
92   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& w : \hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}) \{
93     m\_cudnn = w->get\_cudnn\_manager();
94     \textcolor{keywordflow}{if} (m\_cudnn != \textcolor{keyword}{nullptr}) \{ \textcolor{keywordflow}{break}; \}
95   \}
96 \textcolor{preprocessor}{#endif // LBANN\_HAS\_CUDNN}
97 
98 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_a0320afab573fbe77b5ba6d22ea5e0898_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_a0320afab573fbe77b5ba6d22ea5e0898_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_ab3a47d8ef5b8c8e16f076659e864f683}\label{classlbann_1_1l2__weight__regularization_ab3a47d8ef5b8c8e16f076659e864f683}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!start\+\_\+evaluation@{start\+\_\+evaluation}}
\index{start\+\_\+evaluation@{start\+\_\+evaluation}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{start\+\_\+evaluation()}{start\_evaluation()}}
{\footnotesize\ttfamily void lbann\+::l2\+\_\+weight\+\_\+regularization\+::start\+\_\+evaluation (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Start evaluation of the objective function term. This should include the scaling factor. The result is not available until finish\+\_\+evaluation has been called. 

Implements \hyperlink{classlbann_1_1objective__function__term_a0af4dfd71fb30e43d1ae7611172ad9b0}{lbann\+::objective\+\_\+function\+\_\+term}.



Definition at line 100 of file l2.\+cpp.


\begin{DoxyCode}
100                                                 \{
101   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1objective__function__term_a59a544b8ff0455ed5091de3bf0d81c3c}{m\_scale\_factor} == \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType}(0)) \{ \textcolor{keywordflow}{return}; \}
102 
103   \textcolor{comment}{// Reset terms for each weights}
104   \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_weights = \hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}.size();
105   std::fill(\hyperlink{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}{m\_sqsums}.begin(), \hyperlink{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}{m\_sqsums}.end(), \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType}(0));
106 
107 \textcolor{preprocessor}{#ifdef LBANN\_HAS\_CUDNN}
108   \textcolor{comment}{// Compute terms for GPU weights}
109   \textcolor{keywordflow}{if} (m\_cudnn != \textcolor{keyword}{nullptr}) \{
110     \textcolor{keyword}{const} \textcolor{keyword}{auto}& num\_gpus = m\_cudnn->get\_num\_gpus();
111     \textcolor{keyword}{const} \textcolor{keyword}{auto}& weights\_per\_gpu = (num\_weights + num\_gpus - 1) / num\_gpus;
112     cudnn::matrix sqsums\_d(m\_cudnn);
113     sqsums\_d.attach\_to\_work\_spaces(1, weights\_per\_gpu);
114     sqsums\_d.zero();
115     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} gpu = 0; gpu < num\_gpus; ++gpu) \{
116       CHECK\_CUDA(cudaSetDevice(m\_cudnn->get\_gpu(gpu)));
117       \textcolor{keyword}{auto}&& handle = m\_cudnn->get\_cublas\_handle(gpu);
118       CHECK\_CUDA(cublasSetPointerMode(handle, CUBLAS\_POINTER\_MODE\_DEVICE));
119       \textcolor{keyword}{const} \textcolor{keyword}{auto}& weights\_start = std::min(gpu * weights\_per\_gpu, num\_weights);
120       \textcolor{keyword}{const} \textcolor{keyword}{auto}& weights\_end   = std::min((gpu+1) * weights\_per\_gpu, num\_weights);
121       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = weights\_start; i < weights\_end; ++i) \{
122         \textcolor{keyword}{const} \textcolor{keyword}{auto}& w = \hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}[i];
123         \textcolor{keywordflow}{if} (w->get\_cudnn\_manager() != \textcolor{keyword}{nullptr}) \{
124           \textcolor{keyword}{const} \textcolor{keyword}{auto}& values\_d = w->get\_values\_gpu()[gpu];
125           \textcolor{keyword}{auto}&& sqsum\_d = sqsums\_d.get\_data(gpu) + i - weights\_start;
126           cublas::dot(handle, w->get\_size(), values\_d, 1, values\_d, 1, sqsum\_d);
127         \}
128       \}
129       CHECK\_CUDA(cublasSetPointerMode(handle, CUBLAS\_POINTER\_MODE\_HOST));
130     \}
131     \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} sqsums(1, num\_weights);
132     m\_cudnn->gather\_from\_gpus(sqsums, sqsums\_d.get\_locked\_data(), weights\_per\_gpu);
133     m\_cudnn->synchronize();
134     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_weights; ++i) \{
135       \hyperlink{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}{m\_sqsums}[i] = \hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{EvalType}(sqsums(0, i));
136     \}
137   \}
138 \textcolor{preprocessor}{#endif // LBANN\_HAS\_CUDNN}
139 
140   \textcolor{comment}{// Compute terms for CPU weights}
141   std::fill(\hyperlink{classlbann_1_1l2__weight__regularization_a0ae4858adb3279c0019f5e0500bdcf4f}{m\_allreduce\_started}.begin(), \hyperlink{classlbann_1_1l2__weight__regularization_a0ae4858adb3279c0019f5e0500bdcf4f}{m\_allreduce\_started}.end(), \textcolor{keyword}{
      false});
142   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_weights; ++i) \{
143     \textcolor{keyword}{const} \textcolor{keyword}{auto}& w = \hyperlink{classlbann_1_1objective__function__term_a1d601c29153ae9cb54c585887608f2bf}{m\_weights}[i];
144     \textcolor{keywordflow}{if} (w->get\_cudnn\_manager() == \textcolor{keyword}{nullptr}) \{
145       \textcolor{keyword}{const} \textcolor{keyword}{auto}& values = w->get\_values();
146       \hyperlink{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}{m\_sqsums}[i] = \hyperlink{namespaceanonymous__namespace_02l2_8cpp_03_a32724e48048319cd99337131ba70d4c4}{sum\_of\_squares}(values.LockedMatrix());
147       \hyperlink{classlbann_1_1objective__function__term_a5f89b676a26a6b76ddc26563ac87beb9}{get\_comm}().\hyperlink{classlbann_1_1lbann__comm_a2a7bb6cf3707366fc0671d8894ca30ea}{nb\_allreduce}(&(\hyperlink{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}{m\_sqsums}[i]), 1, values.DistComm(),
148                               \hyperlink{classlbann_1_1l2__weight__regularization_adf7350e151736d9bae4aa5cf410acd80}{m\_allreduce\_reqs}[i], El::mpi::SUM);
149       \hyperlink{classlbann_1_1l2__weight__regularization_a0ae4858adb3279c0019f5e0500bdcf4f}{m\_allreduce\_started}[i] = \textcolor{keyword}{true};
150     \}
151   \}
152 
153 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_ab3a47d8ef5b8c8e16f076659e864f683_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1l2__weight__regularization_ab3a47d8ef5b8c8e16f076659e864f683_icgraph}
\end{center}
\end{figure}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_adf7350e151736d9bae4aa5cf410acd80}\label{classlbann_1_1l2__weight__regularization_adf7350e151736d9bae4aa5cf410acd80}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!m\+\_\+allreduce\+\_\+reqs@{m\+\_\+allreduce\+\_\+reqs}}
\index{m\+\_\+allreduce\+\_\+reqs@{m\+\_\+allreduce\+\_\+reqs}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{m\+\_\+allreduce\+\_\+reqs}{m\_allreduce\_reqs}}
{\footnotesize\ttfamily std\+::vector$<$\hyperlink{structlbann_1_1Al_1_1request}{Al\+::request}$>$ lbann\+::l2\+\_\+weight\+\_\+regularization\+::m\+\_\+allreduce\+\_\+reqs\hspace{0.3cm}{\ttfamily [private]}}

Holds an allreduce request for each weights. 

Definition at line 71 of file l2.\+hpp.

\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_a0ae4858adb3279c0019f5e0500bdcf4f}\label{classlbann_1_1l2__weight__regularization_a0ae4858adb3279c0019f5e0500bdcf4f}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!m\+\_\+allreduce\+\_\+started@{m\+\_\+allreduce\+\_\+started}}
\index{m\+\_\+allreduce\+\_\+started@{m\+\_\+allreduce\+\_\+started}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{m\+\_\+allreduce\+\_\+started}{m\_allreduce\_started}}
{\footnotesize\ttfamily std\+::vector$<$bool$>$ lbann\+::l2\+\_\+weight\+\_\+regularization\+::m\+\_\+allreduce\+\_\+started\hspace{0.3cm}{\ttfamily [private]}}

Whether an allreduce is needed for each weights. 

Definition at line 73 of file l2.\+hpp.

\mbox{\Hypertarget{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}\label{classlbann_1_1l2__weight__regularization_a628aabb4e824f2aa861baba93668dc24}} 
\index{lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}!m\+\_\+sqsums@{m\+\_\+sqsums}}
\index{m\+\_\+sqsums@{m\+\_\+sqsums}!lbann\+::l2\+\_\+weight\+\_\+regularization@{lbann\+::l2\+\_\+weight\+\_\+regularization}}
\subsubsection{\texorpdfstring{m\+\_\+sqsums}{m\_sqsums}}
{\footnotesize\ttfamily std\+::vector$<$\hyperlink{base_8hpp_a3266f5ac18504bbadea983c109566867}{Eval\+Type}$>$ lbann\+::l2\+\_\+weight\+\_\+regularization\+::m\+\_\+sqsums\hspace{0.3cm}{\ttfamily [private]}}

Holds intermediate terms for each weights. 

Definition at line 69 of file l2.\+hpp.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/include/lbann/objective\+\_\+functions/weight\+\_\+regularization/\hyperlink{l2_8hpp}{l2.\+hpp}\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/src/objective\+\_\+functions/weight\+\_\+regularization/\hyperlink{l2_8cpp}{l2.\+cpp}\end{DoxyCompactItemize}
