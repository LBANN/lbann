\hypertarget{classlbann_1_1base__convolution__layer}{}\section{lbann\+:\+:base\+\_\+convolution\+\_\+layer Class Reference}
\label{classlbann_1_1base__convolution__layer}\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}


{\ttfamily \#include $<$base\+\_\+convolution.\+hpp$>$}



Inheritance diagram for lbann\+:\+:base\+\_\+convolution\+\_\+layer\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=304pt]{classlbann_1_1base__convolution__layer__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for lbann\+:\+:base\+\_\+convolution\+\_\+layer\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classlbann_1_1base__convolution__layer_a1489c6034dc88a8749ccd0ae4a3b02a8}{base\+\_\+convolution\+\_\+layer} (\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}, int num\+\_\+data\+\_\+dims, int num\+\_\+output\+\_\+channels, const std\+::vector$<$ int $>$ conv\+\_\+dims, const std\+::vector$<$ int $>$ pads, const std\+::vector$<$ int $>$ strides, bool has\+\_\+bias, \hyperlink{classlbann_1_1cudnn_1_1cudnn__manager}{cudnn\+::cudnn\+\_\+manager} $\ast$cudnn)
\item 
\hyperlink{classlbann_1_1base__convolution__layer_a5ffba3070c459e3fc1dc1a5ecdaf5e0c}{base\+\_\+convolution\+\_\+layer} (const \hyperlink{classlbann_1_1base__convolution__layer}{base\+\_\+convolution\+\_\+layer} \&other)
\item 
\hyperlink{classlbann_1_1base__convolution__layer}{base\+\_\+convolution\+\_\+layer} \& \hyperlink{classlbann_1_1base__convolution__layer_ad31a2eac6843bd8643538530f1017c32}{operator=} (const \hyperlink{classlbann_1_1base__convolution__layer}{base\+\_\+convolution\+\_\+layer} \&other)
\item 
\hyperlink{classlbann_1_1base__convolution__layer_a2622ff3205a5feba6e75f86ec2e3c0d8}{$\sim$base\+\_\+convolution\+\_\+layer} () override
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_a9f850c1bdf4ae3cd986411d3cb3a524c}{setup\+\_\+data} () override
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_a4fb0ec8793656a7c32ff37c266b29a68}{setup\+\_\+gpu} () override
\begin{DoxyCompactList}\small\item\em Initialize G\+PU objects. \end{DoxyCompactList}\item 
virtual void \hyperlink{classlbann_1_1base__convolution__layer_afa07aaa293d12cc7d28fbc8a96025900}{check\+\_\+setup} () override
\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_a1c6e967ab0c66cfa0d27f7abfbbf2be8}{apply\+\_\+convolution\+\_\+cudnn} (bool during\+\_\+forward\+\_\+prop)
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_a130907ca7a8e3b6676bdd4186c788ef4}{apply\+\_\+transposed\+\_\+convolution\+\_\+cudnn} (bool during\+\_\+forward\+\_\+prop)
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_aa33e490222597c4c5203d94061ae9d88}{apply\+\_\+bias\+\_\+cudnn} ()
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_ae46e6a975c443792c606817878dc4446}{compute\+\_\+gradients\+\_\+cudnn} (bool using\+\_\+transposed\+\_\+convolution)
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_a0710d46aa54d92f94de920ed37f6ef11}{apply\+\_\+convolution\+\_\+im2col} (bool during\+\_\+forward\+\_\+prop)
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_a87fb2bf066a98052938e48a82dcd4fd2}{apply\+\_\+transposed\+\_\+convolution\+\_\+im2col} (bool during\+\_\+forward\+\_\+prop)
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_a4f792e1c19d4591f305880b57f63cec3}{apply\+\_\+bias\+\_\+cpu} ()
\item 
void \hyperlink{classlbann_1_1base__convolution__layer_a8cb0b4fb33f058ce6c211ebaf6a17f63}{compute\+\_\+gradients\+\_\+im2col} (bool using\+\_\+transposed\+\_\+convolution)
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::vector$<$ int $>$ \hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\+\_\+kernel\+\_\+dims}
\item 
int \hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\+\_\+kernel\+\_\+size}
\item 
std\+::vector$<$ int $>$ \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\+\_\+pads}
\item 
std\+::vector$<$ int $>$ \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\+\_\+strides}
\item 
Data\+Type \hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\+\_\+bias\+\_\+scaling\+\_\+factor}
\item 
\hyperlink{base_8hpp_aba08580d21767b53d0737e115d738dbe}{Star\+Mat} \hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\+\_\+kernel\+\_\+gradient}
\item 
\hyperlink{base_8hpp_aba08580d21767b53d0737e115d738dbe}{Star\+Mat} \hyperlink{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}{m\+\_\+bias\+\_\+gradient}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
Base convolution layer. Parent class for convolution and deconvolution layers. 

Definition at line 47 of file base\+\_\+convolution.\+hpp.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a1489c6034dc88a8749ccd0ae4a3b02a8}\label{classlbann_1_1base__convolution__layer_a1489c6034dc88a8749ccd0ae4a3b02a8}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!base\+\_\+convolution\+\_\+layer@{base\+\_\+convolution\+\_\+layer}}
\index{base\+\_\+convolution\+\_\+layer@{base\+\_\+convolution\+\_\+layer}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{base\+\_\+convolution\+\_\+layer()}{base\_convolution\_layer()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily lbann\+::base\+\_\+convolution\+\_\+layer\+::base\+\_\+convolution\+\_\+layer (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$}]{comm,  }\item[{int}]{num\+\_\+data\+\_\+dims,  }\item[{int}]{num\+\_\+output\+\_\+channels,  }\item[{const std\+::vector$<$ int $>$}]{conv\+\_\+dims,  }\item[{const std\+::vector$<$ int $>$}]{pads,  }\item[{const std\+::vector$<$ int $>$}]{strides,  }\item[{bool}]{has\+\_\+bias,  }\item[{\hyperlink{classlbann_1_1cudnn_1_1cudnn__manager}{cudnn\+::cudnn\+\_\+manager} $\ast$}]{cudnn }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 95 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
103     : \hyperlink{classlbann_1_1learning__layer_a818a96b1d3daabb22b1e82c1c54c6268}{learning\_layer}(\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}),
104       \hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}(conv\_dims),
105       \hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\_kernel\_size}(0),
106       \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}(pads),
107       \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides}(strides),
108       \hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor}(has\_bias ? DataType(1) : DataType(0)),
109       \hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient}(this->\hyperlink{classlbann_1_1Layer_a5de05c52f22e0bbd7c703bec3ad4dbf2}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a483bf8a72d44a0e83da45f3d47bd20d4}{get\_model\_grid}()),
110       \hyperlink{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}{m\_bias\_gradient}(this->\hyperlink{classlbann_1_1Layer_a5de05c52f22e0bbd7c703bec3ad4dbf2}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a483bf8a72d44a0e83da45f3d47bd20d4}{get\_model\_grid}()) \{
111 
112     \textcolor{comment}{// Check dimensions of convolution parameters}
113     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{int}) \hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}.size() != num\_data\_dims
114         || (int) \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}.size() != num\_data\_dims
115         || (int) \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides}.size() != num\_data\_dims) \{
116       std::stringstream err;
117       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" :: "}
118           << \textcolor{stringliteral}{"invalid number of convolution parameters "}
119           << \textcolor{stringliteral}{"(expected "} << num\_data\_dims << \textcolor{stringliteral}{" parameters, "}
120           << \textcolor{stringliteral}{"conv\_dims has "} << \hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}.size() << \textcolor{stringliteral}{", "}
121           << \textcolor{stringliteral}{"pads has "} << \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}.size() << \textcolor{stringliteral}{", "}
122           << \textcolor{stringliteral}{"strides has "} << \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides}.size() << \textcolor{stringliteral}{")"};
123       \textcolor{keywordflow}{throw} lbann\_exception(err.str());
124     \}
125 
126     \textcolor{comment}{// Record number of output channels}
127     \hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}.insert(\hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}.begin(), num\_output\_channels);
128 
129 \textcolor{preprocessor}{  #ifdef LBANN\_HAS\_CUDNN}
130     \textcolor{comment}{// Initialize cuDNN objects}
131     this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn} = cudnn;
132     m\_bias\_cudnn\_desc = \textcolor{keyword}{nullptr};
133     m\_kernel\_cudnn\_desc = \textcolor{keyword}{nullptr};
134     m\_convolution\_cudnn\_desc = \textcolor{keyword}{nullptr};
135 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
136 
137   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a5ffba3070c459e3fc1dc1a5ecdaf5e0c}\label{classlbann_1_1base__convolution__layer_a5ffba3070c459e3fc1dc1a5ecdaf5e0c}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!base\+\_\+convolution\+\_\+layer@{base\+\_\+convolution\+\_\+layer}}
\index{base\+\_\+convolution\+\_\+layer@{base\+\_\+convolution\+\_\+layer}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{base\+\_\+convolution\+\_\+layer()}{base\_convolution\_layer()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily lbann\+::base\+\_\+convolution\+\_\+layer\+::base\+\_\+convolution\+\_\+layer (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1base__convolution__layer}{base\+\_\+convolution\+\_\+layer} \&}]{other }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 139 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
140     : \hyperlink{classlbann_1_1learning__layer_a818a96b1d3daabb22b1e82c1c54c6268}{learning\_layer}(other),
141       \hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}(other.m\_kernel\_dims),
142       \hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\_kernel\_size}(other.m\_kernel\_size),
143       \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}(other.m\_pads),
144       \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides}(other.m\_strides),
145       \hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor}(other.m\_bias\_scaling\_factor),
146       \hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient}(other.m\_kernel\_gradient),
147       \hyperlink{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}{m\_bias\_gradient}(other.m\_bias\_gradient) \{
148 
149 \textcolor{preprocessor}{  #ifdef LBANN\_HAS\_CUDNN}
150 
151     \textcolor{comment}{// Copy cuDNN objects}
152     m\_bias\_cudnn\_desc = \textcolor{keyword}{nullptr};
153     m\_kernel\_cudnn\_desc = \textcolor{keyword}{nullptr};
154     m\_convolution\_cudnn\_desc = \textcolor{keyword}{nullptr};
155     cudnn::copy\_tensor\_cudnn\_desc(other.m\_bias\_cudnn\_desc,
156                                   m\_bias\_cudnn\_desc);
157     cudnn::copy\_kernel\_cudnn\_desc(other.m\_kernel\_cudnn\_desc,
158                                   m\_kernel\_cudnn\_desc);
159     cudnn::copy\_convolution\_cudnn\_desc(other.m\_convolution\_cudnn\_desc,
160                                        m\_convolution\_cudnn\_desc);
161 
162     \textcolor{comment}{// Copy GPU data}
163     m\_kernel\_gradient\_d = other.m\_kernel\_gradient\_d;
164     m\_bias\_gradient\_d = other.m\_bias\_gradient\_d;
165 
166 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
167 
168   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a2622ff3205a5feba6e75f86ec2e3c0d8}\label{classlbann_1_1base__convolution__layer_a2622ff3205a5feba6e75f86ec2e3c0d8}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!````~base\+\_\+convolution\+\_\+layer@{$\sim$base\+\_\+convolution\+\_\+layer}}
\index{````~base\+\_\+convolution\+\_\+layer@{$\sim$base\+\_\+convolution\+\_\+layer}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{$\sim$base\+\_\+convolution\+\_\+layer()}{~base\_convolution\_layer()}}
{\footnotesize\ttfamily lbann\+::base\+\_\+convolution\+\_\+layer\+::$\sim$base\+\_\+convolution\+\_\+layer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}



Definition at line 199 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
199                                      \{
200 \textcolor{preprocessor}{  #ifdef LBANN\_HAS\_CUDNN}
201     \textcolor{comment}{// Destroy cuDNN objects}
202     \textcolor{keywordflow}{if} (m\_bias\_cudnn\_desc != \textcolor{keyword}{nullptr}) \{
203       CHECK\_CUDNN(cudnnDestroyTensorDescriptor(m\_bias\_cudnn\_desc));
204     \}
205     \textcolor{keywordflow}{if} (m\_kernel\_cudnn\_desc != \textcolor{keyword}{nullptr}) \{
206       CHECK\_CUDNN(cudnnDestroyFilterDescriptor(m\_kernel\_cudnn\_desc));
207     \}
208     \textcolor{keywordflow}{if} (m\_convolution\_cudnn\_desc != \textcolor{keyword}{nullptr}) \{
209       CHECK\_CUDNN(cudnnDestroyConvolutionDescriptor(m\_convolution\_cudnn\_desc));
210     \}
211 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
212   \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a4f792e1c19d4591f305880b57f63cec3}\label{classlbann_1_1base__convolution__layer_a4f792e1c19d4591f305880b57f63cec3}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!apply\+\_\+bias\+\_\+cpu@{apply\+\_\+bias\+\_\+cpu}}
\index{apply\+\_\+bias\+\_\+cpu@{apply\+\_\+bias\+\_\+cpu}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{apply\+\_\+bias\+\_\+cpu()}{apply\_bias\_cpu()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::apply\+\_\+bias\+\_\+cpu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}}



Definition at line 750 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
750                         \{
751 
752     \textcolor{comment}{// Return immediately if there is no bias}
753     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} == DataType(0)) \textcolor{keywordflow}{return};
754 
755     \textcolor{comment}{// Local matrices}
756     \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_bias = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_values().LockedMatrix();
757     \textcolor{keyword}{auto}& local\_output = \hyperlink{classlbann_1_1Layer_a4248f27acebf72b7b7b3ee39c8bcb62a}{get\_local\_activations}();
758 
759     \textcolor{comment}{// Matrix parameters}
760     \textcolor{keyword}{const} El::Int local\_width = local\_output.Width();
761     \textcolor{keyword}{const} El::Int num\_output\_channels = this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims}[0];
762     \textcolor{keyword}{const} El::Int num\_per\_output\_channel = this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons} / num\_output\_channels;
763 
764     \textcolor{comment}{// Apply bias to each output channel}
765 \textcolor{preprocessor}{    #pragma omp parallel for}
766     \textcolor{keywordflow}{for} (El::Int channel = 0; channel < num\_output\_channels; ++channel) \{
767       \textcolor{keyword}{const} El::Int row\_start = channel * num\_per\_output\_channel;
768       \textcolor{keyword}{const} El::Int row\_end = (channel+1) * num\_per\_output\_channel;
769       \textcolor{keyword}{const} DataType bias\_term = \hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} * local\_bias(channel, 0);
770       \textcolor{keywordflow}{for} (El::Int col = 0; col < local\_width; ++col) \{
771         \textcolor{keywordflow}{for} (El::Int row = row\_start; row < row\_end; ++row) \{
772           local\_output(row, col) += bias\_term;
773         \}
774       \}
775     \}
776 
777   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a4f792e1c19d4591f305880b57f63cec3_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=348pt]{classlbann_1_1base__convolution__layer_a4f792e1c19d4591f305880b57f63cec3_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_aa33e490222597c4c5203d94061ae9d88}\label{classlbann_1_1base__convolution__layer_aa33e490222597c4c5203d94061ae9d88}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!apply\+\_\+bias\+\_\+cudnn@{apply\+\_\+bias\+\_\+cudnn}}
\index{apply\+\_\+bias\+\_\+cudnn@{apply\+\_\+bias\+\_\+cudnn}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{apply\+\_\+bias\+\_\+cudnn()}{apply\_bias\_cudnn()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::apply\+\_\+bias\+\_\+cudnn (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}}



Definition at line 494 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
494                           \{
495 \textcolor{preprocessor}{  #ifndef LBANN\_HAS\_CUDNN}
496     \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"base\_convolution\_layer: cuDNN not detected"});
497 \textcolor{preprocessor}{  #else}
498     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} != DataType(0)) \{
499       \textcolor{keyword}{const} DataType one = 1;
500       \textcolor{keyword}{const} \textcolor{keyword}{auto}& bias\_weights\_d = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_values\_gpu();
501       \textcolor{keyword}{auto}& output\_d = this->m\_activations\_d[0];
502       \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_gpus = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_num\_gpus();
503       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_gpus; ++i) \{
504         CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
505         CHECK\_CUDNN(cudnnSetStream(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
506                                    this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_stream(i)));
507         CHECK\_CUDNN(cudnnAddTensor(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
508                                    &\hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor},
509                                    m\_bias\_cudnn\_desc,
510                                    bias\_weights\_d[i],
511                                    &one,
512                                    this->m\_activations\_cudnn\_desc,
513                                    output\_d.get\_data(i)));
514       \}
515     \}
516 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
517   \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_aa33e490222597c4c5203d94061ae9d88_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a1c6e967ab0c66cfa0d27f7abfbbf2be8}\label{classlbann_1_1base__convolution__layer_a1c6e967ab0c66cfa0d27f7abfbbf2be8}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!apply\+\_\+convolution\+\_\+cudnn@{apply\+\_\+convolution\+\_\+cudnn}}
\index{apply\+\_\+convolution\+\_\+cudnn@{apply\+\_\+convolution\+\_\+cudnn}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{apply\+\_\+convolution\+\_\+cudnn()}{apply\_convolution\_cudnn()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::apply\+\_\+convolution\+\_\+cudnn (\begin{DoxyParamCaption}\item[{bool}]{during\+\_\+forward\+\_\+prop }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}}

Convolution with cu\+D\+NN. 

Definition at line 349 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
349                                                          \{
350 \textcolor{preprocessor}{  #ifndef LBANN\_HAS\_CUDNN}
351     \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"base\_convolution\_layer: cuDNN not detected"});
352 \textcolor{preprocessor}{  #else}
353 
354     \textcolor{comment}{// Useful constants}
355     \textcolor{keyword}{const} DataType one = 1;
356 
357     \textcolor{comment}{// GPU data}
358     \textcolor{keyword}{const} \textcolor{keyword}{auto}& kernel\_d = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values\_gpu();
359     \textcolor{keyword}{const} \textcolor{keyword}{auto}& input\_d = (during\_forward\_prop ?
360                            m\_prev\_activations\_d[0] :
361                            m\_prev\_error\_signals\_d[0]);
362     \textcolor{keyword}{auto}& output\_d = (during\_forward\_prop ?
363                       m\_activations\_d[0] :
364                       m\_error\_signals\_d[0]);
365     \textcolor{keyword}{auto}&& work\_spaces\_d = \hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_work\_spaces();
366 
367     \textcolor{comment}{// Convolution parameters}
368     DataType mixing\_factor;
369     cudnnTensorDescriptor\_t input\_cudnn\_desc, output\_cudnn\_desc;
370     \textcolor{keywordflow}{if} (during\_forward\_prop) \{
371       mixing\_factor = DataType(0);
372       input\_cudnn\_desc = this->m\_prev\_activations\_cudnn\_desc;
373       output\_cudnn\_desc = this->m\_activations\_cudnn\_desc;
374     \}
375     \textcolor{keywordflow}{else} \{
376       mixing\_factor = DataType(1);
377       input\_cudnn\_desc = this->m\_prev\_error\_signals\_cudnn\_desc;
378       output\_cudnn\_desc = this->m\_error\_signals\_cudnn\_desc;
379     \}
380 
381     \textcolor{comment}{// Perform convolution on each GPU}
382     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_gpus = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_num\_gpus();
383     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_gpus; ++i) \{
384 
385       \textcolor{comment}{// Determine convolution algorithm}
386       \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} work\_space\_size = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_work\_space\_size(i);
387       cudnnConvolutionFwdAlgo\_t convolution\_cudnn\_algorithm
388         = CUDNN\_CONVOLUTION\_FWD\_ALGO\_IMPLICIT\_GEMM;
389       CHECK\_CUDNN(cudnnGetConvolutionForwardAlgorithm(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
390                                                       input\_cudnn\_desc,
391                                                       m\_kernel\_cudnn\_desc,
392                                                       m\_convolution\_cudnn\_desc,
393                                                       output\_cudnn\_desc,
394                                                       CUDNN\_CONVOLUTION\_FWD\_SPECIFY\_WORKSPACE\_LIMIT,
395                                                       work\_space\_size,
396                                                       &convolution\_cudnn\_algorithm));
397 
398       \textcolor{comment}{// Apply convolution}
399       CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
400       CHECK\_CUDNN(cudnnSetStream(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
401                                  this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_stream(i)));
402       CHECK\_CUDNN(cudnnConvolutionForward(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
403                                           &one,
404                                           input\_cudnn\_desc,
405                                           input\_d.get\_locked\_data(i),
406                                           m\_kernel\_cudnn\_desc,
407                                           kernel\_d[i],
408                                           m\_convolution\_cudnn\_desc,
409                                           convolution\_cudnn\_algorithm,
410                                           work\_spaces\_d[i],
411                                           work\_space\_size,
412                                           &mixing\_factor,
413                                           output\_cudnn\_desc,
414                                           output\_d.get\_data(i)));
415 
416     \}
417 
418 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
419   \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a1c6e967ab0c66cfa0d27f7abfbbf2be8_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a0710d46aa54d92f94de920ed37f6ef11}\label{classlbann_1_1base__convolution__layer_a0710d46aa54d92f94de920ed37f6ef11}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!apply\+\_\+convolution\+\_\+im2col@{apply\+\_\+convolution\+\_\+im2col}}
\index{apply\+\_\+convolution\+\_\+im2col@{apply\+\_\+convolution\+\_\+im2col}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{apply\+\_\+convolution\+\_\+im2col()}{apply\_convolution\_im2col()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::apply\+\_\+convolution\+\_\+im2col (\begin{DoxyParamCaption}\item[{bool}]{during\+\_\+forward\+\_\+prop }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}}

Convolution with im2col G\+E\+MM algorithm. 

Definition at line 625 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
625                                                           \{
626 
627     \textcolor{comment}{// Local matrices}
628     \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_kernel = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values().LockedMatrix();
629     \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_input = (during\_forward\_prop ?
630                                \hyperlink{classlbann_1_1Layer_a35397843bb0c84030000c7d872229acb}{get\_local\_prev\_activations}() :
631                                \hyperlink{classlbann_1_1Layer_a82827edc5e869960144f3ccb2172bfcd}{get\_local\_prev\_error\_signals}());
632     \textcolor{keyword}{auto}& local\_output = (during\_forward\_prop ?
633                           \hyperlink{classlbann_1_1Layer_a4248f27acebf72b7b7b3ee39c8bcb62a}{get\_local\_activations}() :
634                           \hyperlink{classlbann_1_1Layer_af178d00b9d878aa7d87754bff2a91f3a}{get\_local\_error\_signals}());
635 
636     \textcolor{comment}{// Matrix parameters}
637     \textcolor{keyword}{const} \textcolor{keywordtype}{int} output\_size = local\_output.Height();
638     \textcolor{keyword}{const} El::Int local\_width = local\_input.Width();
639     DataType mixing\_factor;
640     std::vector<int> input\_dims, output\_dims;
641     \textcolor{keywordflow}{if} (during\_forward\_prop) \{
642       mixing\_factor = DataType(0);
643       input\_dims = this->\hyperlink{classlbann_1_1Layer_ae204d1a2a79606eaa117273857ff62a3}{m\_prev\_neuron\_dims};
644       output\_dims = this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims};
645     \}
646     \textcolor{keywordflow}{else} \{
647       mixing\_factor = DataType(1);
648       input\_dims = this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims};
649       output\_dims = this->\hyperlink{classlbann_1_1Layer_ae204d1a2a79606eaa117273857ff62a3}{m\_prev\_neuron\_dims};
650     \}
651 
652     \textcolor{comment}{// Initialize matrices}
653     \textcolor{keyword}{const} \textcolor{keywordtype}{int} m = output\_size / output\_dims[0];
654     \textcolor{keyword}{const} \textcolor{keywordtype}{int} n = output\_dims[0];
655     \textcolor{keyword}{const} \textcolor{keywordtype}{int} k = \hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\_kernel\_size} / output\_dims[0];
656     \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} input\_col, output\_col;
657     \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} im2col\_matrix(k, m);
658     \textcolor{keyword}{const} \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} kernel\_matrix(k, n, local\_kernel.LockedBuffer(), k);
659 
660     \textcolor{comment}{// Iterate through input columns}
661     \textcolor{keywordflow}{for} (El::Int col = 0; col < local\_width; ++col) \{
662 
663       \textcolor{comment}{// Construct im2col matrix from current input column}
664       El::LockedView(input\_col, local\_input, El::ALL, El::IR(col));
665       \hyperlink{namespacelbann_aa3636a1979e40da2af91f30a12b90db9}{im2col}(input\_col,
666              im2col\_matrix,
667              input\_dims[0],
668              input\_dims.size() - 1,
669              &input\_dims[1],
670              \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}.data(),
671              &\hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}[2],
672              \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides}.data());
673 
674       \textcolor{comment}{// Apply convolution to current input column}
675       output\_col.Attach(m, n, local\_output.Buffer(0, col), m);
676       El::Gemm(El::TRANSPOSE, El::NORMAL,
677                DataType(1), im2col\_matrix, kernel\_matrix,
678                mixing\_factor, output\_col);
679 
680     \}
681 
682   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a0710d46aa54d92f94de920ed37f6ef11_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a0710d46aa54d92f94de920ed37f6ef11_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a130907ca7a8e3b6676bdd4186c788ef4}\label{classlbann_1_1base__convolution__layer_a130907ca7a8e3b6676bdd4186c788ef4}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!apply\+\_\+transposed\+\_\+convolution\+\_\+cudnn@{apply\+\_\+transposed\+\_\+convolution\+\_\+cudnn}}
\index{apply\+\_\+transposed\+\_\+convolution\+\_\+cudnn@{apply\+\_\+transposed\+\_\+convolution\+\_\+cudnn}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{apply\+\_\+transposed\+\_\+convolution\+\_\+cudnn()}{apply\_transposed\_convolution\_cudnn()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::apply\+\_\+transposed\+\_\+convolution\+\_\+cudnn (\begin{DoxyParamCaption}\item[{bool}]{during\+\_\+forward\+\_\+prop }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}}

Transposed convolution with cu\+D\+NN. 

Definition at line 422 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
422                                                                     \{
423 \textcolor{preprocessor}{  #ifndef LBANN\_HAS\_CUDNN}
424     \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"base\_convolution\_layer: cuDNN not detected"});
425 \textcolor{preprocessor}{  #else}
426 
427     \textcolor{comment}{// Useful constants}
428     \textcolor{keyword}{const} DataType one = 1;
429 
430     \textcolor{comment}{// GPU data}
431     \textcolor{keyword}{const} \textcolor{keyword}{auto}& kernel\_d = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values\_gpu();
432     \textcolor{keyword}{const} \textcolor{keyword}{auto}& input\_d = (during\_forward\_prop ?
433                            m\_prev\_activations\_d[0] :
434                            m\_prev\_error\_signals\_d[0]);
435     \textcolor{keyword}{auto}& output\_d = (during\_forward\_prop ?
436                       m\_activations\_d[0] :
437                       m\_error\_signals\_d[0]);
438     \textcolor{keyword}{auto}&& work\_spaces\_d = \hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_work\_spaces();
439 
440     \textcolor{comment}{// Convolution transpose parameters}
441     DataType mixing\_factor;
442     cudnnTensorDescriptor\_t input\_cudnn\_desc, output\_cudnn\_desc;
443     \textcolor{keywordflow}{if} (during\_forward\_prop) \{
444       mixing\_factor = DataType(0);
445       input\_cudnn\_desc = this->m\_prev\_activations\_cudnn\_desc;
446       output\_cudnn\_desc = this->m\_activations\_cudnn\_desc;
447     \}
448     \textcolor{keywordflow}{else} \{
449       mixing\_factor = DataType(1);
450       input\_cudnn\_desc = this->m\_prev\_error\_signals\_cudnn\_desc;
451       output\_cudnn\_desc = this->m\_error\_signals\_cudnn\_desc;
452     \}
453 
454     \textcolor{comment}{// Perform transposed convolution on each GPU}
455     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_gpus = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_num\_gpus();
456     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_gpus; ++i) \{
457 
458       \textcolor{comment}{// Determine transposed convolution algorithm}
459       \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} work\_space\_size = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_work\_space\_size(i);
460       cudnnConvolutionBwdDataAlgo\_t transposed\_convolution\_cudnn\_algorithm
461         = CUDNN\_CONVOLUTION\_BWD\_DATA\_ALGO\_0;
462       CHECK\_CUDNN(cudnnGetConvolutionBackwardDataAlgorithm(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
463                                                            m\_kernel\_cudnn\_desc,
464                                                            input\_cudnn\_desc,
465                                                            m\_convolution\_cudnn\_desc,
466                                                            output\_cudnn\_desc,
467                                                            
      CUDNN\_CONVOLUTION\_BWD\_DATA\_SPECIFY\_WORKSPACE\_LIMIT,
468                                                            work\_space\_size,
469                                                            &transposed\_convolution\_cudnn\_algorithm));
470 
471       \textcolor{comment}{// Perform transposed convolution}
472       CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
473       CHECK\_CUDNN(cudnnSetStream(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
474                                  this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_stream(i)));
475       CHECK\_CUDNN(cudnnConvolutionBackwardData(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
476                                                &one,
477                                                m\_kernel\_cudnn\_desc,
478                                                kernel\_d[i],
479                                                input\_cudnn\_desc,
480                                                input\_d.get\_locked\_data(i),
481                                                m\_convolution\_cudnn\_desc,
482                                                transposed\_convolution\_cudnn\_algorithm,
483                                                work\_spaces\_d[i],
484                                                work\_space\_size,
485                                                &mixing\_factor,
486                                                output\_cudnn\_desc,
487                                                output\_d.get\_data(i)));
488 
489     \}
490 
491 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
492   \}
\end{DoxyCode}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a130907ca7a8e3b6676bdd4186c788ef4_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a87fb2bf066a98052938e48a82dcd4fd2}\label{classlbann_1_1base__convolution__layer_a87fb2bf066a98052938e48a82dcd4fd2}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!apply\+\_\+transposed\+\_\+convolution\+\_\+im2col@{apply\+\_\+transposed\+\_\+convolution\+\_\+im2col}}
\index{apply\+\_\+transposed\+\_\+convolution\+\_\+im2col@{apply\+\_\+transposed\+\_\+convolution\+\_\+im2col}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{apply\+\_\+transposed\+\_\+convolution\+\_\+im2col()}{apply\_transposed\_convolution\_im2col()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::apply\+\_\+transposed\+\_\+convolution\+\_\+im2col (\begin{DoxyParamCaption}\item[{bool}]{during\+\_\+forward\+\_\+prop }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}}

Transposed convolution with im2col G\+E\+MM algorithm. 

Definition at line 685 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
685                                                                      \{
686 
687     \textcolor{comment}{// Local matrices}
688     \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_kernel = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values().LockedMatrix();
689     \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_input = (during\_forward\_prop ?
690                                \hyperlink{classlbann_1_1Layer_a35397843bb0c84030000c7d872229acb}{get\_local\_prev\_activations}() :
691                                \hyperlink{classlbann_1_1Layer_a82827edc5e869960144f3ccb2172bfcd}{get\_local\_prev\_error\_signals}());
692     \textcolor{keyword}{auto}& local\_output = (during\_forward\_prop ?
693                           \hyperlink{classlbann_1_1Layer_a4248f27acebf72b7b7b3ee39c8bcb62a}{get\_local\_activations}() :
694                           \hyperlink{classlbann_1_1Layer_af178d00b9d878aa7d87754bff2a91f3a}{get\_local\_error\_signals}());
695 
696     \textcolor{comment}{// Matrix parameters}
697     \textcolor{keyword}{const} \textcolor{keywordtype}{int} input\_size = local\_input.Height();
698     \textcolor{keyword}{const} \textcolor{keywordtype}{int} output\_size = local\_output.Height();
699     \textcolor{keyword}{const} El::Int local\_width = local\_input.Width();
700     std::vector<int> input\_dims, output\_dims;
701     \textcolor{keywordflow}{if} (during\_forward\_prop) \{
702       input\_dims = this->\hyperlink{classlbann_1_1Layer_ae204d1a2a79606eaa117273857ff62a3}{m\_prev\_neuron\_dims};
703       output\_dims = this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims};
704     \}
705     \textcolor{keywordflow}{else} \{
706       input\_dims = this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims};
707       output\_dims = this->\hyperlink{classlbann_1_1Layer_ae204d1a2a79606eaa117273857ff62a3}{m\_prev\_neuron\_dims};
708     \}
709 
710     \textcolor{comment}{// Initialize matrices}
711     \textcolor{keyword}{const} \textcolor{keywordtype}{int} m = \hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\_kernel\_size} / input\_dims[0];
712     \textcolor{keyword}{const} \textcolor{keywordtype}{int} n = input\_size / input\_dims[0];
713     \textcolor{keyword}{const} \textcolor{keywordtype}{int} k = input\_dims[0];
714     \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} input\_col, output\_col;
715     \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} im2col\_matrix(m, n);
716     \textcolor{keyword}{const} \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} kernel\_matrix(m, k, local\_kernel.LockedBuffer(), m);
717 
718     \textcolor{comment}{// Iterate through input columns}
719     \textcolor{keywordflow}{for} (El::Int col = 0; col < local\_width; ++col) \{
720 
721       \textcolor{comment}{// Apply transposed convolution to current input column}
722       input\_col.LockedAttach(n, k, local\_input.LockedBuffer(0, col), n);
723       El::Gemm(El::NORMAL, El::TRANSPOSE,
724                DataType(1), kernel\_matrix, input\_col,
725                DataType(0), im2col\_matrix);
726 
727       \textcolor{comment}{// Perform col2im to accumulate contributions from each kernel}
728       \textcolor{comment}{// position}
729       \textcolor{keywordflow}{if} (during\_forward\_prop) \{
730         El::View(output\_col, local\_output, El::ALL, El::IR(col));
731       \} \textcolor{keywordflow}{else} \{
732         output\_col.Resize(output\_size, 1);
733       \}
734       \hyperlink{namespacelbann_a0e1225f72580ffb5166181392b68b651}{col2im}(im2col\_matrix,
735              output\_col,
736              output\_dims[0],
737              output\_dims.size() - 1,
738              &output\_dims[1],
739              \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}.data(),
740              &\hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}[2],
741              \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides}.data());
742       \textcolor{keywordflow}{if} (!during\_forward\_prop) \{
743         local\_output(El::ALL, El::IR(col)) += output\_col;
744       \}
745 
746     \}
747 
748   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a87fb2bf066a98052938e48a82dcd4fd2_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a87fb2bf066a98052938e48a82dcd4fd2_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_afa07aaa293d12cc7d28fbc8a96025900}\label{classlbann_1_1base__convolution__layer_afa07aaa293d12cc7d28fbc8a96025900}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!check\+\_\+setup@{check\+\_\+setup}}
\index{check\+\_\+setup@{check\+\_\+setup}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{check\+\_\+setup()}{check\_setup()}}
{\footnotesize\ttfamily virtual void lbann\+::base\+\_\+convolution\+\_\+layer\+::check\+\_\+setup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Check that the setup is reasonable. 

Reimplemented from \hyperlink{classlbann_1_1Layer_aeec1c710c3d53b5e43a4d4f67b0a21b2}{lbann\+::\+Layer}.



Definition at line 312 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
312                                       \{
313     \hyperlink{classlbann_1_1Layer_aeec1c710c3d53b5e43a4d4f67b0a21b2}{learning\_layer::check\_setup}();
314     std::stringstream err;
315 
316     \textcolor{comment}{// Check that kernel and bias weights are both initialized}
317     \textcolor{keywordflow}{if} (this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}.size() != 2
318         || this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0] == \textcolor{keyword}{nullptr}
319         || this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1] == \textcolor{keyword}{nullptr}) \{
320       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" :: "}
321           << \textcolor{stringliteral}{"invalid weights setup in layer "} << \hyperlink{classlbann_1_1Layer_aa47109ad09b399142fa92f9d3702189f}{m\_name};
322       \textcolor{keywordflow}{throw} lbann\_exception(err.str());
323     \}
324 
325     \textcolor{comment}{// Check that kernel data is contiguous}
326     \textcolor{keyword}{const} \textcolor{keyword}{auto}& kernel = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values();
327     \textcolor{keywordflow}{if} (kernel.LocalWidth() > 1
328         && kernel.LDim() != kernel.LocalHeight()) \{
329       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" :: "}
330           << \textcolor{stringliteral}{"kernel data in layer "} << m\_name << \textcolor{stringliteral}{" "}
331           << \textcolor{stringliteral}{"is not contiguous"};
332       \textcolor{keywordflow}{throw} lbann\_exception(err.str());
333     \}
334 
335     \textcolor{comment}{// Check that kernel gradient data is contiguous}
336     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient}.LocalWidth() > 1
337         && \hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient}.LDim() != \hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient}.LocalHeight()) \{
338       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" :: "}
339           << \textcolor{stringliteral}{"kernel gradient data in layer "} << m\_name << \textcolor{stringliteral}{" "}
340           << \textcolor{stringliteral}{"is not contiguous"};
341       \textcolor{keywordflow}{throw} lbann\_exception(err.str());
342     \}
343 
344   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_afa07aaa293d12cc7d28fbc8a96025900_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_ae46e6a975c443792c606817878dc4446}\label{classlbann_1_1base__convolution__layer_ae46e6a975c443792c606817878dc4446}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!compute\+\_\+gradients\+\_\+cudnn@{compute\+\_\+gradients\+\_\+cudnn}}
\index{compute\+\_\+gradients\+\_\+cudnn@{compute\+\_\+gradients\+\_\+cudnn}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{compute\+\_\+gradients\+\_\+cudnn()}{compute\_gradients\_cudnn()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::compute\+\_\+gradients\+\_\+cudnn (\begin{DoxyParamCaption}\item[{bool}]{using\+\_\+transposed\+\_\+convolution }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}}



Definition at line 519 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
519                                                                   \{
520 \textcolor{preprocessor}{  #ifndef LBANN\_HAS\_CUDNN}
521     \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"base\_convolution\_layer: cuDNN not detected"});
522 \textcolor{preprocessor}{  #else}
523 
524     \textcolor{comment}{// Useful constants}
525     \textcolor{keyword}{const} DataType zero = DataType(0);
526     \textcolor{keyword}{const} DataType one = DataType(1);
527     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_gpus = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_num\_gpus();
528     \textcolor{keyword}{const} \textcolor{keywordtype}{int} effective\_mini\_batch\_size = this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->
      \hyperlink{classlbann_1_1model_a2a9b4cfa1c8c91e4131908751f9c4a6a}{get\_effective\_mini\_batch\_size}();
529 
530     \textcolor{keyword}{const} \textcolor{keyword}{auto}& input\_d = this->m\_prev\_activations\_d[0];
531     \textcolor{keyword}{const} \textcolor{keyword}{auto}& gradient\_wrt\_output\_d = this->m\_prev\_error\_signals\_d[0];
532 
533     \textcolor{comment}{// Compute bias gradient}
534     optimizer* bias\_optimizer = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_optimizer();
535     \textcolor{keywordflow}{if} (bias\_optimizer != \textcolor{keyword}{nullptr} && \hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} != DataType(0)) \{
536       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_gpus; ++i) \{
537         CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
538         CHECK\_CUDNN(cudnnSetStream(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
539                                    this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_stream(i)));
540         CHECK\_CUDNN(cudnnConvolutionBackwardBias(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
541                                                  &one,
542                                                  this->m\_prev\_error\_signals\_cudnn\_desc,
543                                                  gradient\_wrt\_output\_d.get\_locked\_data(i),
544                                                  &zero,
545                                                  m\_bias\_cudnn\_desc,
546                                                  m\_bias\_gradient\_d.get\_data(i)));
547       \}
548       \textcolor{keyword}{const} DataType bias\_scale = \hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} / effective\_mini\_batch\_size;
549       bias\_optimizer->add\_to\_gradient\_staging(m\_bias\_gradient\_d,
550                                               bias\_scale);
551     \}
552 
553     \textcolor{comment}{// Compute kernel gradient}
554     optimizer* kernel\_optimizer = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_optimizer();
555     \textcolor{keywordflow}{if} (kernel\_optimizer != \textcolor{keyword}{nullptr}) \{
556       \textcolor{keyword}{auto}&& work\_spaces\_d = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_work\_spaces();
557       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_gpus; ++i) \{
558         CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
559         CHECK\_CUDNN(cudnnSetStream(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
560                                    this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_stream(i)));
561 
562         \textcolor{comment}{// Determine algorithm and compute kernel gradient}
563         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} work\_space\_size = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_work\_space\_size(i);
564         cudnnConvolutionBwdFilterAlgo\_t kernel\_gradient\_cudnn\_algorithm
565           = CUDNN\_CONVOLUTION\_BWD\_FILTER\_ALGO\_0;
566         \textcolor{keywordflow}{if} (using\_transposed\_convolution) \{
567           CHECK\_CUDNN(cudnnGetConvolutionBackwardFilterAlgorithm(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
568                                                                  this->m\_prev\_error\_signals\_cudnn\_desc,
569                                                                  this->m\_prev\_activations\_cudnn\_desc,
570                                                                  m\_convolution\_cudnn\_desc,
571                                                                  m\_kernel\_cudnn\_desc,
572                                                                  
      CUDNN\_CONVOLUTION\_BWD\_FILTER\_SPECIFY\_WORKSPACE\_LIMIT,
573                                                                  work\_space\_size,
574                                                                  &kernel\_gradient\_cudnn\_algorithm));
575           CHECK\_CUDNN(cudnnConvolutionBackwardFilter(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
576                                                      &one,
577                                                      this->m\_prev\_error\_signals\_cudnn\_desc,
578                                                      gradient\_wrt\_output\_d.get\_locked\_data(i),
579                                                      this->m\_prev\_activations\_cudnn\_desc,
580                                                      input\_d.get\_locked\_data(i),
581                                                      m\_convolution\_cudnn\_desc,
582                                                      kernel\_gradient\_cudnn\_algorithm,
583                                                      work\_spaces\_d[i],
584                                                      work\_space\_size,
585                                                      &zero,
586                                                      m\_kernel\_cudnn\_desc,
587                                                      m\_kernel\_gradient\_d.get\_data(i)));
588         \}
589         \textcolor{keywordflow}{else} \{
590           CHECK\_CUDNN(cudnnGetConvolutionBackwardFilterAlgorithm(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
591                                                                  this->m\_prev\_activations\_cudnn\_desc,
592                                                                  this->m\_prev\_error\_signals\_cudnn\_desc,
593                                                                  m\_convolution\_cudnn\_desc,
594                                                                  m\_kernel\_cudnn\_desc,
595                                                                  
      CUDNN\_CONVOLUTION\_BWD\_FILTER\_SPECIFY\_WORKSPACE\_LIMIT,
596                                                                  work\_space\_size,
597                                                                  &kernel\_gradient\_cudnn\_algorithm));
598           CHECK\_CUDNN(cudnnConvolutionBackwardFilter(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_handle(i),
599                                                      &one,
600                                                      this->m\_prev\_activations\_cudnn\_desc,
601                                                      input\_d.get\_locked\_data(i),
602                                                      this->m\_prev\_error\_signals\_cudnn\_desc,
603                                                      gradient\_wrt\_output\_d.get\_locked\_data(i),
604                                                      m\_convolution\_cudnn\_desc,
605                                                      kernel\_gradient\_cudnn\_algorithm,
606                                                      work\_spaces\_d[i],
607                                                      work\_space\_size,
608                                                      &zero,
609                                                      m\_kernel\_cudnn\_desc,
610                                                      m\_kernel\_gradient\_d.get\_data(i)));
611         \}
612 
613       \}
614 
615       \textcolor{comment}{// Add gradient contribution}
616       \textcolor{keyword}{const} DataType kernel\_scale = one / effective\_mini\_batch\_size;
617       kernel\_optimizer->add\_to\_gradient\_staging(m\_kernel\_gradient\_d,
618                                                 kernel\_scale);
619     \}
620 
621 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
622   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_ae46e6a975c443792c606817878dc4446_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_ae46e6a975c443792c606817878dc4446_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a8cb0b4fb33f058ce6c211ebaf6a17f63}\label{classlbann_1_1base__convolution__layer_a8cb0b4fb33f058ce6c211ebaf6a17f63}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!compute\+\_\+gradients\+\_\+im2col@{compute\+\_\+gradients\+\_\+im2col}}
\index{compute\+\_\+gradients\+\_\+im2col@{compute\+\_\+gradients\+\_\+im2col}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{compute\+\_\+gradients\+\_\+im2col()}{compute\_gradients\_im2col()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::compute\+\_\+gradients\+\_\+im2col (\begin{DoxyParamCaption}\item[{bool}]{using\+\_\+transposed\+\_\+convolution }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [protected]}}



Definition at line 779 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
779                                                                    \{
780 
781     \textcolor{comment}{// Local matrices}
782     \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_input = \hyperlink{classlbann_1_1Layer_a35397843bb0c84030000c7d872229acb}{get\_local\_prev\_activations}();
783     \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_gradient\_wrt\_output = \hyperlink{classlbann_1_1Layer_a82827edc5e869960144f3ccb2172bfcd}{get\_local\_prev\_error\_signals}();
784     \textcolor{keyword}{auto}& local\_kernel\_gradient = \hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient}.Matrix();
785     \textcolor{keyword}{auto}& local\_bias\_gradient = \hyperlink{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}{m\_bias\_gradient}.Matrix();
786     
787     \textcolor{comment}{// Get convolution parameters}
788     \textcolor{keyword}{const} El::Int local\_width = local\_input.Width();
789     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_input\_channels = this->\hyperlink{classlbann_1_1Layer_ae204d1a2a79606eaa117273857ff62a3}{m\_prev\_neuron\_dims}[0];
790     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_output\_channels = this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims}[0];
791     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_per\_output\_channel = this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons} / num\_output\_channels;
792     \textcolor{keyword}{const} \textcolor{keywordtype}{int} effective\_mini\_batch\_size = this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->
      \hyperlink{classlbann_1_1model_a2a9b4cfa1c8c91e4131908751f9c4a6a}{get\_effective\_mini\_batch\_size}();
793 
794     \textcolor{comment}{// Compute bias gradient}
795     \textcolor{comment}{// Note: Sum is computed with Kahan summation}
796     optimizer* bias\_optimizer = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_optimizer();
797     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} != DataType(0) && bias\_optimizer != \textcolor{keyword}{nullptr}) \{
798 \textcolor{preprocessor}{      #pragma omp parallel for}
799       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} channel = 0; channel < num\_output\_channels; ++channel) \{
800         \textcolor{keyword}{const} El::Int row\_start = channel * num\_per\_output\_channel;
801         \textcolor{keyword}{const} El::Int row\_end = (channel+1) * num\_per\_output\_channel;
802         DataType sum = 0;
803         DataType correction = 0;
804         \textcolor{keywordflow}{for} (El::Int col = 0; col < local\_width; ++col) \{
805           \textcolor{keywordflow}{for} (El::Int row = row\_start; row < row\_end; ++row) \{
806             DataType term = local\_gradient\_wrt\_output(row, col);
807             term += correction;
808             \textcolor{keyword}{const} DataType next\_sum = sum + term;
809             correction = term - (next\_sum - sum);
810             sum = next\_sum;
811           \}
812         \}
813         local\_bias\_gradient(channel, 0) = \hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} * sum;
814       \}
815       \textcolor{keyword}{const} DataType bias\_scale = \hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} / effective\_mini\_batch\_size;
816       bias\_optimizer->add\_to\_gradient\_staging(\hyperlink{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}{m\_bias\_gradient},
817                                               bias\_scale);
818     \}
819 
820     \textcolor{comment}{// Stop early if kernel is not being optimized}
821     optimizer* kernel\_optimizer = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_optimizer();
822     \textcolor{keywordflow}{if} (kernel\_optimizer == \textcolor{keyword}{nullptr}) \{ \textcolor{keywordflow}{return}; \}
823 
824     \textcolor{comment}{// Initialize matrices}
825     \textcolor{keyword}{const} \textcolor{keywordtype}{int} m = (using\_transposed\_convolution ?
826                    \hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\_kernel\_size} / num\_input\_channels :
827                    \hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\_kernel\_size} / num\_output\_channels);
828     \textcolor{keyword}{const} \textcolor{keywordtype}{int} n = (using\_transposed\_convolution ?
829                    num\_input\_channels :
830                    num\_output\_channels);
831     \textcolor{keyword}{const} \textcolor{keywordtype}{int} k = (using\_transposed\_convolution ?
832                    this->\hyperlink{classlbann_1_1Layer_ac7b30f4e28d58204bfcbb76886f9136d}{m\_num\_prev\_neurons} / num\_input\_channels :
833                    this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons} / num\_output\_channels);
834     \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} im2col\_matrix(m, k);
835     \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} kernel\_gradient\_matrix(m, n, local\_kernel\_gradient.Buffer(), m);
836     El::Zero(kernel\_gradient\_matrix);
837 
838     \textcolor{comment}{// Compute kernel gradient contributions from each data sample}
839     \textcolor{keywordflow}{for} (El::Int col = 0; col < local\_width; ++col) \{
840       \textcolor{keywordflow}{if} (using\_transposed\_convolution) \{
841         \textcolor{keyword}{const} \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} input\_col(k, n, local\_input.LockedBuffer(0,col), k);
842         \textcolor{keyword}{const} \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} gradient\_wrt\_output\_col
843           = El::LockedView(local\_gradient\_wrt\_output, El::ALL, El::IR(col));
844         \hyperlink{namespacelbann_aa3636a1979e40da2af91f30a12b90db9}{im2col}(gradient\_wrt\_output\_col,
845                im2col\_matrix,
846                num\_output\_channels,
847                this->\hyperlink{classlbann_1_1Layer_adfd6178d21498c9095cd947ae1eb2d6a}{m\_num\_neuron\_dims} - 1,
848                &this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims}[1],
849                \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}.data(),
850                &\hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}[2],
851                \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides}.data());
852         El::Gemm(El::NORMAL, El::NORMAL,
853                  DataType(1), im2col\_matrix, input\_col,
854                  DataType(1), kernel\_gradient\_matrix);
855       \}
856       \textcolor{keywordflow}{else} \{
857         \textcolor{keyword}{const} \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} input\_col
858           = El::LockedView(local\_input, El::ALL, El::IR(col));
859         \textcolor{keyword}{const} \hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} gradient\_wrt\_output\_col(k, n, local\_gradient\_wrt\_output.LockedBuffer(0,col), k);
860         \hyperlink{namespacelbann_aa3636a1979e40da2af91f30a12b90db9}{im2col}(input\_col,
861                im2col\_matrix,
862                num\_input\_channels,
863                this->\hyperlink{classlbann_1_1Layer_adc052afb38f170e839db00d3c8151d1e}{m\_num\_prev\_neuron\_dims} - 1,
864                &this->\hyperlink{classlbann_1_1Layer_ae204d1a2a79606eaa117273857ff62a3}{m\_prev\_neuron\_dims}[1],
865                \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}.data(),
866                &\hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}[2],
867                \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides}.data());
868         El::Gemm(El::NORMAL, El::NORMAL,
869                  DataType(1), im2col\_matrix, gradient\_wrt\_output\_col,
870                  DataType(1), kernel\_gradient\_matrix);
871       \}
872     \}
873 
874     \textcolor{comment}{// Scale and accumulate gradients}
875     \textcolor{keyword}{const} DataType kernel\_scale = DataType(1) / effective\_mini\_batch\_size;
876     kernel\_optimizer->add\_to\_gradient\_staging(\hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient},
877                                               kernel\_scale);
878 
879   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a8cb0b4fb33f058ce6c211ebaf6a17f63_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a8cb0b4fb33f058ce6c211ebaf6a17f63_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_ad31a2eac6843bd8643538530f1017c32}\label{classlbann_1_1base__convolution__layer_ad31a2eac6843bd8643538530f1017c32}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!operator=@{operator=}}
\index{operator=@{operator=}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{operator=()}{operator=()}}
{\footnotesize\ttfamily \hyperlink{classlbann_1_1base__convolution__layer}{base\+\_\+convolution\+\_\+layer}\& lbann\+::base\+\_\+convolution\+\_\+layer\+::operator= (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1base__convolution__layer}{base\+\_\+convolution\+\_\+layer} \&}]{other }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 170 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
170                                                                          \{
171     \hyperlink{classlbann_1_1Layer_a00d8acde68fda2f38c4a39ef8c89234a}{learning\_layer::operator=}(other);
172     \hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims} = other.m\_kernel\_dims;
173     \hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\_kernel\_size} = other.m\_kernel\_size;
174     \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads} = other.m\_pads;
175     \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides} = other.m\_strides;
176     \hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} = other.m\_bias\_scaling\_factor;
177     \hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient} = other.m\_kernel\_gradient;
178     \hyperlink{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}{m\_bias\_gradient} = other.m\_bias\_gradient;
179 
180 \textcolor{preprocessor}{  #ifdef LBANN\_HAS\_CUDNN}
181 
182     \textcolor{comment}{// Copy cuDNN objects}
183     cudnn::copy\_tensor\_cudnn\_desc(other.m\_bias\_cudnn\_desc,
184                                   m\_bias\_cudnn\_desc);
185     cudnn::copy\_kernel\_cudnn\_desc(other.m\_kernel\_cudnn\_desc,
186                                   m\_kernel\_cudnn\_desc);
187     cudnn::copy\_convolution\_cudnn\_desc(other.m\_convolution\_cudnn\_desc,
188                                        m\_convolution\_cudnn\_desc);
189 
190     \textcolor{comment}{// Copy GPU data}
191     m\_kernel\_gradient\_d = other.m\_kernel\_gradient\_d;
192     m\_bias\_gradient\_d = other.m\_bias\_gradient\_d;
193 
194 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
195 
196     \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
197   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_ad31a2eac6843bd8643538530f1017c32_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a9f850c1bdf4ae3cd986411d3cb3a524c}\label{classlbann_1_1base__convolution__layer_a9f850c1bdf4ae3cd986411d3cb3a524c}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!setup\+\_\+data@{setup\+\_\+data}}
\index{setup\+\_\+data@{setup\+\_\+data}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{setup\+\_\+data()}{setup\_data()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::setup\+\_\+data (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Setup layer data. The kernel weights are setup in the convolution and deconvolution classes. 

Reimplemented from \hyperlink{classlbann_1_1Layer_a50a89f8a68762c677d48efe384676e81}{lbann\+::\+Layer}.



Reimplemented in \hyperlink{classlbann_1_1convolution__layer_ab20636b44d2b17abdb5424df54cb9c6d}{lbann\+::convolution\+\_\+layer$<$ T\+\_\+layout $>$}, and \hyperlink{classlbann_1_1deconvolution__layer_a6d891396ea1c91030cd647cc111c8c5f}{lbann\+::deconvolution\+\_\+layer$<$ T\+\_\+layout $>$}.



Definition at line 217 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
217                              \{
218     \hyperlink{classlbann_1_1Layer_a50a89f8a68762c677d48efe384676e81}{learning\_layer::setup\_data}();
219 
220     \textcolor{comment}{// Initialize default weights if none are provided}
221     \textcolor{keywordflow}{if} (this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}.size() > 2) \{
222       std::stringstream err;
223       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" :: "}
224           << \textcolor{stringliteral}{"attempted to setup "} << \hyperlink{classlbann_1_1Layer_aa47109ad09b399142fa92f9d3702189f}{m\_name} << \textcolor{stringliteral}{" with an invalid number of weights"};
225       \textcolor{keywordflow}{throw} lbann\_exception(err.str());
226     \}
227     this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}.resize(2, \textcolor{keyword}{nullptr});
228     \textcolor{keywordflow}{if} (this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0] == \textcolor{keyword}{nullptr}) \{
229       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0] = \textcolor{keyword}{new} weights(this->\hyperlink{classlbann_1_1Layer_a5de05c52f22e0bbd7c703bec3ad4dbf2}{m\_comm}, this->
      \hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn});
230       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->set\_name(this->m\_name + \textcolor{stringliteral}{"\_kernel"});
231       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->set\_initializer(\textcolor{keyword}{new} he\_normal\_initializer(this->
      \hyperlink{classlbann_1_1Layer_a5de05c52f22e0bbd7c703bec3ad4dbf2}{m\_comm}));
232       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->set\_optimizer(\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->
      \hyperlink{classlbann_1_1model_a0d2d5a1eac592e5721a81a9b9ea4b7f2}{create\_optimizer}());
233       this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->\hyperlink{classlbann_1_1model_af35fca77e75eb6dd570e4727aa3d5b6b}{add\_weights}(this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]);
234     \}
235     \textcolor{keywordflow}{if} (this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1] == \textcolor{keyword}{nullptr}) \{
236       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1] = \textcolor{keyword}{new} weights(this->\hyperlink{classlbann_1_1Layer_a5de05c52f22e0bbd7c703bec3ad4dbf2}{m\_comm}, this->
      \hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn});
237       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->set\_name(this->m\_name + \textcolor{stringliteral}{"\_bias"});
238       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->set\_initializer(\textcolor{keyword}{new} constant\_initializer(this->
      \hyperlink{classlbann_1_1Layer_a5de05c52f22e0bbd7c703bec3ad4dbf2}{m\_comm}, DataType(0)));
239       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->set\_optimizer(\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->
      \hyperlink{classlbann_1_1model_a0d2d5a1eac592e5721a81a9b9ea4b7f2}{create\_optimizer}());
240       this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->\hyperlink{classlbann_1_1model_af35fca77e75eb6dd570e4727aa3d5b6b}{add\_weights}(this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]);
241     \}
242 
243     \textcolor{comment}{// Initialize Glorot or He weight initialization}
244     \textcolor{keyword}{auto}* cast\_initializer
245       = \textcolor{keyword}{dynamic\_cast<}fan\_in\_fan\_out\_initializer*\textcolor{keyword}{>}(&this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_initializer());
246     \textcolor{keywordflow}{if} (cast\_initializer != \textcolor{keyword}{nullptr}) \{
247       cast\_initializer->set\_fan\_in(\hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\_kernel\_size} / this->
      \hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims}[0]);
248       cast\_initializer->set\_fan\_out(\hyperlink{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}{m\_kernel\_size} / this->
      \hyperlink{classlbann_1_1Layer_ae204d1a2a79606eaa117273857ff62a3}{m\_prev\_neuron\_dims}[0]);
249     \}
250 
251     \textcolor{comment}{// Initialize bias}
252     this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->setup(this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims}[0]);
253     El::Zeros(\hyperlink{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}{m\_bias\_gradient},
254               this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_matrix\_height(),
255               this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_matrix\_width());
256 
257     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1Layer_afdc60df9731a3ecdeeeb8175fa483676}{m\_frozen}) \{
258       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->freeze();
259       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->freeze();
260     \} \textcolor{keywordflow}{else} \{
261       \textcolor{keywordflow}{if} (this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->\hyperlink{classlbann_1_1Layer_af3c0f9f32eb631f4fdf34ad040ef8637}{is\_frozen}() || this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->
      \hyperlink{classlbann_1_1Layer_af3c0f9f32eb631f4fdf34ad040ef8637}{is\_frozen}()) \{
262         \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"base\_convolution\_layer: layer is not frozen but weights are"});
263       \}
264     \}
265   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a9f850c1bdf4ae3cd986411d3cb3a524c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=348pt]{classlbann_1_1base__convolution__layer_a9f850c1bdf4ae3cd986411d3cb3a524c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a4fb0ec8793656a7c32ff37c266b29a68}\label{classlbann_1_1base__convolution__layer_a4fb0ec8793656a7c32ff37c266b29a68}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!setup\+\_\+gpu@{setup\+\_\+gpu}}
\index{setup\+\_\+gpu@{setup\+\_\+gpu}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{setup\+\_\+gpu()}{setup\_gpu()}}
{\footnotesize\ttfamily void lbann\+::base\+\_\+convolution\+\_\+layer\+::setup\+\_\+gpu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Initialize G\+PU objects. 



Reimplemented from \hyperlink{classlbann_1_1Layer_a36aa22ef90ce4de65abe729d38490863}{lbann\+::\+Layer}.



Definition at line 268 of file base\+\_\+convolution.\+hpp.


\begin{DoxyCode}
268                             \{
269     \hyperlink{classlbann_1_1Layer_a36aa22ef90ce4de65abe729d38490863}{learning\_layer::setup\_gpu}();
270 \textcolor{preprocessor}{  #ifndef LBANN\_HAS\_CUDNN}
271     \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"base\_convolution\_layer: cuDNN not detected"});
272 \textcolor{preprocessor}{  #else}
273 
274     \textcolor{comment}{// Set kernel descriptor}
275     CHECK\_CUDNN(cudnnCreateFilterDescriptor(&m\_kernel\_cudnn\_desc));
276     CHECK\_CUDNN(cudnnSetFilterNdDescriptor(m\_kernel\_cudnn\_desc,
277                                            cudnn::get\_cudnn\_data\_type(),
278                                            CUDNN\_TENSOR\_NCHW,
279                                            \hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}.size(),
280                                            \hyperlink{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}{m\_kernel\_dims}.data()));
281 
282     \textcolor{comment}{// Set convolution descriptor}
283     \textcolor{comment}{// Note: upscales are not supported as of cuDNN v5.1}
284     CHECK\_CUDNN(cudnnCreateConvolutionDescriptor(&m\_convolution\_cudnn\_desc));
285     std::vector<int> upscales(this->\hyperlink{classlbann_1_1Layer_adfd6178d21498c9095cd947ae1eb2d6a}{m\_num\_neuron\_dims}-1, 1);
286     CHECK\_CUDNN(cudnnSetConvolutionNdDescriptor(m\_convolution\_cudnn\_desc,
287                                                 \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}.size(),
288                                                 \hyperlink{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}{m\_pads}.data(),
289                                                 \hyperlink{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}{m\_strides}.data(),
290                                                 upscales.data(),
291                                                 CUDNN\_CROSS\_CORRELATION,
292                                                 cudnn::get\_cudnn\_data\_type()));
293 
294     \textcolor{comment}{// Set bias tensor descriptor}
295     std::vector<int> bias\_dims(this->\hyperlink{classlbann_1_1Layer_adfd6178d21498c9095cd947ae1eb2d6a}{m\_num\_neuron\_dims}, 1);
296     bias\_dims[0] = this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims}[0];
297     cudnn::set\_tensor\_cudnn\_desc(m\_bias\_cudnn\_desc, 1, bias\_dims);
298 
299     \textcolor{comment}{// Allocate GPU memory}
300     m\_kernel\_gradient\_d = cudnn::matrix(\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn},
301                                         \hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient}.Height(),
302                                         \hyperlink{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}{m\_kernel\_gradient}.Width());
303     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}{m\_bias\_scaling\_factor} != DataType(0)) \{
304       m\_bias\_gradient\_d = cudnn::matrix(\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn},
305                                         \hyperlink{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}{m\_bias\_gradient}.Height(),
306                                         \hyperlink{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}{m\_bias\_gradient}.Width());
307     \}
308 
309 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
310   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1base__convolution__layer_a4fb0ec8793656a7c32ff37c266b29a68_cgraph}
\end{center}
\end{figure}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}\label{classlbann_1_1base__convolution__layer_a2ee1db4a1a74f167e3472d5ed7075179}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!m\+\_\+bias\+\_\+gradient@{m\+\_\+bias\+\_\+gradient}}
\index{m\+\_\+bias\+\_\+gradient@{m\+\_\+bias\+\_\+gradient}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+bias\+\_\+gradient}{m\_bias\_gradient}}
{\footnotesize\ttfamily \hyperlink{base_8hpp_aba08580d21767b53d0737e115d738dbe}{Star\+Mat} lbann\+::base\+\_\+convolution\+\_\+layer\+::m\+\_\+bias\+\_\+gradient\hspace{0.3cm}{\ttfamily [protected]}}

Bias gradient. This is this layer\textquotesingle{}s contribution to the objective function gradient w.\+r.\+t. the bias weights. 

Definition at line 75 of file base\+\_\+convolution.\+hpp.

\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}\label{classlbann_1_1base__convolution__layer_a5abe0bcd128b66a41fa481b28a9c2104}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!m\+\_\+bias\+\_\+scaling\+\_\+factor@{m\+\_\+bias\+\_\+scaling\+\_\+factor}}
\index{m\+\_\+bias\+\_\+scaling\+\_\+factor@{m\+\_\+bias\+\_\+scaling\+\_\+factor}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+bias\+\_\+scaling\+\_\+factor}{m\_bias\_scaling\_factor}}
{\footnotesize\ttfamily Data\+Type lbann\+::base\+\_\+convolution\+\_\+layer\+::m\+\_\+bias\+\_\+scaling\+\_\+factor\hspace{0.3cm}{\ttfamily [protected]}}

Scaling factor for bias term. If the scaling factor is zero, bias is not applied. 

Definition at line 64 of file base\+\_\+convolution.\+hpp.

\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}\label{classlbann_1_1base__convolution__layer_a283edb6a476f975e713d0b4235ac658f}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!m\+\_\+kernel\+\_\+dims@{m\+\_\+kernel\+\_\+dims}}
\index{m\+\_\+kernel\+\_\+dims@{m\+\_\+kernel\+\_\+dims}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+kernel\+\_\+dims}{m\_kernel\_dims}}
{\footnotesize\ttfamily std\+::vector$<$int$>$ lbann\+::base\+\_\+convolution\+\_\+layer\+::m\+\_\+kernel\+\_\+dims\hspace{0.3cm}{\ttfamily [protected]}}

Convolution kernel dimensions. 

Definition at line 52 of file base\+\_\+convolution.\+hpp.

\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}\label{classlbann_1_1base__convolution__layer_a4129f11df61ed92bcad24ae855d7bd11}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!m\+\_\+kernel\+\_\+gradient@{m\+\_\+kernel\+\_\+gradient}}
\index{m\+\_\+kernel\+\_\+gradient@{m\+\_\+kernel\+\_\+gradient}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+kernel\+\_\+gradient}{m\_kernel\_gradient}}
{\footnotesize\ttfamily \hyperlink{base_8hpp_aba08580d21767b53d0737e115d738dbe}{Star\+Mat} lbann\+::base\+\_\+convolution\+\_\+layer\+::m\+\_\+kernel\+\_\+gradient\hspace{0.3cm}{\ttfamily [protected]}}

Convolutional kernel gradient. This is this layer\textquotesingle{}s contribution to the objective function gradient w.\+r.\+t. the convolutional kernel weights. 

Definition at line 70 of file base\+\_\+convolution.\+hpp.

\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}\label{classlbann_1_1base__convolution__layer_aa9da3e44499643a86bd611b5eb500dd4}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!m\+\_\+kernel\+\_\+size@{m\+\_\+kernel\+\_\+size}}
\index{m\+\_\+kernel\+\_\+size@{m\+\_\+kernel\+\_\+size}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+kernel\+\_\+size}{m\_kernel\_size}}
{\footnotesize\ttfamily int lbann\+::base\+\_\+convolution\+\_\+layer\+::m\+\_\+kernel\+\_\+size\hspace{0.3cm}{\ttfamily [protected]}}

Size of convolutional kernel. 

Definition at line 54 of file base\+\_\+convolution.\+hpp.

\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}\label{classlbann_1_1base__convolution__layer_a9732a8a0170a413bf0cde0128ad2a571}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!m\+\_\+pads@{m\+\_\+pads}}
\index{m\+\_\+pads@{m\+\_\+pads}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+pads}{m\_pads}}
{\footnotesize\ttfamily std\+::vector$<$int$>$ lbann\+::base\+\_\+convolution\+\_\+layer\+::m\+\_\+pads\hspace{0.3cm}{\ttfamily [protected]}}

Convolution padding. 

Definition at line 56 of file base\+\_\+convolution.\+hpp.

\mbox{\Hypertarget{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}\label{classlbann_1_1base__convolution__layer_a2429495822363e41f1f6b96a6b430445}} 
\index{lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}!m\+\_\+strides@{m\+\_\+strides}}
\index{m\+\_\+strides@{m\+\_\+strides}!lbann\+::base\+\_\+convolution\+\_\+layer@{lbann\+::base\+\_\+convolution\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+strides}{m\_strides}}
{\footnotesize\ttfamily std\+::vector$<$int$>$ lbann\+::base\+\_\+convolution\+\_\+layer\+::m\+\_\+strides\hspace{0.3cm}{\ttfamily [protected]}}

Convolution strides. 

Definition at line 58 of file base\+\_\+convolution.\+hpp.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/include/lbann/layers/learning/\hyperlink{base__convolution_8hpp}{base\+\_\+convolution.\+hpp}\end{DoxyCompactItemize}
