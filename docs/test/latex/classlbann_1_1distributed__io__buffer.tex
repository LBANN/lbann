\hypertarget{classlbann_1_1distributed__io__buffer}{}\section{lbann\+:\+:distributed\+\_\+io\+\_\+buffer Class Reference}
\label{classlbann_1_1distributed__io__buffer}\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}


{\ttfamily \#include $<$distributed\+\_\+io\+\_\+buffer.\+hpp$>$}



Inheritance diagram for lbann\+:\+:distributed\+\_\+io\+\_\+buffer\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=203pt]{classlbann_1_1distributed__io__buffer__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for lbann\+:\+:distributed\+\_\+io\+\_\+buffer\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1distributed__io__buffer__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
typedef std\+::map$<$ \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}, \hyperlink{classlbann_1_1data__buffer}{data\+\_\+buffer} $\ast$ $>$ \hyperlink{classlbann_1_1distributed__io__buffer_a7567d3d06f96b001c118f9979bebb0b9}{data\+\_\+buffer\+\_\+map\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classlbann_1_1distributed__io__buffer_a2066033e844ec7b9b95dfe7615a0a256}{distributed\+\_\+io\+\_\+buffer} (\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}, int num\+\_\+parallel\+\_\+readers, std\+::map$<$ \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}, \hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$$>$ data\+\_\+readers)
\item 
\hyperlink{classlbann_1_1distributed__io__buffer_a245c5c4a6ed1af66abc97314031a4c24}{distributed\+\_\+io\+\_\+buffer} (const \hyperlink{classlbann_1_1distributed__io__buffer}{distributed\+\_\+io\+\_\+buffer} \&other)
\item 
\hyperlink{classlbann_1_1distributed__io__buffer}{distributed\+\_\+io\+\_\+buffer} \& \hyperlink{classlbann_1_1distributed__io__buffer_a021724e36cc803bb8dabd747d1f49035}{operator=} (const \hyperlink{classlbann_1_1distributed__io__buffer}{distributed\+\_\+io\+\_\+buffer} \&other)
\item 
virtual \hyperlink{classlbann_1_1distributed__io__buffer_ad55b621729dc0bfea498af2c232dc43c}{$\sim$distributed\+\_\+io\+\_\+buffer} ()
\item 
\hyperlink{classlbann_1_1distributed__io__buffer}{distributed\+\_\+io\+\_\+buffer} $\ast$ \hyperlink{classlbann_1_1distributed__io__buffer_a86a931528aa7a6e178cf6b55bf153881}{copy} () const override
\item 
std\+::string \hyperlink{classlbann_1_1distributed__io__buffer_a58e30ff6d96678b35b2470e1d292967c}{get\+\_\+type} () const override
\item 
void \hyperlink{classlbann_1_1distributed__io__buffer_a6bdf8f670edc92902ee6222dde434c39}{set\+\_\+local\+\_\+matrix\+\_\+bypass} (\hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} $\ast$M\+\_\+local) override
\item 
void \hyperlink{classlbann_1_1distributed__io__buffer_a996d9d20ad162b3edb06fb8aa04ecd3d}{set\+\_\+std\+\_\+matrix\+\_\+view} (El\+::\+Int cur\+\_\+mini\+\_\+batch\+\_\+size) override
\item 
void \hyperlink{classlbann_1_1distributed__io__buffer_aec36cf1d148646f0e27d5939664f02d8}{setup\+\_\+data} (El\+::\+Int num\+\_\+neurons, El\+::\+Int max\+\_\+minibatch\+\_\+size) override
\item 
int \hyperlink{classlbann_1_1distributed__io__buffer_abfeb87d4dc402b482db60926ca9b3ec1}{fetch\+\_\+to\+\_\+local\+\_\+matrix} (\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$data\+\_\+reader, \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode} mode) override
\item 
void \hyperlink{classlbann_1_1distributed__io__buffer_a3a770ec2314313761d6f0eccdb9dc09b}{distribute\+\_\+from\+\_\+local\+\_\+matrix} (\hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat} \&Ms, \hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$data\+\_\+reader, \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode} mode) override
\item 
bool \hyperlink{classlbann_1_1distributed__io__buffer_a2e214f6542d9b12c8a29bf41d0ee220e}{is\+\_\+data\+\_\+set\+\_\+processed} (\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$data\+\_\+reader, \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode} mode) override
\item 
void \hyperlink{classlbann_1_1distributed__io__buffer_af63a8b162ed869393c5b604c5913c631}{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch} (int num\+\_\+models, int model\+\_\+rank, int max\+\_\+mini\+\_\+batch\+\_\+size, \hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$data\+\_\+reader)
\item 
void \hyperlink{classlbann_1_1distributed__io__buffer_aa1f5200f9646d38fe3b3adaf39645330}{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+spanning\+\_\+models} (int max\+\_\+mini\+\_\+batch\+\_\+size, \hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$data\+\_\+reader) override
\item 
void \hyperlink{classlbann_1_1distributed__io__buffer_a2a611c36620155646e46e065e040541f}{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+single\+\_\+model} (int max\+\_\+mini\+\_\+batch\+\_\+size, \hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$data\+\_\+reader) override
\item 
int \hyperlink{classlbann_1_1distributed__io__buffer_af6653723714cf8cf51a928fc9f6e6728}{compute\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers} (long data\+\_\+set\+\_\+size, int mini\+\_\+batch\+\_\+size, int requested\+\_\+num\+\_\+parallel\+\_\+readers) const override
\item 
\hyperlink{classlbann_1_1data__buffer}{data\+\_\+buffer} $\ast$ \hyperlink{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e}{get\+\_\+data\+\_\+buffer} (const \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode} mode) const
\item 
virtual int \hyperlink{classlbann_1_1distributed__io__buffer_a9d7cd67615c71ec7a94533c29796e4ab}{current\+\_\+root\+\_\+rank} (\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode} mode) const
\begin{DoxyCompactList}\small\item\em Return the rank of the current root node for the Elemental Distribution. \end{DoxyCompactList}\item 
bool \hyperlink{classlbann_1_1distributed__io__buffer_a6fe05935e14186d2dd1975ecab9be10e}{is\+\_\+current\+\_\+root} (\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode} mode) const
\begin{DoxyCompactList}\small\item\em Is this rank the current root node for the Elemental Distribution. \end{DoxyCompactList}\item 
virtual bool \hyperlink{classlbann_1_1distributed__io__buffer_a484e3a609b32218890327d7578116aa2}{is\+\_\+local\+\_\+reader\+\_\+done} (\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode} mode) const
\begin{DoxyCompactList}\small\item\em Is the local reader done. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{classlbann_1_1distributed__io__buffer_aa14580fd9d0e8806dc161745525a60dc}{m\+\_\+requested\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers}
\item 
\hyperlink{classlbann_1_1distributed__io__buffer_a7567d3d06f96b001c118f9979bebb0b9}{data\+\_\+buffer\+\_\+map\+\_\+t} \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\+\_\+data\+\_\+buffers}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Parallel I/O routines for managing distributed minibatches 

Definition at line 67 of file distributed\+\_\+io\+\_\+buffer.\+hpp.



\subsection{Member Typedef Documentation}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a7567d3d06f96b001c118f9979bebb0b9}\label{classlbann_1_1distributed__io__buffer_a7567d3d06f96b001c118f9979bebb0b9}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!data\+\_\+buffer\+\_\+map\+\_\+t@{data\+\_\+buffer\+\_\+map\+\_\+t}}
\index{data\+\_\+buffer\+\_\+map\+\_\+t@{data\+\_\+buffer\+\_\+map\+\_\+t}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{data\+\_\+buffer\+\_\+map\+\_\+t}{data\_buffer\_map\_t}}
{\footnotesize\ttfamily typedef std\+::map$<$\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}, \hyperlink{classlbann_1_1data__buffer}{data\+\_\+buffer} $\ast$$>$ \hyperlink{classlbann_1_1distributed__io__buffer_a7567d3d06f96b001c118f9979bebb0b9}{lbann\+::distributed\+\_\+io\+\_\+buffer\+::data\+\_\+buffer\+\_\+map\+\_\+t}}



Definition at line 69 of file distributed\+\_\+io\+\_\+buffer.\+hpp.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a2066033e844ec7b9b95dfe7615a0a256}\label{classlbann_1_1distributed__io__buffer_a2066033e844ec7b9b95dfe7615a0a256}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!distributed\+\_\+io\+\_\+buffer@{distributed\+\_\+io\+\_\+buffer}}
\index{distributed\+\_\+io\+\_\+buffer@{distributed\+\_\+io\+\_\+buffer}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{distributed\+\_\+io\+\_\+buffer()}{distributed\_io\_buffer()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily lbann\+::distributed\+\_\+io\+\_\+buffer\+::distributed\+\_\+io\+\_\+buffer (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$}]{comm,  }\item[{int}]{num\+\_\+parallel\+\_\+readers,  }\item[{std\+::map$<$ \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}, \hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$$>$}]{data\+\_\+readers }\end{DoxyParamCaption})}



Definition at line 30 of file distributed\+\_\+io\+\_\+buffer.\+cpp.


\begin{DoxyCode}
31   : \hyperlink{classlbann_1_1generic__io__buffer_a21e2ef867da6fb0fa334d751ae6b692f}{generic\_io\_buffer}(\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}, num\_parallel\_readers, data\_readers),
32     \hyperlink{classlbann_1_1distributed__io__buffer_aa14580fd9d0e8806dc161745525a60dc}{m\_requested\_max\_num\_parallel\_readers}(num\_parallel\_readers) \{
33   \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}[\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8ac185ddac8b5a8f5aa23c5b80bc12d214}{execution\_mode::training}] = \textcolor{keyword}{new} data\_buffer(
      \hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm});
34   \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}[\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8aa617908b172c473cb8e8cda059e55bf0}{execution\_mode::validation}] = \textcolor{keyword}{new} data\_buffer(
      \hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm});
35   \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}[\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8aae2b1fca515949e5d54fb22b8ed95575}{execution\_mode::testing}] = \textcolor{keyword}{new} data\_buffer(
      \hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm});
36 \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a245c5c4a6ed1af66abc97314031a4c24}\label{classlbann_1_1distributed__io__buffer_a245c5c4a6ed1af66abc97314031a4c24}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!distributed\+\_\+io\+\_\+buffer@{distributed\+\_\+io\+\_\+buffer}}
\index{distributed\+\_\+io\+\_\+buffer@{distributed\+\_\+io\+\_\+buffer}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{distributed\+\_\+io\+\_\+buffer()}{distributed\_io\_buffer()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily lbann\+::distributed\+\_\+io\+\_\+buffer\+::distributed\+\_\+io\+\_\+buffer (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1distributed__io__buffer}{distributed\+\_\+io\+\_\+buffer} \&}]{other }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 74 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
74                                                             :
75     \hyperlink{classlbann_1_1generic__io__buffer_a21e2ef867da6fb0fa334d751ae6b692f}{generic\_io\_buffer}(other) \{
76     \hyperlink{classlbann_1_1distributed__io__buffer_aa14580fd9d0e8806dc161745525a60dc}{m\_requested\_max\_num\_parallel\_readers} = other.
      m\_requested\_max\_num\_parallel\_readers;
77     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}& buf : \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}) \{
78       buf.second = buf.second->copy();
79     \}
80   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_ad55b621729dc0bfea498af2c232dc43c}\label{classlbann_1_1distributed__io__buffer_ad55b621729dc0bfea498af2c232dc43c}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!````~distributed\+\_\+io\+\_\+buffer@{$\sim$distributed\+\_\+io\+\_\+buffer}}
\index{````~distributed\+\_\+io\+\_\+buffer@{$\sim$distributed\+\_\+io\+\_\+buffer}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{$\sim$distributed\+\_\+io\+\_\+buffer()}{~distributed\_io\_buffer()}}
{\footnotesize\ttfamily virtual lbann\+::distributed\+\_\+io\+\_\+buffer\+::$\sim$distributed\+\_\+io\+\_\+buffer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}



Definition at line 89 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
89                                    \{
90     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} buf : \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}) \{
91       \textcolor{keyword}{delete} buf.second;
92     \}
93   \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_af63a8b162ed869393c5b604c5913c631}\label{classlbann_1_1distributed__io__buffer_af63a8b162ed869393c5b604c5913c631}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch@{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch}}
\index{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch@{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch()}{calculate\_num\_iterations\_per\_epoch()}}
{\footnotesize\ttfamily void lbann\+::distributed\+\_\+io\+\_\+buffer\+::calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch (\begin{DoxyParamCaption}\item[{int}]{num\+\_\+models,  }\item[{int}]{model\+\_\+rank,  }\item[{int}]{max\+\_\+mini\+\_\+batch\+\_\+size,  }\item[{\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$}]{data\+\_\+reader }\end{DoxyParamCaption})}

Check to make sure that there is enough data for all of the parallel readers

Set the basic parameters for stride and offset of the data reader

Set mini-\/batch size and stride

Set data reader base offset and model offset

Given that each model has to have at least one reader, what is the minimum stride

The global mini-\/batch is a full mini-\/batch per model

By default the last mini-\/batch is a full one

By default the last mini-\/batch is a full one per model

If there is a partial mini-\/batch all readers need to know about it

Note that model\+\_\+rank + m\+\_\+comm-\/$>$get\+\_\+rank\+\_\+in\+\_\+model() is not equivalent to m\+\_\+comm-\/$>$get\+\_\+world\+\_\+rank() from a parallel I/O perspective Given the data readers model rank, how many models have a higher rank

Number of complete multi-\/model mini-\/batches that will be fetched Ranks after current reader

Ranks on the next round

Ranks remaining within the current mini-\/batch

The last mini-\/batch may be partial and thus a reader may have a smaller stride to get there

Note that if the parallel reader only has the last mini-\/batch, its base offset will equal the last mini-\/batch threshold However, it shouldn\textquotesingle{}t need to use the last mini-\/batch threshold

B\+VE 2/4/18

Consider the corner case where there is a very small number of mini-\/batches compared to the number of parallel readers. In this case, the base offset may be incorrectly computed

By default last mini-\/batch the last stride of each reader is part of a regular (full) round 

Definition at line 159 of file distributed\+\_\+io\+\_\+buffer.\+cpp.


\begin{DoxyCode}
159                                                                                                            
                                                        \{
160   \textcolor{keywordflow}{if}(data\_reader == \textcolor{keyword}{nullptr}) \{ \textcolor{keywordflow}{return}; \}
161   \textcolor{comment}{// If the data reader does not have any data bail out (e.g. unused validation reader)}
162   \textcolor{keywordflow}{if}(data\_reader->get\_num\_data() == 0) \{ \textcolor{keywordflow}{return}; \}
163 
164   \textcolor{keywordflow}{if}(max\_mini\_batch\_size > data\_reader->get\_num\_data()) \{
165     max\_mini\_batch\_size = data\_reader->get\_num\_data();
166   \}
167 
169   \textcolor{keywordtype}{int} num\_parallel\_readers\_per\_model = \hyperlink{classlbann_1_1distributed__io__buffer_af6653723714cf8cf51a928fc9f6e6728}{compute\_max\_num\_parallel\_readers}(
      data\_reader->get\_num\_data(), max\_mini\_batch\_size, 
      \hyperlink{classlbann_1_1distributed__io__buffer_aa14580fd9d0e8806dc161745525a60dc}{m\_requested\_max\_num\_parallel\_readers});
170   data\_reader->set\_num\_parallel\_readers(num\_parallel\_readers\_per\_model);
171   \textcolor{keywordflow}{if}(num\_parallel\_readers\_per\_model == 0) \{
172     \textcolor{keywordflow}{throw} lbann\_exception(
173       std::string\{\} + \_\_FILE\_\_ + \textcolor{stringliteral}{" "} + std::to\_string(\_\_LINE\_\_) +
174       \textcolor{stringliteral}{" :: distributed\_io\_buffer: number of parallel readers is zero"});
175   \}
176 
178   \textcolor{keywordtype}{int} batch\_stride = num\_models * num\_parallel\_readers\_per\_model * max\_mini\_batch\_size;
179   \textcolor{keywordtype}{int} base\_offset = \hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() * num\_models * max\_mini\_batch\_size;
180   \textcolor{keywordtype}{int} model\_offset = model\_rank * max\_mini\_batch\_size;
182   data\_reader->set\_mini\_batch\_size(max\_mini\_batch\_size);
183   data\_reader->set\_stride\_to\_next\_mini\_batch(batch\_stride);
184   data\_reader->set\_sample\_stride(1);
185   data\_reader->set\_iteration\_stride(num\_parallel\_readers\_per\_model);
186   data\_reader->set\_reset\_mini\_batch\_index(\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}());
188   data\_reader->set\_base\_offset(base\_offset);
189   data\_reader->set\_model\_offset(model\_offset);
190   data\_reader->set\_initial\_position();
191 
192   \textcolor{keywordtype}{int} min\_stride\_across\_models = max\_mini\_batch\_size * num\_models;  
193 
194   data\_reader->set\_global\_mini\_batch\_size(min\_stride\_across\_models); 
195   data\_reader->set\_last\_mini\_batch\_size(max\_mini\_batch\_size); 
196   data\_reader->set\_global\_last\_mini\_batch\_size(min\_stride\_across\_models); 
197 
198   \textcolor{keywordtype}{int} num\_whole\_mini\_batches\_per\_model = floor(data\_reader->get\_num\_data() / min\_stride\_across\_models);
199   \textcolor{keywordtype}{int} num\_whole\_mini\_batches\_per\_reader = floor(num\_whole\_mini\_batches\_per\_model / 
      num\_parallel\_readers\_per\_model);
200   \textcolor{keywordtype}{int} parallel\_readers\_with\_extra\_mini\_batch = num\_whole\_mini\_batches\_per\_model % 
      num\_parallel\_readers\_per\_model;
201   \textcolor{keywordtype}{int} global\_partial\_mini\_batch\_size = data\_reader->get\_num\_data() - (num\_whole\_mini\_batches\_per\_model * 
      min\_stride\_across\_models);
202   \textcolor{keywordtype}{int} per\_model\_partial\_mini\_batch\_size = global\_partial\_mini\_batch\_size / num\_models;
203   \textcolor{keywordtype}{int} world\_master\_remainder\_data = 0;
204 
205   \textcolor{comment}{// Compute how many full "parallel" mini-batches are available}
206   \textcolor{comment}{//int last\_mini\_batch\_threshold = num\_whole\_mini\_batches\_per\_model * min\_stride\_across\_models;}
207 
208   \textcolor{comment}{// BVE FIXME revisit this piece of code}
209   \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() < parallel\_readers\_with\_extra\_mini\_batch) \{
210     num\_whole\_mini\_batches\_per\_reader += 1;
211   \}
212 
213   \textcolor{keywordtype}{int} world\_master\_remainder\_adjustment = data\_reader->get\_num\_data()
214                                           - (num\_whole\_mini\_batches\_per\_model * min\_stride\_across\_models)
215                                           - (per\_model\_partial\_mini\_batch\_size * num\_models);
216   \textcolor{keywordflow}{if}(model\_rank == 0 && \hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() == 
      parallel\_readers\_with\_extra\_mini\_batch) \{
217     world\_master\_remainder\_data = world\_master\_remainder\_adjustment;
218     world\_master\_remainder\_adjustment = 0;
219   \}
220   per\_model\_partial\_mini\_batch\_size += world\_master\_remainder\_data;
221 
222   \textcolor{keywordflow}{if}(world\_master\_remainder\_adjustment != 0) \{
223     data\_reader->set\_world\_master\_mini\_batch\_adjustment(world\_master\_remainder\_adjustment);
224   \}
225 
227   \textcolor{keywordflow}{if}(per\_model\_partial\_mini\_batch\_size > 0) \{
228     data\_reader->set\_last\_mini\_batch\_size(per\_model\_partial\_mini\_batch\_size);
229     data\_reader->set\_global\_last\_mini\_batch\_size(global\_partial\_mini\_batch\_size);
230   \}
231 
232   \textcolor{comment}{// BVE FIXME this is wonky}
233   \textcolor{keywordflow}{if}(global\_partial\_mini\_batch\_size != 0) \{
234     data\_reader->set\_num\_iterations\_per\_epoch(num\_whole\_mini\_batches\_per\_model+1);
235   \}\textcolor{keywordflow}{else} \{
236     data\_reader->set\_num\_iterations\_per\_epoch(num\_whole\_mini\_batches\_per\_model);
237   \}
238 
239   \textcolor{keywordflow}{if}(data\_reader->get\_last\_mini\_batch\_size() > max\_mini\_batch\_size) \{
240     \textcolor{keywordflow}{throw} \textcolor{keyword}{new} lbann\_exception(\textcolor{stringliteral}{"Error in calculating the partial mini-batch size, exceeds the max mini-batch
       size"});
241   \}
242 
245 
246   \textcolor{keywordtype}{int} last\_mini\_batch\_offset =
247     std::max(0,
250              ((num\_parallel\_readers\_per\_model - \hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() - 1)
252               + parallel\_readers\_with\_extra\_mini\_batch)
253              * min\_stride\_across\_models
255              + (num\_models - model\_rank) * max\_mini\_batch\_size);
256 
257 
259   \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() == parallel\_readers\_with\_extra\_mini\_batch && 
      per\_model\_partial\_mini\_batch\_size > 0) \{
262     data\_reader->set\_stride\_to\_last\_mini\_batch(last\_mini\_batch\_offset
263                                             + model\_rank * per\_model\_partial\_mini\_batch\_size + 
      world\_master\_remainder\_adjustment); 
264     \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() == num\_whole\_mini\_batches\_per\_model) \{
268       model\_offset =
269         model\_rank * per\_model\_partial\_mini\_batch\_size + world\_master\_remainder\_adjustment;
270       data\_reader->set\_model\_offset(model\_offset);
271       data\_reader->set\_initial\_position();
272     \}
273   \}\textcolor{keywordflow}{else} \{
275     data\_reader->set\_stride\_to\_last\_mini\_batch(data\_reader->get\_stride\_to\_next\_mini\_batch());
276   \}
277 
278   \textcolor{comment}{// if(m\_comm->get\_rank\_in\_model() <= num\_parallel\_readers\_per\_model) \{}
279   \textcolor{comment}{//   std::cout << "[" << m\_comm->get\_rank\_in\_world() << "] " << model\_rank << " model rank, "<<
       m\_comm->get\_rank\_in\_model() << " rank in model, num\_whole\_mini\_batches\_per\_model " <<
       num\_whole\_mini\_batches\_per\_model << " num\_whole\_mini\_batches\_per\_reader " << num\_whole\_mini\_batches\_per\_reader << "
       parallel\_readers\_with\_extra\_mini\_batch " << parallel\_readers\_with\_extra\_mini\_batch << " partial\_mini\_batch\_size=" <<
       per\_model\_partial\_mini\_batch\_size << " last mini batch size=" << data\_reader->get\_last\_mini\_batch\_size() << "
       world\_master\_remainder\_data=" << world\_master\_remainder\_data << " last mini-batch threshold " <<
       last\_mini\_batch\_threshold << " with a last stride of " << data\_reader->get\_stride\_to\_last\_mini\_batch() << " and stride of " <<
       data\_reader->get\_stride\_to\_next\_mini\_batch() << " and there are " << num\_parallel\_readers\_per\_model << "
       parallel readers per model" << " last mini batch offset = " << last\_mini\_batch\_offset <<  " parallel reader with
       extra minibatch = " << parallel\_readers\_with\_extra\_mini\_batch << " model bracket = " <<
       (parallel\_readers\_with\_extra\_mini\_batch * max\_mini\_batch\_size + per\_model\_partial\_mini\_batch\_size + world\_master\_remainder\_data)
       <<" base ofset "<< data\_reader->get\_base\_offset() << " model offset " << data\_reader->get\_model\_offset() << "
       world master remainder adjustment " << world\_master\_remainder\_adjustment <<std::endl;}
280   \textcolor{comment}{// \}}
281   \textcolor{keywordflow}{return};
282 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{classlbann_1_1distributed__io__buffer_af63a8b162ed869393c5b604c5913c631_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1distributed__io__buffer_af63a8b162ed869393c5b604c5913c631_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a2a611c36620155646e46e065e040541f}\label{classlbann_1_1distributed__io__buffer_a2a611c36620155646e46e065e040541f}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+single\+\_\+model@{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+single\+\_\+model}}
\index{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+single\+\_\+model@{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+single\+\_\+model}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+single\+\_\+model()}{calculate\_num\_iterations\_per\_epoch\_single\_model()}}
{\footnotesize\ttfamily void lbann\+::distributed\+\_\+io\+\_\+buffer\+::calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+single\+\_\+model (\begin{DoxyParamCaption}\item[{int}]{max\+\_\+mini\+\_\+batch\+\_\+size,  }\item[{\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$}]{data\+\_\+reader }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \hyperlink{classlbann_1_1generic__io__buffer_a4c71135fada7f0da0b315d538d327e59}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 288 of file distributed\+\_\+io\+\_\+buffer.\+cpp.


\begin{DoxyCode}
288                                                                                                            
                                     \{
289   \hyperlink{classlbann_1_1distributed__io__buffer_af63a8b162ed869393c5b604c5913c631}{calculate\_num\_iterations\_per\_epoch}(1, 0, max\_mini\_batch\_size, 
      data\_reader);
290 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{classlbann_1_1distributed__io__buffer_a2a611c36620155646e46e065e040541f_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_aa1f5200f9646d38fe3b3adaf39645330}\label{classlbann_1_1distributed__io__buffer_aa1f5200f9646d38fe3b3adaf39645330}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+spanning\+\_\+models@{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+spanning\+\_\+models}}
\index{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+spanning\+\_\+models@{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+spanning\+\_\+models}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+spanning\+\_\+models()}{calculate\_num\_iterations\_per\_epoch\_spanning\_models()}}
{\footnotesize\ttfamily void lbann\+::distributed\+\_\+io\+\_\+buffer\+::calculate\+\_\+num\+\_\+iterations\+\_\+per\+\_\+epoch\+\_\+spanning\+\_\+models (\begin{DoxyParamCaption}\item[{int}]{max\+\_\+mini\+\_\+batch\+\_\+size,  }\item[{\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$}]{data\+\_\+reader }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \hyperlink{classlbann_1_1generic__io__buffer_ac943184cf364f7922648e3acb760b41e}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 284 of file distributed\+\_\+io\+\_\+buffer.\+cpp.


\begin{DoxyCode}
284                                                                                                            
                                        \{
285   \hyperlink{classlbann_1_1distributed__io__buffer_af63a8b162ed869393c5b604c5913c631}{calculate\_num\_iterations\_per\_epoch}(\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->
      \hyperlink{classlbann_1_1lbann__comm_aeb8ef8f13bbb324e3e1f656998198f3f}{get\_num\_models}(), \hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a6422f70c92bed0b78179facc52b066f7}{get\_model\_rank}(), max\_mini\_batch\_size, 
      data\_reader);
286 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{classlbann_1_1distributed__io__buffer_aa1f5200f9646d38fe3b3adaf39645330_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_af6653723714cf8cf51a928fc9f6e6728}\label{classlbann_1_1distributed__io__buffer_af6653723714cf8cf51a928fc9f6e6728}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!compute\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers@{compute\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers}}
\index{compute\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers@{compute\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{compute\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers()}{compute\_max\_num\_parallel\_readers()}}
{\footnotesize\ttfamily int lbann\+::distributed\+\_\+io\+\_\+buffer\+::compute\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers (\begin{DoxyParamCaption}\item[{long}]{data\+\_\+set\+\_\+size,  }\item[{int}]{mini\+\_\+batch\+\_\+size,  }\item[{int}]{requested\+\_\+num\+\_\+parallel\+\_\+readers }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Make sure that there are enough ranks and data for all of the parallel readers requested. Are there enough ranks in the model to support the requested number of parallel readers

Check to make sure that there is enough data for all of the parallel readers 

Implements \hyperlink{classlbann_1_1generic__io__buffer_affc26b29e3f9eaaae5c033648e1a0141}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 127 of file distributed\+\_\+io\+\_\+buffer.\+cpp.


\begin{DoxyCode}
127                                                                                                            
                                             \{
128   \textcolor{keywordtype}{int} num\_parallel\_readers = requested\_num\_parallel\_readers;
129 
132   \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a483bf8a72d44a0e83da45f3d47bd20d4}{get\_model\_grid}().Size() < num\_parallel\_readers) \{
133     \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_ad8a5790dfa9191d4b4f889e8707e57f1}{am\_model\_master}()) \{
134         std::cout << \textcolor{stringliteral}{"Warning the grid size "} << \hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a483bf8a72d44a0e83da45f3d47bd20d4}{get\_model\_grid}().Size()
135                   << \textcolor{stringliteral}{"is smaller than the number of requested parallel readers "}
136                   << num\_parallel\_readers << \textcolor{stringliteral}{"."} << std::endl;
137     \}
138     num\_parallel\_readers = \hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a483bf8a72d44a0e83da45f3d47bd20d4}{get\_model\_grid}().Size();
139   \}
140 
142   \textcolor{keywordflow}{if}(data\_set\_size != 0) \{
143     \textcolor{keywordtype}{int} max\_num\_parallel\_readers = num\_parallel\_readers;
144     \textcolor{keywordflow}{while}(ceil((\textcolor{keywordtype}{float})data\_set\_size / (\textcolor{keywordtype}{float})(mini\_batch\_size * \hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->
      \hyperlink{classlbann_1_1lbann__comm_aeb8ef8f13bbb324e3e1f656998198f3f}{get\_num\_models}())) < max\_num\_parallel\_readers) \{
145       max\_num\_parallel\_readers--;
146     \}
147     \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a1ef526486183a29feadca9bef096a534}{am\_world\_master}() && max\_num\_parallel\_readers != num\_parallel\_readers) 
      \{
148       std::cout << \textcolor{stringliteral}{"Warning the training data set size "} << data\_set\_size
149                 << \textcolor{stringliteral}{" is too small for the number of requested parallel readers "}
150                 << num\_parallel\_readers << \textcolor{stringliteral}{", using "} << max\_num\_parallel\_readers << \textcolor{stringliteral}{"."}
151                 << std::endl;
152     \}
153     \textcolor{keywordflow}{return} max\_num\_parallel\_readers;
154   \} \textcolor{keywordflow}{else} \{
155     \textcolor{keywordflow}{return} 0;
156   \}
157 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1distributed__io__buffer_af6653723714cf8cf51a928fc9f6e6728_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1distributed__io__buffer_af6653723714cf8cf51a928fc9f6e6728_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a86a931528aa7a6e178cf6b55bf153881}\label{classlbann_1_1distributed__io__buffer_a86a931528aa7a6e178cf6b55bf153881}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!copy@{copy}}
\index{copy@{copy}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{copy()}{copy()}}
{\footnotesize\ttfamily \hyperlink{classlbann_1_1distributed__io__buffer}{distributed\+\_\+io\+\_\+buffer}$\ast$ lbann\+::distributed\+\_\+io\+\_\+buffer\+::copy (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \hyperlink{classlbann_1_1generic__io__buffer_a9d8020b82cf467c9148b0b37e7229262}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 94 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
94 \{ \textcolor{keywordflow}{return} \textcolor{keyword}{new} \hyperlink{classlbann_1_1distributed__io__buffer_a2066033e844ec7b9b95dfe7615a0a256}{distributed\_io\_buffer}(*\textcolor{keyword}{this}); \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a9d7cd67615c71ec7a94533c29796e4ab}\label{classlbann_1_1distributed__io__buffer_a9d7cd67615c71ec7a94533c29796e4ab}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!current\+\_\+root\+\_\+rank@{current\+\_\+root\+\_\+rank}}
\index{current\+\_\+root\+\_\+rank@{current\+\_\+root\+\_\+rank}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{current\+\_\+root\+\_\+rank()}{current\_root\_rank()}}
{\footnotesize\ttfamily virtual int lbann\+::distributed\+\_\+io\+\_\+buffer\+::current\+\_\+root\+\_\+rank (\begin{DoxyParamCaption}\item[{\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}}]{mode }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}



Return the rank of the current root node for the Elemental Distribution. 



Definition at line 143 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
143                                                            \{
144     data\_buffer *buf = \hyperlink{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e}{get\_data\_buffer}(mode);
145     \textcolor{keywordflow}{return} buf->m\_root;
146   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a3a770ec2314313761d6f0eccdb9dc09b}\label{classlbann_1_1distributed__io__buffer_a3a770ec2314313761d6f0eccdb9dc09b}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!distribute\+\_\+from\+\_\+local\+\_\+matrix@{distribute\+\_\+from\+\_\+local\+\_\+matrix}}
\index{distribute\+\_\+from\+\_\+local\+\_\+matrix@{distribute\+\_\+from\+\_\+local\+\_\+matrix}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{distribute\+\_\+from\+\_\+local\+\_\+matrix()}{distribute\_from\_local\_matrix()}}
{\footnotesize\ttfamily void lbann\+::distributed\+\_\+io\+\_\+buffer\+::distribute\+\_\+from\+\_\+local\+\_\+matrix (\begin{DoxyParamCaption}\item[{\hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat} \&}]{Ms,  }\item[{\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$}]{data\+\_\+reader,  }\item[{\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}}]{mode }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Reimplemented from \hyperlink{classlbann_1_1generic__io__buffer_a08c2bb93b86d2926df52ef9272a07d87}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 61 of file distributed\+\_\+io\+\_\+buffer.\+cpp.


\begin{DoxyCode}
61                                                                                                            
                              \{
62   \textcolor{keywordtype}{int} num\_parallel\_readers = data\_reader->get\_num\_parallel\_readers();
63   data\_buffer *buf = \hyperlink{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e}{get\_data\_buffer}(mode);
64   buf->Ms.SetRoot(buf->m\_root);
65 
66   \hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a6086ced12c3eefeea6e2a78eff286983}{model\_barrier}();
67 
68   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() == buf->m\_root) \{
69     \textcolor{keywordflow}{if}(!buf->m\_local\_data\_valid) \{
70       std::stringstream err;
71       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_
72           << \textcolor{stringliteral}{" :: lbann\_distributed\_io\_buffer: No valid data for this step -- local data was invalid"};
73       lbann\_exception(err.str());
74     \}
75     CopyFromRoot(buf->M\_local(El::ALL, El::IR(0, Ms.Width())), buf->Ms);
76     buf->m\_local\_data\_valid = \textcolor{keyword}{false};
77     buf->m\_num\_samples\_in\_batch = 0;
78   \} \textcolor{keywordflow}{else} \{
79     CopyFromNonRoot(buf->Ms);
80   \}
81 
82   \hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a6086ced12c3eefeea6e2a78eff286983}{model\_barrier}();
83 
84   buf->m\_root = (buf->m\_root + 1) % num\_parallel\_readers;
85 
86   Copy(buf->Ms, Ms);
87   \textcolor{keywordflow}{return};
88 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1distributed__io__buffer_a3a770ec2314313761d6f0eccdb9dc09b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=332pt]{classlbann_1_1distributed__io__buffer_a3a770ec2314313761d6f0eccdb9dc09b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_abfeb87d4dc402b482db60926ca9b3ec1}\label{classlbann_1_1distributed__io__buffer_abfeb87d4dc402b482db60926ca9b3ec1}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!fetch\+\_\+to\+\_\+local\+\_\+matrix@{fetch\+\_\+to\+\_\+local\+\_\+matrix}}
\index{fetch\+\_\+to\+\_\+local\+\_\+matrix@{fetch\+\_\+to\+\_\+local\+\_\+matrix}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{fetch\+\_\+to\+\_\+local\+\_\+matrix()}{fetch\_to\_local\_matrix()}}
{\footnotesize\ttfamily int lbann\+::distributed\+\_\+io\+\_\+buffer\+::fetch\+\_\+to\+\_\+local\+\_\+matrix (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$}]{data\+\_\+reader,  }\item[{\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}}]{mode }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Check to see if this rank has valid data -- if not read in the next batch Coordinate all available readers so that the perform I/O in the same step

Each data reader needs to either have independent / split data, or take an offset / stride 

Implements \hyperlink{classlbann_1_1generic__io__buffer_af9fc2100d41328fe399acf7bced950d7}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 38 of file distributed\+\_\+io\+\_\+buffer.\+cpp.


\begin{DoxyCode}
38                                                                                                            
      \{
39   \textcolor{keywordtype}{int} num\_parallel\_readers = data\_reader->get\_num\_parallel\_readers();
40 
43   data\_buffer *buf = \hyperlink{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e}{get\_data\_buffer}(mode);
44   \textcolor{keywordflow}{if} (buf->m\_root == 0) \{
45     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() < num\_parallel\_readers && !buf->
      m\_local\_reader\_done) \{
46       Zero(buf->M\_local);
47 
50       buf->m\_num\_samples\_in\_batch = (*fetch\_data\_fn)(buf->M\_local, data\_reader);
51       \textcolor{keywordtype}{bool} data\_valid = (buf->m\_num\_samples\_in\_batch > 0);
52       \textcolor{keywordflow}{if}(data\_valid) \{
53         buf->m\_num\_data\_per\_epoch+=buf->m\_num\_samples\_in\_batch;
54       \}
55       buf->m\_local\_data\_valid = data\_valid;
56     \}
57   \}
58   \textcolor{keywordflow}{return} buf->m\_num\_samples\_in\_batch;
59 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1distributed__io__buffer_abfeb87d4dc402b482db60926ca9b3ec1_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e}\label{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!get\+\_\+data\+\_\+buffer@{get\+\_\+data\+\_\+buffer}}
\index{get\+\_\+data\+\_\+buffer@{get\+\_\+data\+\_\+buffer}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{get\+\_\+data\+\_\+buffer()}{get\_data\_buffer()}}
{\footnotesize\ttfamily \hyperlink{classlbann_1_1data__buffer}{data\+\_\+buffer}$\ast$ lbann\+::distributed\+\_\+io\+\_\+buffer\+::get\+\_\+data\+\_\+buffer (\begin{DoxyParamCaption}\item[{const \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}}]{mode }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 122 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
122                                                                 \{
123     data\_buffer *data\_buffer = \textcolor{keyword}{nullptr};
124     data\_buffer\_map\_t::const\_iterator it = \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}.find(mode);
125     \textcolor{keywordflow}{if} (it != \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}.end()) data\_buffer = it->second;
126 
127     \textcolor{keywordflow}{switch}(mode) \{
128     \textcolor{keywordflow}{case} \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8ac185ddac8b5a8f5aa23c5b80bc12d214}{execution\_mode::training}:
129       \textcolor{keywordflow}{break};
130     \textcolor{keywordflow}{case} \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8aa617908b172c473cb8e8cda059e55bf0}{execution\_mode::validation}:
131       \textcolor{keywordflow}{break};
132     \textcolor{keywordflow}{case} \hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8aae2b1fca515949e5d54fb22b8ed95575}{execution\_mode::testing}:
133       \textcolor{keywordflow}{break};
134     \textcolor{keywordflow}{default}:
135       \textcolor{keywordflow}{throw} lbann\_exception(
136                             std::string\{\} + \_\_FILE\_\_ + \textcolor{stringliteral}{" "} + std::to\_string(\_\_LINE\_\_) +
137                             \textcolor{stringliteral}{" :: distributed\_io\_buffer: invalid execution phase"});
138     \}
139     \textcolor{keywordflow}{return} data\_buffer;
140   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a58e30ff6d96678b35b2470e1d292967c}\label{classlbann_1_1distributed__io__buffer_a58e30ff6d96678b35b2470e1d292967c}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!get\+\_\+type@{get\+\_\+type}}
\index{get\+\_\+type@{get\+\_\+type}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{get\+\_\+type()}{get\_type()}}
{\footnotesize\ttfamily std\+::string lbann\+::distributed\+\_\+io\+\_\+buffer\+::get\+\_\+type (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Return this buffer\textquotesingle{}s type, e.\+g\+: \char`\"{}partitioned\+\_\+io\+\_\+buffer,\char`\"{} \char`\"{}distributed\+\_\+io\+\_\+buffer,\char`\"{} etc. 

Implements \hyperlink{classlbann_1_1generic__io__buffer_adc77c0a280f8a200a8d8495c3a371ebb}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 96 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
96 \{ \textcolor{keywordflow}{return} \textcolor{stringliteral}{"distributed\_io\_buffer"}; \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a6fe05935e14186d2dd1975ecab9be10e}\label{classlbann_1_1distributed__io__buffer_a6fe05935e14186d2dd1975ecab9be10e}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!is\+\_\+current\+\_\+root@{is\+\_\+current\+\_\+root}}
\index{is\+\_\+current\+\_\+root@{is\+\_\+current\+\_\+root}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{is\+\_\+current\+\_\+root()}{is\_current\_root()}}
{\footnotesize\ttfamily bool lbann\+::distributed\+\_\+io\+\_\+buffer\+::is\+\_\+current\+\_\+root (\begin{DoxyParamCaption}\item[{\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}}]{mode }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



Is this rank the current root node for the Elemental Distribution. 



Definition at line 149 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
149                                                   \{
150     data\_buffer *buf = \hyperlink{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e}{get\_data\_buffer}(mode);
151     \textcolor{keywordflow}{return} (\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() == buf->m\_root);
152   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a2e214f6542d9b12c8a29bf41d0ee220e}\label{classlbann_1_1distributed__io__buffer_a2e214f6542d9b12c8a29bf41d0ee220e}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!is\+\_\+data\+\_\+set\+\_\+processed@{is\+\_\+data\+\_\+set\+\_\+processed}}
\index{is\+\_\+data\+\_\+set\+\_\+processed@{is\+\_\+data\+\_\+set\+\_\+processed}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{is\+\_\+data\+\_\+set\+\_\+processed()}{is\_data\_set\_processed()}}
{\footnotesize\ttfamily bool lbann\+::distributed\+\_\+io\+\_\+buffer\+::is\+\_\+data\+\_\+set\+\_\+processed (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1generic__data__reader}{generic\+\_\+data\+\_\+reader} $\ast$}]{data\+\_\+reader,  }\item[{\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}}]{mode }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Make sure that all local data has been processed

Once all of the readers have finished their part of the mini-\/batch indicate that the epoch is finished

When the epoch is finished, make sure that the root node for distributing data is reset because

if the number of parallel readers does not evenly divide the data set size, the epoch will finish without all of the parallel readers participating in the last round. 

Implements \hyperlink{classlbann_1_1generic__io__buffer_a9a038d40aec50dbc24c0abe21ad0c0a9}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 90 of file distributed\+\_\+io\+\_\+buffer.\+cpp.


\begin{DoxyCode}
90                                                                                                            
       \{
91   \textcolor{comment}{// not just the ones in the last round.  This will ensure that all readers, that had data}
92   \textcolor{comment}{// will have distributed it.}
93   \textcolor{keywordtype}{int} num\_parallel\_readers = data\_reader->get\_num\_parallel\_readers();
94   \textcolor{keywordtype}{int} num\_iterations\_per\_epoch = data\_reader->get\_num\_iterations\_per\_epoch();
95   \textcolor{keywordtype}{int} current\_step\_in\_epoch = data\_reader->get\_current\_step\_in\_epoch(); \textcolor{comment}{// Get the current step before the
       update function increments it}
96   data\_buffer *buf = \hyperlink{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e}{get\_data\_buffer}(mode);
97 
98   \textcolor{keywordtype}{bool} is\_active\_reader = (\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}() < num\_parallel\_readers)
99     && ((\hyperlink{classlbann_1_1generic__io__buffer_a2e4a46c85c8b30e10b1cc5acaa2c4cca}{m\_comm}->\hyperlink{classlbann_1_1lbann__comm_a789453454468a3b70de768537c50ca52}{get\_rank\_in\_model}()+1)%num\_parallel\_readers == buf->m\_root);
100 
101   \textcolor{keywordflow}{if}(is\_active\_reader) \{
102       \textcolor{keywordflow}{if}(buf->m\_local\_data\_valid) \{ 
103         std::stringstream err;
104         err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "}<<  \_\_LINE\_\_
105             << \textcolor{stringliteral}{" :: lbann\_input\_layer\_distributed\_io\_buffer: all valid data was not processed."};
106         \textcolor{keywordflow}{throw} lbann\_exception(err.str());
107       \}
108   \}
109   buf->m\_local\_reader\_done = !(*update\_data\_reader\_fn)(is\_active\_reader, data\_reader);
110 
112   \textcolor{keywordflow}{if}(current\_step\_in\_epoch == (num\_iterations\_per\_epoch - 1)) \{
113     buf->m\_local\_reader\_done = \textcolor{keyword}{false};
114     buf->m\_root = 0; 
115     buf->m\_num\_data\_per\_epoch = 0;
118     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
119   \} \textcolor{keywordflow}{else} \{
120     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
121   \}
122 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1distributed__io__buffer_a2e214f6542d9b12c8a29bf41d0ee220e_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a484e3a609b32218890327d7578116aa2}\label{classlbann_1_1distributed__io__buffer_a484e3a609b32218890327d7578116aa2}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!is\+\_\+local\+\_\+reader\+\_\+done@{is\+\_\+local\+\_\+reader\+\_\+done}}
\index{is\+\_\+local\+\_\+reader\+\_\+done@{is\+\_\+local\+\_\+reader\+\_\+done}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{is\+\_\+local\+\_\+reader\+\_\+done()}{is\_local\_reader\_done()}}
{\footnotesize\ttfamily virtual bool lbann\+::distributed\+\_\+io\+\_\+buffer\+::is\+\_\+local\+\_\+reader\+\_\+done (\begin{DoxyParamCaption}\item[{\hyperlink{base_8hpp_a2781a159088df64ed7d47cc91c4dc0a8}{execution\+\_\+mode}}]{mode }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}



Is the local reader done. 



Definition at line 155 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
155                                                                \{
156     data\_buffer *buf = \hyperlink{classlbann_1_1distributed__io__buffer_ac176f3fced1191534a985f831136aa3e}{get\_data\_buffer}(mode);
157     \textcolor{keywordflow}{return} buf->m\_local\_reader\_done;
158   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a021724e36cc803bb8dabd747d1f49035}\label{classlbann_1_1distributed__io__buffer_a021724e36cc803bb8dabd747d1f49035}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!operator=@{operator=}}
\index{operator=@{operator=}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{operator=()}{operator=()}}
{\footnotesize\ttfamily \hyperlink{classlbann_1_1distributed__io__buffer}{distributed\+\_\+io\+\_\+buffer}\& lbann\+::distributed\+\_\+io\+\_\+buffer\+::operator= (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1distributed__io__buffer}{distributed\+\_\+io\+\_\+buffer} \&}]{other }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 81 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
81                                                                        \{
82     \hyperlink{classlbann_1_1generic__io__buffer_ae8d2b80e11cf780def151a425a6b1fa0}{generic\_io\_buffer::operator=}(other);
83     \hyperlink{classlbann_1_1distributed__io__buffer_aa14580fd9d0e8806dc161745525a60dc}{m\_requested\_max\_num\_parallel\_readers} = other.
      m\_requested\_max\_num\_parallel\_readers;
84     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}& buf : \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}) \{
85       buf.second = buf.second->copy();
86     \}
87     \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
88   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=348pt]{classlbann_1_1distributed__io__buffer_a021724e36cc803bb8dabd747d1f49035_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a6bdf8f670edc92902ee6222dde434c39}\label{classlbann_1_1distributed__io__buffer_a6bdf8f670edc92902ee6222dde434c39}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!set\+\_\+local\+\_\+matrix\+\_\+bypass@{set\+\_\+local\+\_\+matrix\+\_\+bypass}}
\index{set\+\_\+local\+\_\+matrix\+\_\+bypass@{set\+\_\+local\+\_\+matrix\+\_\+bypass}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{set\+\_\+local\+\_\+matrix\+\_\+bypass()}{set\_local\_matrix\_bypass()}}
{\footnotesize\ttfamily void lbann\+::distributed\+\_\+io\+\_\+buffer\+::set\+\_\+local\+\_\+matrix\+\_\+bypass (\begin{DoxyParamCaption}\item[{\hyperlink{base_8hpp_a68f11fdc31b62516cb310831bbe54d73}{Mat} $\ast$}]{M\+\_\+local }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \hyperlink{classlbann_1_1generic__io__buffer_af84c26ab5ee77d1d9ed9ea5d62823815}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 98 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
98 \{\};
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a996d9d20ad162b3edb06fb8aa04ecd3d}\label{classlbann_1_1distributed__io__buffer_a996d9d20ad162b3edb06fb8aa04ecd3d}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!set\+\_\+std\+\_\+matrix\+\_\+view@{set\+\_\+std\+\_\+matrix\+\_\+view}}
\index{set\+\_\+std\+\_\+matrix\+\_\+view@{set\+\_\+std\+\_\+matrix\+\_\+view}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{set\+\_\+std\+\_\+matrix\+\_\+view()}{set\_std\_matrix\_view()}}
{\footnotesize\ttfamily void lbann\+::distributed\+\_\+io\+\_\+buffer\+::set\+\_\+std\+\_\+matrix\+\_\+view (\begin{DoxyParamCaption}\item[{El\+::\+Int}]{cur\+\_\+mini\+\_\+batch\+\_\+size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \hyperlink{classlbann_1_1generic__io__buffer_a458d9bf722effce4177a0ac0aee9124f}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 100 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
100                                                                \{
101     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}& buf : \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}) \{
102       El::View(buf.second->M\_local\_v, buf.second->M\_local, El::ALL, El::IR(0, cur\_mini\_batch\_size));
103     \}
104   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_aec36cf1d148646f0e27d5939664f02d8}\label{classlbann_1_1distributed__io__buffer_aec36cf1d148646f0e27d5939664f02d8}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!setup\+\_\+data@{setup\+\_\+data}}
\index{setup\+\_\+data@{setup\+\_\+data}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{setup\+\_\+data()}{setup\_data()}}
{\footnotesize\ttfamily void lbann\+::distributed\+\_\+io\+\_\+buffer\+::setup\+\_\+data (\begin{DoxyParamCaption}\item[{El\+::\+Int}]{num\+\_\+neurons,  }\item[{El\+::\+Int}]{max\+\_\+minibatch\+\_\+size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}



Implements \hyperlink{classlbann_1_1generic__io__buffer_a00f3920147f7f19eceb5336bd6ddb421}{lbann\+::generic\+\_\+io\+\_\+buffer}.



Definition at line 106 of file distributed\+\_\+io\+\_\+buffer.\+hpp.


\begin{DoxyCode}
106                                                                         \{
107     \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}& buf : \hyperlink{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}{m\_data\_buffers}) \{
108       buf.second->M\_local.Resize(num\_neurons, max\_minibatch\_size);
109       buf.second->Ms.Resize(num\_neurons, max\_minibatch\_size);
110     \}
111   \}
\end{DoxyCode}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}\label{classlbann_1_1distributed__io__buffer_a59ef8621c57755f73671b782e11dbe89}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!m\+\_\+data\+\_\+buffers@{m\+\_\+data\+\_\+buffers}}
\index{m\+\_\+data\+\_\+buffers@{m\+\_\+data\+\_\+buffers}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{m\+\_\+data\+\_\+buffers}{m\_data\_buffers}}
{\footnotesize\ttfamily \hyperlink{classlbann_1_1distributed__io__buffer_a7567d3d06f96b001c118f9979bebb0b9}{data\+\_\+buffer\+\_\+map\+\_\+t} lbann\+::distributed\+\_\+io\+\_\+buffer\+::m\+\_\+data\+\_\+buffers}



Definition at line 161 of file distributed\+\_\+io\+\_\+buffer.\+hpp.

\mbox{\Hypertarget{classlbann_1_1distributed__io__buffer_aa14580fd9d0e8806dc161745525a60dc}\label{classlbann_1_1distributed__io__buffer_aa14580fd9d0e8806dc161745525a60dc}} 
\index{lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}!m\+\_\+requested\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers@{m\+\_\+requested\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers}}
\index{m\+\_\+requested\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers@{m\+\_\+requested\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers}!lbann\+::distributed\+\_\+io\+\_\+buffer@{lbann\+::distributed\+\_\+io\+\_\+buffer}}
\subsubsection{\texorpdfstring{m\+\_\+requested\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers}{m\_requested\_max\_num\_parallel\_readers}}
{\footnotesize\ttfamily int lbann\+::distributed\+\_\+io\+\_\+buffer\+::m\+\_\+requested\+\_\+max\+\_\+num\+\_\+parallel\+\_\+readers}

Requested maximum number of parallel readers (I/O streams) 

Definition at line 71 of file distributed\+\_\+io\+\_\+buffer.\+hpp.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/include/lbann/io/data\+\_\+buffers/\hyperlink{distributed__io__buffer_8hpp}{distributed\+\_\+io\+\_\+buffer.\+hpp}\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/src/io/data\+\_\+buffers/\hyperlink{distributed__io__buffer_8cpp}{distributed\+\_\+io\+\_\+buffer.\+cpp}\end{DoxyCompactItemize}
