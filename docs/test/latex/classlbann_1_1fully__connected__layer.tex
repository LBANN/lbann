\hypertarget{classlbann_1_1fully__connected__layer}{}\section{lbann\+:\+:fully\+\_\+connected\+\_\+layer$<$ T\+\_\+layout $>$ Class Template Reference}
\label{classlbann_1_1fully__connected__layer}\index{lbann\+::fully\+\_\+connected\+\_\+layer$<$ T\+\_\+layout $>$@{lbann\+::fully\+\_\+connected\+\_\+layer$<$ T\+\_\+layout $>$}}


{\ttfamily \#include $<$fully\+\_\+connected.\+hpp$>$}



Inheritance diagram for lbann\+:\+:fully\+\_\+connected\+\_\+layer$<$ T\+\_\+layout $>$\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=196pt]{classlbann_1_1fully__connected__layer__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for lbann\+:\+:fully\+\_\+connected\+\_\+layer$<$ T\+\_\+layout $>$\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classlbann_1_1fully__connected__layer_ae5d9a0f2851f3c55abe47aa65afbe66c}{fully\+\_\+connected\+\_\+layer} (\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}, int num\+\_\+neurons, \hyperlink{classlbann_1_1weights}{weights} $\ast$weight=nullptr, bool has\+\_\+bias=true, \hyperlink{classlbann_1_1cudnn_1_1cudnn__manager}{cudnn\+::cudnn\+\_\+manager} $\ast$cudnn=nullptr)
\item 
std\+::string \hyperlink{classlbann_1_1fully__connected__layer_a7ce678ec7560dd145244ffd8813d5edb}{get\+\_\+description} () const override
\item 
\hyperlink{classlbann_1_1fully__connected__layer_a377e44ab7eccb1aec467be5667bef6fe}{fully\+\_\+connected\+\_\+layer} (const \hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer} \&other)
\item 
\hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer} \& \hyperlink{classlbann_1_1fully__connected__layer_ab06d01021d4e89cd2f4f64c330e7cc31}{operator=} (const \hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer} \&other)
\item 
\hyperlink{classlbann_1_1fully__connected__layer_a5b133629f448a289bba6ebb6ab13941d}{$\sim$fully\+\_\+connected\+\_\+layer} () override
\item 
\hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer} $\ast$ \hyperlink{classlbann_1_1fully__connected__layer_a7e838b85cb7bf075def5a88fba2ace20}{copy} () const override
\item 
std\+::string \hyperlink{classlbann_1_1fully__connected__layer_abd51271a19a8cce44ba4f2d11eaaaee7}{get\+\_\+type} () const override
\item 
\hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08db}{data\+\_\+layout} \hyperlink{classlbann_1_1fully__connected__layer_a0d84bbfa7df80e879da13f54d465a603}{get\+\_\+data\+\_\+layout} () const override
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_a4f26e5923a82f11c2c7658a27903f83b}{setup\+\_\+matrices} (const \hyperlink{base_8hpp_a9951bb1719d534e0401b1f06cad19eab}{El\+::\+Grid} \&grid) override
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_aaf38e55b232b1bb2a6336ff1807b5a17}{setup\+\_\+dims} () override
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_aec4298146845489597126503177d3127}{setup\+\_\+data} () override
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_a95c96742a67f2e9398e608b244c2d121}{setup\+\_\+gpu} () override
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_a6dac6598c6b4ad3f766c5f0e88035f10}{fp\+\_\+compute} () override
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_a8cc9a10e336f61ef54d5e3f4a9ffdfb8}{bp\+\_\+compute} () override
\item 
{\footnotesize template$<$$>$ }\\void \hyperlink{classlbann_1_1fully__connected__layer_a1f0ae7a5f172e5ced011eaa2755fd04e}{setup\+\_\+matrices} (const \hyperlink{base_8hpp_a9951bb1719d534e0401b1f06cad19eab}{El\+::\+Grid} \&grid)
\item 
{\footnotesize template$<$$>$ }\\void \hyperlink{classlbann_1_1fully__connected__layer_a9af60f901a84d5604badf078ecbae082}{setup\+\_\+matrices} (const \hyperlink{base_8hpp_a9951bb1719d534e0401b1f06cad19eab}{El\+::\+Grid} \&grid)
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_a732ac5715ba0cea535c2bd062f634527}{fp\+\_\+compute\+\_\+cpu} ()
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_affbaa1ecb08e45ff6f9ab195227d0084}{bp\+\_\+compute\+\_\+cpu} ()
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_a720c048ee32b5620a99886177be4f577}{fp\+\_\+compute\+\_\+cuda} ()
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_a521aa4a5b88ef00f554fe21a850f6596}{bp\+\_\+compute\+\_\+cuda} ()
\item 
void \hyperlink{classlbann_1_1fully__connected__layer_a91f359a41cfbab6f21bd67bccb8409b1}{deallocate\+\_\+matrices} ()
\item 
{\footnotesize template$<$$>$ }\\void \hyperlink{classlbann_1_1fully__connected__layer_a6c2be8390e58d9b224e901b8500b2b3c}{fp\+\_\+compute\+\_\+cpu} ()
\item 
{\footnotesize template$<$$>$ }\\void \hyperlink{classlbann_1_1fully__connected__layer_a4c5b0eea2036c41b15ec03594dac8dc2}{bp\+\_\+compute\+\_\+cpu} ()
\item 
{\footnotesize template$<$$>$ }\\void \hyperlink{classlbann_1_1fully__connected__layer_a97243a5aa3474ff70c6f2d7f7e995e65}{fp\+\_\+compute\+\_\+cpu} ()
\item 
{\footnotesize template$<$$>$ }\\void \hyperlink{classlbann_1_1fully__connected__layer_af65e177e5f2b1a1d2854a04b433f7dae}{bp\+\_\+compute\+\_\+cpu} ()
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
Data\+Type \hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\+\_\+bias\+\_\+scaling\+\_\+factor}
\item 
\hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat} $\ast$ \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\+\_\+linearity\+\_\+gradient}
\item 
\hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat} $\ast$ \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\+\_\+bias\+\_\+gradient}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
\subsubsection*{template$<$data\+\_\+layout T\+\_\+layout$>$\newline
class lbann\+::fully\+\_\+connected\+\_\+layer$<$ T\+\_\+layout $>$}

Fully-\/connected layer. This layer applies an affine transformation. 

Definition at line 49 of file fully\+\_\+connected.\+hpp.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_ae5d9a0f2851f3c55abe47aa65afbe66c}\label{classlbann_1_1fully__connected__layer_ae5d9a0f2851f3c55abe47aa65afbe66c}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!fully\+\_\+connected\+\_\+layer@{fully\+\_\+connected\+\_\+layer}}
\index{fully\+\_\+connected\+\_\+layer@{fully\+\_\+connected\+\_\+layer}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{fully\+\_\+connected\+\_\+layer()}{fully\_connected\_layer()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
\hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::\hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer} (\begin{DoxyParamCaption}\item[{\hyperlink{classlbann_1_1lbann__comm}{lbann\+\_\+comm} $\ast$}]{comm,  }\item[{int}]{num\+\_\+neurons,  }\item[{\hyperlink{classlbann_1_1weights}{weights} $\ast$}]{weight = {\ttfamily nullptr},  }\item[{bool}]{has\+\_\+bias = {\ttfamily true},  }\item[{\hyperlink{classlbann_1_1cudnn_1_1cudnn__manager}{cudnn\+::cudnn\+\_\+manager} $\ast$}]{cudnn = {\ttfamily nullptr} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 77 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
82     : \hyperlink{classlbann_1_1learning__layer_a818a96b1d3daabb22b1e82c1c54c6268}{learning\_layer}(\hyperlink{file__io_8cpp_ab048c6f9fcbcfaa57ce68b00263dbebe}{comm}),
83       \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient}(\textcolor{keyword}{nullptr}),
84       \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient}(\textcolor{keyword}{nullptr}) \{
85 
86     \textcolor{comment}{// Initialize neuron tensor dimensions}
87     this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons} = num\_neurons;
88     this->\hyperlink{classlbann_1_1Layer_adfd6178d21498c9095cd947ae1eb2d6a}{m\_num\_neuron\_dims} = 1;
89     this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims}.assign(1, this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons});
90 
91     \textcolor{comment}{// Initialize bias}
92     \hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} = has\_bias ? DataType(1) : DataType(0);
93 
94 \textcolor{preprocessor}{#ifdef LBANN\_HAS\_CUDNN}
95     \textcolor{keywordflow}{if} (cudnn && T\_layout == \hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08dba37d2a3465f7cbf4ab60f4e79944d0638}{data\_layout::DATA\_PARALLEL}) \{
96       this->\hyperlink{classlbann_1_1Layer_af7881cb5eff5207c15fa835d65462e8f}{m\_using\_gpus} = \textcolor{keyword}{true};
97       this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn} = cudnn;
98     \}
99 \textcolor{preprocessor}{#endif // LBANN\_HAS\_CUDNN}
100   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a377e44ab7eccb1aec467be5667bef6fe}\label{classlbann_1_1fully__connected__layer_a377e44ab7eccb1aec467be5667bef6fe}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!fully\+\_\+connected\+\_\+layer@{fully\+\_\+connected\+\_\+layer}}
\index{fully\+\_\+connected\+\_\+layer@{fully\+\_\+connected\+\_\+layer}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{fully\+\_\+connected\+\_\+layer()}{fully\_connected\_layer()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
\hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::\hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer} (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$ \&}]{other }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 111 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
111                                                             :
112     \hyperlink{classlbann_1_1learning__layer_a818a96b1d3daabb22b1e82c1c54c6268}{learning\_layer}(other),
113     \hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor}(other.m\_bias\_scaling\_factor) \{
114     
115     \textcolor{comment}{// Deep matrix copies}
116     \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient} = other.m\_linearity\_gradient;
117     \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient} = other.m\_bias\_gradient;
118     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient} != \textcolor{keyword}{nullptr}) \{
119       \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient} = \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient}->Copy();
120     \}
121     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient} != \textcolor{keyword}{nullptr}) \{
122       \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient} = \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient}->Copy();
123     \}
124 
125 \textcolor{preprocessor}{#ifdef LBANN\_HAS\_CUDNN}
126     m\_linearity\_gradient\_d = other.m\_linearity\_gradient\_d;
127     m\_bias\_gradient\_d = other.m\_bias\_gradient\_d;
128 \textcolor{preprocessor}{#endif // LBANN\_HAS\_CUDNN}
129 
130   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a5b133629f448a289bba6ebb6ab13941d}\label{classlbann_1_1fully__connected__layer_a5b133629f448a289bba6ebb6ab13941d}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!````~fully\+\_\+connected\+\_\+layer@{$\sim$fully\+\_\+connected\+\_\+layer}}
\index{````~fully\+\_\+connected\+\_\+layer@{$\sim$fully\+\_\+connected\+\_\+layer}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{$\sim$fully\+\_\+connected\+\_\+layer()}{~fully\_connected\_layer()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
\hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::$\sim$\hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer} (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}



Definition at line 155 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
155                                     \{
156     \hyperlink{classlbann_1_1fully__connected__layer_a91f359a41cfbab6f21bd67bccb8409b1}{deallocate\_matrices}();
157   \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a8cc9a10e336f61ef54d5e3f4a9ffdfb8}\label{classlbann_1_1fully__connected__layer_a8cc9a10e336f61ef54d5e3f4a9ffdfb8}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!bp\+\_\+compute@{bp\+\_\+compute}}
\index{bp\+\_\+compute@{bp\+\_\+compute}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{bp\+\_\+compute()}{bp\_compute()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::bp\+\_\+compute (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Perform the computation for the backward propagation step. 

Implements \hyperlink{classlbann_1_1Layer_a7442e01f9ee1294df2de811efcf5171e}{lbann\+::\+Layer}.



Definition at line 276 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
276                              \{
277     \textcolor{keywordflow}{if}(this->\hyperlink{classlbann_1_1Layer_af7881cb5eff5207c15fa835d65462e8f}{m\_using\_gpus}) \{
278       \hyperlink{classlbann_1_1fully__connected__layer_a521aa4a5b88ef00f554fe21a850f6596}{bp\_compute\_cuda}();
279     \} \textcolor{keywordflow}{else} \{
280       \hyperlink{classlbann_1_1fully__connected__layer_affbaa1ecb08e45ff6f9ab195227d0084}{bp\_compute\_cpu}();
281     \}
282   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a4c5b0eea2036c41b15ec03594dac8dc2}\label{classlbann_1_1fully__connected__layer_a4c5b0eea2036c41b15ec03594dac8dc2}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!bp\+\_\+compute\+\_\+cpu@{bp\+\_\+compute\+\_\+cpu}}
\index{bp\+\_\+compute\+\_\+cpu@{bp\+\_\+compute\+\_\+cpu}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{bp\+\_\+compute\+\_\+cpu()}{bp\_compute\_cpu()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily template$<$$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ \hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08dbac94d7b0e44ab8bdcdad694a673cdeae0}{data\+\_\+layout\+::\+M\+O\+D\+E\+L\+\_\+\+P\+A\+R\+A\+L\+L\+EL} $>$\+::bp\+\_\+compute\+\_\+cpu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 84 of file fully\+\_\+connected.\+cpp.


\begin{DoxyCode}
84                                                                       \{
85 
86   \textcolor{comment}{// Effective mini-batch size}
87   \textcolor{keyword}{const} \textcolor{keywordtype}{int} mini\_batch\_size = this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->
      \hyperlink{classlbann_1_1model_a2a9b4cfa1c8c91e4131908751f9c4a6a}{get\_effective\_mini\_batch\_size}();
88 
89   \textcolor{comment}{// Matrices}
90   \textcolor{keyword}{const} \textcolor{keyword}{auto}& linearity = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values();
91   \textcolor{keyword}{const} \textcolor{keyword}{auto}& input = \hyperlink{classlbann_1_1Layer_a45853df73a2e72bfaa774665a0f37ed7}{get\_prev\_activations}();
92   \textcolor{keyword}{const} \textcolor{keyword}{auto}& gradient\_wrt\_output = \hyperlink{classlbann_1_1Layer_a7ac4579d3c1671dfaf86e3b618d6938a}{get\_prev\_error\_signals}();
93   \textcolor{keyword}{auto}& gradient\_wrt\_input = \hyperlink{classlbann_1_1Layer_adb561e140e0bb601f3c5a8ee053a71d2}{get\_error\_signals}();
94   \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_linearity = linearity.LockedMatrix();
95   \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_input = input.LockedMatrix();
96   \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_gradient\_wrt\_output = gradient\_wrt\_output.LockedMatrix();
97   \textcolor{keyword}{auto}& local\_gradient\_wrt\_input = gradient\_wrt\_input.Matrix();
98 
99   \textcolor{comment}{// Compute gradient w.r.t. bias if needed}
100   optimizer* bias\_optimizer = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_optimizer();
101   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} != DataType(0)
102       && bias\_optimizer != \textcolor{keyword}{nullptr}) \{
103     \hyperlink{namespaceEl_a584f088a3325a8222d4d6ac37be04b04}{El::RowSum}(local\_gradient\_wrt\_output,
104                \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient}->Matrix());
105     bias\_optimizer->add\_to\_gradient\_staging(
106       *\hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient},
107       \hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} / mini\_batch\_size);
108   \}
109 
110   \textcolor{comment}{// Compute gradient w.r.t. linearity if needed}
111   \textcolor{comment}{// Note: Perform GEMMs independently if possible}
112   optimizer* linearity\_optimizer = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_optimizer();
113   \textcolor{keywordflow}{if} (linearity\_optimizer != \textcolor{keyword}{nullptr}) \{
114     \textcolor{keywordflow}{if} (linearity.DistSize() == 1) \{
115       El::Gemm(El::NORMAL, El::TRANSPOSE,
116                DataType(1), local\_gradient\_wrt\_output, local\_input,
117                DataType(0), \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient}->Matrix());
118       linearity\_optimizer->add\_to\_gradient\_staging(
119         *\hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient},
120         DataType(1) / mini\_batch\_size);
121     \} \textcolor{keywordflow}{else} \{
122       El::Gemm(El::NORMAL, El::TRANSPOSE,
123                DataType(1), gradient\_wrt\_output, input,
124                DataType(0), *\hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient});
125       linearity\_optimizer->add\_to\_gradient(
126         *\hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient},
127         DataType(1) / mini\_batch\_size);
128     \}
129   \}
130 
131   \textcolor{comment}{// Compute gradient w.r.t. input}
132   \textcolor{comment}{// Note: Perform GEMMs independently if possible}
133   \textcolor{keywordflow}{if} (linearity.DistSize() == 1) \{
134     El::Gemm(El::TRANSPOSE, El::NORMAL,
135              DataType(1), local\_linearity, local\_gradient\_wrt\_output,
136              DataType(1), local\_gradient\_wrt\_input);
137   \} \textcolor{keywordflow}{else} \{
138     El::Gemm(El::TRANSPOSE, El::NORMAL,
139              DataType(1), linearity, gradient\_wrt\_output,
140              DataType(1), gradient\_wrt\_input);
141   \}
142 
143 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer_a4c5b0eea2036c41b15ec03594dac8dc2_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_af65e177e5f2b1a1d2854a04b433f7dae}\label{classlbann_1_1fully__connected__layer_af65e177e5f2b1a1d2854a04b433f7dae}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!bp\+\_\+compute\+\_\+cpu@{bp\+\_\+compute\+\_\+cpu}}
\index{bp\+\_\+compute\+\_\+cpu@{bp\+\_\+compute\+\_\+cpu}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{bp\+\_\+compute\+\_\+cpu()}{bp\_compute\_cpu()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily template$<$$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ \hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08dba37d2a3465f7cbf4ab60f4e79944d0638}{data\+\_\+layout\+::\+D\+A\+T\+A\+\_\+\+P\+A\+R\+A\+L\+L\+EL} $>$\+::bp\+\_\+compute\+\_\+cpu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 173 of file fully\+\_\+connected.\+cpp.


\begin{DoxyCode}
173                                                                      \{
174 
175   \textcolor{comment}{// Effective mini-batch size}
176   \textcolor{keyword}{const} \textcolor{keywordtype}{int} mini\_batch\_size = this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->
      \hyperlink{classlbann_1_1model_a2a9b4cfa1c8c91e4131908751f9c4a6a}{get\_effective\_mini\_batch\_size}();
177 
178   \textcolor{comment}{// Matrices}
179   \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_linearity = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values().LockedMatrix();
180   \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_input = \hyperlink{classlbann_1_1Layer_a35397843bb0c84030000c7d872229acb}{get\_local\_prev\_activations}();
181   \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_gradient\_wrt\_output = \hyperlink{classlbann_1_1Layer_a82827edc5e869960144f3ccb2172bfcd}{get\_local\_prev\_error\_signals}();
182   \textcolor{keyword}{auto}& local\_gradient\_wrt\_input = \hyperlink{classlbann_1_1Layer_af178d00b9d878aa7d87754bff2a91f3a}{get\_local\_error\_signals}();
183 
184   \textcolor{comment}{// Compute gradient w.r.t. bias if needed}
185   optimizer* bias\_optimizer = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_optimizer();
186   \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} != DataType(0)
187       && bias\_optimizer != \textcolor{keyword}{nullptr}) \{
188     \hyperlink{namespaceEl_a584f088a3325a8222d4d6ac37be04b04}{El::RowSum}(local\_gradient\_wrt\_output,
189                \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient}->Matrix());
190     bias\_optimizer->add\_to\_gradient\_staging(
191       *\hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient},
192       \hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} / mini\_batch\_size);
193   \}
194 
195   \textcolor{comment}{// Compute gradient w.r.t. linearity if needed}
196   optimizer* linearity\_optimizer = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_optimizer();
197   \textcolor{keywordflow}{if} (linearity\_optimizer != \textcolor{keyword}{nullptr}) \{
198     El::Gemm(El::NORMAL, El::TRANSPOSE,
199              DataType(1), local\_gradient\_wrt\_output, local\_input,
200              DataType(0), \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient}->Matrix());
201     linearity\_optimizer->add\_to\_gradient\_staging(
202       *\hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient},
203       DataType(1) / mini\_batch\_size);
204   \}
205 
206   \textcolor{comment}{// Compute gradient w.r.t. input}
207   El::Gemm(El::TRANSPOSE, El::NORMAL,
208            DataType(1), local\_linearity, local\_gradient\_wrt\_output,
209            DataType(1), local\_gradient\_wrt\_input);
210 
211 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer_af65e177e5f2b1a1d2854a04b433f7dae_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_affbaa1ecb08e45ff6f9ab195227d0084}\label{classlbann_1_1fully__connected__layer_affbaa1ecb08e45ff6f9ab195227d0084}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!bp\+\_\+compute\+\_\+cpu@{bp\+\_\+compute\+\_\+cpu}}
\index{bp\+\_\+compute\+\_\+cpu@{bp\+\_\+compute\+\_\+cpu}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{bp\+\_\+compute\+\_\+cpu()}{bp\_compute\_cpu()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::bp\+\_\+compute\+\_\+cpu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}

C\+PU implementation of backward prop computation. \mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a521aa4a5b88ef00f554fe21a850f6596}\label{classlbann_1_1fully__connected__layer_a521aa4a5b88ef00f554fe21a850f6596}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!bp\+\_\+compute\+\_\+cuda@{bp\+\_\+compute\+\_\+cuda}}
\index{bp\+\_\+compute\+\_\+cuda@{bp\+\_\+compute\+\_\+cuda}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{bp\+\_\+compute\+\_\+cuda()}{bp\_compute\_cuda()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::bp\+\_\+compute\+\_\+cuda (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}

G\+PU implementation of backward prop computation. 

Definition at line 353 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
353                          \{
354 \textcolor{preprocessor}{#ifndef LBANN\_HAS\_CUDNN}
355     \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"fully\_connected: CUDA not detected"});
356 \textcolor{preprocessor}{#else}
357 
358     \textcolor{comment}{// GPU matrices}
359     \textcolor{keyword}{const} \textcolor{keyword}{auto}& linearity\_d = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values\_gpu();
360     \textcolor{keyword}{const} \textcolor{keyword}{auto}& input\_d = this->m\_prev\_activations\_d[0];
361     \textcolor{keyword}{const} \textcolor{keyword}{auto}& gradient\_wrt\_output\_d = this->m\_prev\_error\_signals\_d[0];
362     \textcolor{keyword}{auto}& gradient\_wrt\_input\_d = this->m\_error\_signals\_d[0];
363     
364     \textcolor{comment}{// Matrix parameters}
365     \textcolor{keyword}{const} \textcolor{keywordtype}{int} input\_size = \hyperlink{classlbann_1_1Layer_a27112eb70bbfbd7f3c3e749960400dec}{get\_num\_prev\_neurons}();
366     \textcolor{keyword}{const} \textcolor{keywordtype}{int} output\_size = \hyperlink{classlbann_1_1Layer_aa4de686cc6c2dd38166f42faf874f227}{get\_num\_neurons}();
367     \textcolor{keyword}{const} \textcolor{keywordtype}{int} mini\_batch\_size = m\_mini\_batch\_size\_per\_gpu;
368     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_gpus = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_num\_gpus();
369     \textcolor{keyword}{const} \textcolor{keywordtype}{int} input\_ldim = input\_d.get\_leading\_dim();
370     \textcolor{keyword}{const} \textcolor{keywordtype}{int} gradient\_wrt\_output\_ldim = gradient\_wrt\_output\_d.get\_leading\_dim();
371     \textcolor{keyword}{const} \textcolor{keywordtype}{int} gradient\_wrt\_input\_ldim = gradient\_wrt\_input\_d.get\_leading\_dim();
372 
373     \textcolor{comment}{// Compute gradient w.r.t. bias if needed}
374     optimizer* bias\_optimizer = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_optimizer();
375     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} != DataType(0)
376         && bias\_optimizer != \textcolor{keyword}{nullptr}) \{
377 
378       \textcolor{comment}{// Initialize work space with ones}
379       cudnn::matrix ones\_d(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn});
380       ones\_d.attach\_to\_work\_spaces(mini\_batch\_size);
381       \hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->set\_on\_gpus(ones\_d.get\_data(), DataType(1), mini\_batch\_size);
382 
383       \textcolor{comment}{// Obtain gradient with a sum over rows}
384       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_gpus; ++i) \{
385         CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
386         cublas::gemv(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_cublas\_handle(i),
387                      CUBLAS\_OP\_N, 
388                      output\_size, mini\_batch\_size,
389                      DataType(1),
390                      gradient\_wrt\_output\_d.get\_locked\_data(i), gradient\_wrt\_output\_ldim,
391                      ones\_d.get\_data(i), 1,
392                      DataType(0),
393                      m\_bias\_gradient\_d.get\_data(i), 1);
394       \}
395       bias\_optimizer->add\_to\_gradient\_staging(
396         m\_bias\_gradient\_d,
397         \hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} / this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->
      \hyperlink{classlbann_1_1model_a2a9b4cfa1c8c91e4131908751f9c4a6a}{get\_effective\_mini\_batch\_size}());
398     \}
399       
400     \textcolor{comment}{// Compute gradient w.r.t. linearity if needed}
401     optimizer* linearity\_optimizer = this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_optimizer();
402     \textcolor{keywordflow}{if} (linearity\_optimizer != \textcolor{keyword}{nullptr}) \{
403       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_gpus; ++i) \{
404         CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
405         cublas::gemm(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_cublas\_handle(i),
406                      CUBLAS\_OP\_N, CUBLAS\_OP\_T,
407                      output\_size, input\_size, mini\_batch\_size,
408                      DataType(1),
409                      gradient\_wrt\_output\_d.get\_locked\_data(i), gradient\_wrt\_output\_ldim,
410                      input\_d.get\_locked\_data(i), input\_ldim,
411                      DataType(0),
412                      m\_linearity\_gradient\_d.get\_data(i), output\_size);
413       \}
414       linearity\_optimizer->add\_to\_gradient\_staging(
415         m\_linearity\_gradient\_d,
416         DataType(1) / this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->\hyperlink{classlbann_1_1model_a2a9b4cfa1c8c91e4131908751f9c4a6a}{get\_effective\_mini\_batch\_size}());
417     \}
418 
419     \textcolor{comment}{// Compute gradient w.r.t. input}
420     \textcolor{keywordflow}{if} (mini\_batch\_size != 0) \{
421       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_gpus; ++i) \{
422         CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
423         cublas::gemm(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_cublas\_handle(i),
424                      CUBLAS\_OP\_T, CUBLAS\_OP\_N,
425                      input\_size, mini\_batch\_size, output\_size,
426                      DataType(1),
427                      linearity\_d[i], output\_size,
428                      gradient\_wrt\_output\_d.get\_locked\_data(i), gradient\_wrt\_output\_ldim,
429                      DataType(1),
430                      gradient\_wrt\_input\_d.get\_data(i), gradient\_wrt\_input\_ldim);
431       \}
432     \}
433 
434 \textcolor{preprocessor}{#endif // LBANN\_HAS\_CUDNN}
435   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer_a521aa4a5b88ef00f554fe21a850f6596_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a7e838b85cb7bf075def5a88fba2ace20}\label{classlbann_1_1fully__connected__layer_a7e838b85cb7bf075def5a88fba2ace20}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!copy@{copy}}
\index{copy@{copy}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{copy()}{copy()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
\hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer}$\ast$ \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::copy (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Copy function. This function dynamically allocates memory for a layer instance and instantiates a copy. The caller is responsible for deallocating the instance. 

Implements \hyperlink{classlbann_1_1Layer_af420f22bbac801c85483ade84588a23f}{lbann\+::\+Layer}.



Definition at line 159 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
159                                                \{
160     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \hyperlink{classlbann_1_1fully__connected__layer_ae5d9a0f2851f3c55abe47aa65afbe66c}{fully\_connected\_layer}(*\textcolor{keyword}{this});
161   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a91f359a41cfbab6f21bd67bccb8409b1}\label{classlbann_1_1fully__connected__layer_a91f359a41cfbab6f21bd67bccb8409b1}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!deallocate\+\_\+matrices@{deallocate\+\_\+matrices}}
\index{deallocate\+\_\+matrices@{deallocate\+\_\+matrices}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{deallocate\+\_\+matrices()}{deallocate\_matrices()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::deallocate\+\_\+matrices (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}

Deallocate distributed matrices. 

Definition at line 438 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
438                              \{
439     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient} != \textcolor{keyword}{nullptr}) \textcolor{keyword}{delete} 
      \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient};
440     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient} != \textcolor{keyword}{nullptr}) \textcolor{keyword}{delete} \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient};
441   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a6dac6598c6b4ad3f766c5f0e88035f10}\label{classlbann_1_1fully__connected__layer_a6dac6598c6b4ad3f766c5f0e88035f10}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!fp\+\_\+compute@{fp\+\_\+compute}}
\index{fp\+\_\+compute@{fp\+\_\+compute}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{fp\+\_\+compute()}{fp\_compute()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::fp\+\_\+compute (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Perform the computation for the forward propagation step. 

Implements \hyperlink{classlbann_1_1Layer_a523319dd1bd87a0612afa1912bb5aad7}{lbann\+::\+Layer}.



Definition at line 268 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
268                              \{
269     \textcolor{keywordflow}{if}(this->\hyperlink{classlbann_1_1Layer_af7881cb5eff5207c15fa835d65462e8f}{m\_using\_gpus}) \{
270       \hyperlink{classlbann_1_1fully__connected__layer_a720c048ee32b5620a99886177be4f577}{fp\_compute\_cuda}();
271     \} \textcolor{keywordflow}{else} \{
272       \hyperlink{classlbann_1_1fully__connected__layer_a732ac5715ba0cea535c2bd062f634527}{fp\_compute\_cpu}();
273     \}
274   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a6c2be8390e58d9b224e901b8500b2b3c}\label{classlbann_1_1fully__connected__layer_a6c2be8390e58d9b224e901b8500b2b3c}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!fp\+\_\+compute\+\_\+cpu@{fp\+\_\+compute\+\_\+cpu}}
\index{fp\+\_\+compute\+\_\+cpu@{fp\+\_\+compute\+\_\+cpu}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{fp\+\_\+compute\+\_\+cpu()}{fp\_compute\_cpu()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily template$<$$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ \hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08dbac94d7b0e44ab8bdcdad694a673cdeae0}{data\+\_\+layout\+::\+M\+O\+D\+E\+L\+\_\+\+P\+A\+R\+A\+L\+L\+EL} $>$\+::fp\+\_\+compute\+\_\+cpu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 50 of file fully\+\_\+connected.\+cpp.


\begin{DoxyCode}
50                                                                       \{
51 
52   \textcolor{comment}{// Matrices}
53   \textcolor{keyword}{const} \textcolor{keyword}{auto}& input = \hyperlink{classlbann_1_1Layer_a45853df73a2e72bfaa774665a0f37ed7}{get\_prev\_activations}();
54   \textcolor{keyword}{auto}& output = \hyperlink{classlbann_1_1Layer_a1134b1a4385af199d7272c5aa827fa99}{get\_activations}();
55 
56   \textcolor{comment}{// Apply linearity}
57   \textcolor{comment}{// Note: Perform GEMMs independently if possible}
58   \textcolor{keyword}{const} \textcolor{keyword}{auto}& linearity = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values();
59   \textcolor{keywordflow}{if} (linearity.DistSize() == 1) \{
60     El::Gemm(El::NORMAL, El::NORMAL,
61              DataType(1), linearity.LockedMatrix(), input.LockedMatrix(),
62              DataType(0), output.Matrix());
63   \} \textcolor{keywordflow}{else} \{
64     El::Gemm(El::NORMAL, El::NORMAL,
65              DataType(1), linearity, input,
66              DataType(0), output);
67   \}
68 
69   \textcolor{comment}{// Apply bias if needed}
70   \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} != DataType(0)) \{
71     \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_bias = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_values().LockedMatrix();
72     \textcolor{keyword}{auto}& local\_output = output.Matrix();
73     El::IndexDependentMap(local\_output,
74                           (std::function<DataType(El::Int,El::Int,\textcolor{keyword}{const} DataType&)>)
75                           ([\textcolor{keyword}{this},&local\_bias](El::Int r, El::Int c,\textcolor{keyword}{const} DataType& z)
76                            ->DataType \{
77                             \textcolor{keywordflow}{return} z + \hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} * local\_bias(r, 0);
78                           \}));
79   \}
80 
81 \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a97243a5aa3474ff70c6f2d7f7e995e65}\label{classlbann_1_1fully__connected__layer_a97243a5aa3474ff70c6f2d7f7e995e65}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!fp\+\_\+compute\+\_\+cpu@{fp\+\_\+compute\+\_\+cpu}}
\index{fp\+\_\+compute\+\_\+cpu@{fp\+\_\+compute\+\_\+cpu}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{fp\+\_\+compute\+\_\+cpu()}{fp\_compute\_cpu()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily template$<$$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ \hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08dba37d2a3465f7cbf4ab60f4e79944d0638}{data\+\_\+layout\+::\+D\+A\+T\+A\+\_\+\+P\+A\+R\+A\+L\+L\+EL} $>$\+::fp\+\_\+compute\+\_\+cpu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Definition at line 146 of file fully\+\_\+connected.\+cpp.


\begin{DoxyCode}
146                                                                      \{
147 
148   \textcolor{comment}{// Matrices}
149   \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_input = \hyperlink{classlbann_1_1Layer_a35397843bb0c84030000c7d872229acb}{get\_local\_prev\_activations}();
150   \textcolor{keyword}{auto}& local\_output = \hyperlink{classlbann_1_1Layer_a4248f27acebf72b7b7b3ee39c8bcb62a}{get\_local\_activations}();
151 
152   \textcolor{comment}{// Apply linearity}
153   \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_linearity = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values().LockedMatrix();
154   El::Gemm(El::NORMAL, El::NORMAL,
155            DataType(1), local\_linearity, local\_input,
156            DataType(0), local\_output);
157 
158   \textcolor{comment}{// Apply bias if needed}
159   \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} != DataType(0)) \{
160     \textcolor{keyword}{const} \textcolor{keyword}{auto}& local\_bias = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_values().LockedMatrix();
161     El::IndexDependentMap(local\_output,
162                           (std::function<DataType(El::Int,El::Int,\textcolor{keyword}{const} DataType&)>)
163                           ([\textcolor{keyword}{this},&local\_bias](El::Int r, El::Int c,\textcolor{keyword}{const} DataType& z)
164                            ->DataType \{
165                             \textcolor{keywordflow}{return} z + \hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} * local\_bias(r, 0);
166                           \}));
167   \}
168 
169 \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a732ac5715ba0cea535c2bd062f634527}\label{classlbann_1_1fully__connected__layer_a732ac5715ba0cea535c2bd062f634527}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!fp\+\_\+compute\+\_\+cpu@{fp\+\_\+compute\+\_\+cpu}}
\index{fp\+\_\+compute\+\_\+cpu@{fp\+\_\+compute\+\_\+cpu}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{fp\+\_\+compute\+\_\+cpu()}{fp\_compute\_cpu()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::fp\+\_\+compute\+\_\+cpu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}

C\+PU implementation of forward prop computation. \mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a720c048ee32b5620a99886177be4f577}\label{classlbann_1_1fully__connected__layer_a720c048ee32b5620a99886177be4f577}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!fp\+\_\+compute\+\_\+cuda@{fp\+\_\+compute\+\_\+cuda}}
\index{fp\+\_\+compute\+\_\+cuda@{fp\+\_\+compute\+\_\+cuda}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{fp\+\_\+compute\+\_\+cuda()}{fp\_compute\_cuda()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::fp\+\_\+compute\+\_\+cuda (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}

G\+PU implementation of forward prop computation. 

Definition at line 292 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
292                          \{
293 \textcolor{preprocessor}{#ifndef LBANN\_HAS\_CUDNN}
294     \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"fully\_connected: CUDA not detected"});
295 \textcolor{preprocessor}{#else}
296 
297     \textcolor{comment}{// GPU matrices}
298     \textcolor{keyword}{const} \textcolor{keyword}{auto}& linearity\_d = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_values\_gpu();
299     \textcolor{keyword}{const} \textcolor{keyword}{auto}& input\_d = this->m\_prev\_activations\_d[0];
300     \textcolor{keyword}{auto}& output\_d = this->m\_activations\_d[0];
301     
302     \textcolor{comment}{// Matrix parameters}
303     \textcolor{keyword}{const} \textcolor{keywordtype}{int} input\_size = \hyperlink{classlbann_1_1Layer_a27112eb70bbfbd7f3c3e749960400dec}{get\_num\_prev\_neurons}();
304     \textcolor{keyword}{const} \textcolor{keywordtype}{int} output\_size = \hyperlink{classlbann_1_1Layer_aa4de686cc6c2dd38166f42faf874f227}{get\_num\_neurons}();
305     \textcolor{keyword}{const} \textcolor{keywordtype}{int} mini\_batch\_size = m\_mini\_batch\_size\_per\_gpu;
306     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_gpus = this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_num\_gpus();
307     \textcolor{keyword}{const} \textcolor{keywordtype}{int} input\_ldim = input\_d.get\_leading\_dim();
308     \textcolor{keyword}{const} \textcolor{keywordtype}{int} output\_ldim = output\_d.get\_leading\_dim();
309 
310     \textcolor{comment}{// Stop early if possible}
311     \textcolor{keywordflow}{if} (mini\_batch\_size == 0) \{ \textcolor{keywordflow}{return}; \}
312 
313     \textcolor{comment}{// Apply linearity}
314     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<num\_gpus; ++i) \{
315       CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
316       cublas::gemm(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_cublas\_handle(i),
317                    CUBLAS\_OP\_N, CUBLAS\_OP\_N,
318                    output\_size, mini\_batch\_size, input\_size,
319                    DataType(1),
320                    linearity\_d[i], output\_size,
321                    input\_d.get\_locked\_data(i), input\_ldim,
322                    DataType(0),
323                    output\_d.get\_data(i), output\_ldim);
324     \}
325 
326     \textcolor{comment}{// Apply bias if needed}
327     \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} != DataType(0)) \{
328       \textcolor{keyword}{const} \textcolor{keyword}{auto}& bias\_d = \hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_values\_gpu();
329       
330       \textcolor{comment}{// Initialize work space with ones}
331       cudnn::matrix ones\_d(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn});
332       ones\_d.attach\_to\_work\_spaces(mini\_batch\_size);
333       \hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->set\_on\_gpus(ones\_d.get\_data(), DataType(1), mini\_batch\_size);
334 
335       \textcolor{comment}{// Apply bias with outer product}
336       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < num\_gpus; ++i) \{
337         CHECK\_CUDA(cudaSetDevice(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_gpu(i)));
338         cublas::gemm(this->\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn}->get\_cublas\_handle(i),
339                      CUBLAS\_OP\_N, CUBLAS\_OP\_T,
340                      output\_size, mini\_batch\_size, 1,
341                      DataType(1),
342                      bias\_d[i], output\_size,
343                      ones\_d.get\_data(i), mini\_batch\_size,
344                      DataType(1),
345                      output\_d.get\_data(i), output\_ldim);
346       \}
347 
348     \}
349 \textcolor{preprocessor}{#endif // LBANN\_HAS\_CUDNN}
350   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a0d84bbfa7df80e879da13f54d465a603}\label{classlbann_1_1fully__connected__layer_a0d84bbfa7df80e879da13f54d465a603}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!get\+\_\+data\+\_\+layout@{get\+\_\+data\+\_\+layout}}
\index{get\+\_\+data\+\_\+layout@{get\+\_\+data\+\_\+layout}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{get\+\_\+data\+\_\+layout()}{get\_data\_layout()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
\hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08db}{data\+\_\+layout} \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::get\+\_\+data\+\_\+layout (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Get data layout of the data tensors. We assume that the data layouts of the previous activations, activations, previous error signals, and error signals are the same. Each concrete layer that is templated on its data layout should override this function to return its template parameter. 

Implements \hyperlink{classlbann_1_1Layer_a5dfb66e81fc085997402a5e2241316bd}{lbann\+::\+Layer}.



Definition at line 165 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
165 \{ \textcolor{keywordflow}{return} T\_layout; \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a7ce678ec7560dd145244ffd8813d5edb}\label{classlbann_1_1fully__connected__layer_a7ce678ec7560dd145244ffd8813d5edb}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!get\+\_\+description@{get\+\_\+description}}
\index{get\+\_\+description@{get\+\_\+description}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{get\+\_\+description()}{get\_description()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
std\+::string \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::get\+\_\+description (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Returns description of ctor params 

Reimplemented from \hyperlink{classlbann_1_1Layer_acc0803d3428914ca1eb5988c4309174a}{lbann\+::\+Layer}.



Definition at line 103 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
103                                              \{
104     \textcolor{keywordflow}{return} std::string \{\} +
105      \textcolor{stringliteral}{" fully\_connected; num\_neurons: "}
106      + std::to\_string(this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons})
107      + \textcolor{stringliteral}{" has\_bias: "} + std::to\_string(this->\hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor})
108      + \textcolor{stringliteral}{" dataLayout: "} + this->\hyperlink{classlbann_1_1Layer_ae3f4a5602df821f4221614b1e3782dc1}{get\_data\_layout\_string}(
      \hyperlink{classlbann_1_1fully__connected__layer_a0d84bbfa7df80e879da13f54d465a603}{get\_data\_layout}());
109   \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_abd51271a19a8cce44ba4f2d11eaaaee7}\label{classlbann_1_1fully__connected__layer_abd51271a19a8cce44ba4f2d11eaaaee7}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!get\+\_\+type@{get\+\_\+type}}
\index{get\+\_\+type@{get\+\_\+type}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{get\+\_\+type()}{get\_type()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
std\+::string \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::get\+\_\+type (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Get the layer type\textquotesingle{}s name. A layer type name should be brief, human-\/readable description of the layer\textquotesingle{}s mathematical operation. 

Implements \hyperlink{classlbann_1_1Layer_a0fa0ea9160b490c151c0a17fde4f7239}{lbann\+::\+Layer}.



Definition at line 163 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
163 \{ \textcolor{keywordflow}{return} \textcolor{stringliteral}{"fully connected"}; \}
\end{DoxyCode}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_ab06d01021d4e89cd2f4f64c330e7cc31}\label{classlbann_1_1fully__connected__layer_ab06d01021d4e89cd2f4f64c330e7cc31}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!operator=@{operator=}}
\index{operator=@{operator=}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{operator=()}{operator=()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
\hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer}\& \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::operator= (\begin{DoxyParamCaption}\item[{const \hyperlink{classlbann_1_1fully__connected__layer}{fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$ \&}]{other }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 132 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
132                                                                        \{
133     \hyperlink{classlbann_1_1Layer_a00d8acde68fda2f38c4a39ef8c89234a}{learning\_layer::operator=}(other);
134     \hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} = other.m\_bias\_scaling\_factor;
135 
136     \textcolor{comment}{// Deep matrix copies}
137     \hyperlink{classlbann_1_1fully__connected__layer_a91f359a41cfbab6f21bd67bccb8409b1}{deallocate\_matrices}();
138     \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient} = other.m\_linearity\_gradient;
139     \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient} = other.m\_bias\_gradient;
140     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient} != \textcolor{keyword}{nullptr}) \{
141       \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient} = \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient}->Copy();
142     \}
143     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient} != \textcolor{keyword}{nullptr}) \{
144       \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient} = \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient}->Copy();
145     \}
146 
147 \textcolor{preprocessor}{  #ifdef LBANN\_HAS\_CUDNN}
148     m\_linearity\_gradient\_d = other.m\_linearity\_gradient\_d;
149     m\_bias\_gradient\_d = other.m\_bias\_gradient\_d;
150 \textcolor{preprocessor}{  #endif // LBANN\_HAS\_CUDNN}
151 
152     \textcolor{keywordflow}{return} *\textcolor{keyword}{this};
153   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer_ab06d01021d4e89cd2f4f64c330e7cc31_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_aec4298146845489597126503177d3127}\label{classlbann_1_1fully__connected__layer_aec4298146845489597126503177d3127}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!setup\+\_\+data@{setup\+\_\+data}}
\index{setup\+\_\+data@{setup\+\_\+data}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{setup\+\_\+data()}{setup\_data()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::setup\+\_\+data (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Setup layer data. Called by the setup function. The base method sets the previous activation, activation, previous error signal, and error signal matrices to zero matrices with the proper dimensions. Matrix buffers are pinned if needed for G\+PU transfers. 

Reimplemented from \hyperlink{classlbann_1_1Layer_a50a89f8a68762c677d48efe384676e81}{lbann\+::\+Layer}.



Definition at line 184 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
184                              \{
185     \hyperlink{classlbann_1_1Layer_a50a89f8a68762c677d48efe384676e81}{learning\_layer::setup\_data}();
186 
187     \textcolor{comment}{// Initialize default weights if none are provided}
188     \textcolor{keywordflow}{if} (this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}.size() > 2) \{
189       std::stringstream err;
190       err << \_\_FILE\_\_ << \textcolor{stringliteral}{" "} << \_\_LINE\_\_ << \textcolor{stringliteral}{" :: "}
191           << \textcolor{stringliteral}{"attempted to setup "} << \hyperlink{classlbann_1_1Layer_aa47109ad09b399142fa92f9d3702189f}{m\_name} << \textcolor{stringliteral}{" with an invalid number of weights"};
192       \textcolor{keywordflow}{throw} lbann\_exception(err.str());
193     \}
194     this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}.resize(2, \textcolor{keyword}{nullptr});
195     \textcolor{keywordflow}{if} (this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0] == \textcolor{keyword}{nullptr}) \{
196       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0] = \textcolor{keyword}{new} weights(this->\hyperlink{classlbann_1_1Layer_a5de05c52f22e0bbd7c703bec3ad4dbf2}{m\_comm}, this->
      \hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn});
197       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->set\_name(this->m\_name + \textcolor{stringliteral}{"\_linearity\_weights"});
198       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->set\_initializer(\textcolor{keyword}{new} he\_normal\_initializer(this->
      \hyperlink{classlbann_1_1Layer_a5de05c52f22e0bbd7c703bec3ad4dbf2}{m\_comm}));
199       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->set\_optimizer(\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->
      \hyperlink{classlbann_1_1model_a0d2d5a1eac592e5721a81a9b9ea4b7f2}{create\_optimizer}());
200       this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->\hyperlink{classlbann_1_1model_af35fca77e75eb6dd570e4727aa3d5b6b}{add\_weights}(this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]);
201     \}
202     \textcolor{keywordflow}{if} (this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1] == \textcolor{keyword}{nullptr}) \{
203       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1] = \textcolor{keyword}{new} weights(this->\hyperlink{classlbann_1_1Layer_a5de05c52f22e0bbd7c703bec3ad4dbf2}{m\_comm}, this->
      \hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn});
204       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->set\_name(this->m\_name + \textcolor{stringliteral}{"\_bias\_weights"});
205       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->set\_optimizer(\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->
      \hyperlink{classlbann_1_1model_a0d2d5a1eac592e5721a81a9b9ea4b7f2}{create\_optimizer}());
206       this->\hyperlink{classlbann_1_1Layer_a3d9315e99574166f2f33e37b572021d2}{m\_model}->\hyperlink{classlbann_1_1model_af35fca77e75eb6dd570e4727aa3d5b6b}{add\_weights}(this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]);
207     \}
208 
209     \textcolor{comment}{// Initialize Glorot or He weight initialization}
210     \textcolor{keyword}{auto}* cast\_initializer
211       = \textcolor{keyword}{dynamic\_cast<}fan\_in\_fan\_out\_initializer*\textcolor{keyword}{>}(&this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_initializer());
212     \textcolor{keywordflow}{if} (cast\_initializer != \textcolor{keyword}{nullptr}) \{
213       cast\_initializer->set\_fan\_in(this->\hyperlink{classlbann_1_1Layer_ac7b30f4e28d58204bfcbb76886f9136d}{m\_num\_prev\_neurons});
214       cast\_initializer->set\_fan\_out(this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons});
215     \}
216 
217     \textcolor{comment}{// Setup weights}
218     \textcolor{comment}{// Note: linearity matrix is duplicated across processes unless}
219     \textcolor{comment}{// the data layout is model-parallel.}
220     El::Distribution col\_dist = El::STAR;
221     El::Distribution row\_dist = El::STAR;
222     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1fully__connected__layer_a0d84bbfa7df80e879da13f54d465a603}{get\_data\_layout}() == \hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08dbac94d7b0e44ab8bdcdad694a673cdeae0}{data\_layout::MODEL\_PARALLEL}) \{
223       col\_dist = El::MC;
224       row\_dist = El::MR;
225     \}
226     this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->setup(this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons},
227                               this->\hyperlink{classlbann_1_1Layer_ac7b30f4e28d58204bfcbb76886f9136d}{m\_num\_prev\_neurons},
228                               col\_dist, row\_dist);
229     this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->setup(this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons},
230                               1,
231                               \hyperlink{classlbann_1_1Layer_a1134b1a4385af199d7272c5aa827fa99}{get\_activations}().DistData().colDist,
232                               El::STAR);
233 
234     \textcolor{comment}{// Setup weight gradients}
235     El::Zeros(*this->\hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient},
236               this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_matrix\_height(),
237               this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->get\_matrix\_width());
238     El::Zeros(*this->\hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient},
239               this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_matrix\_height(),
240               this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->get\_matrix\_width());
241 
242     \textcolor{keywordflow}{if} (\hyperlink{classlbann_1_1Layer_afdc60df9731a3ecdeeeb8175fa483676}{m\_frozen}) \{
243       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->freeze();
244       this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->freeze();
245     \} \textcolor{keywordflow}{else} \{
246       \textcolor{keywordflow}{if} (this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[0]->\hyperlink{classlbann_1_1Layer_af3c0f9f32eb631f4fdf34ad040ef8637}{is\_frozen}() || this->\hyperlink{classlbann_1_1Layer_a7954e30fbf9100a6ba4b56d02767a469}{m\_weights}[1]->
      \hyperlink{classlbann_1_1Layer_af3c0f9f32eb631f4fdf34ad040ef8637}{is\_frozen}()) \{
247         \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"fully\_connected\_layer: layer is not frozen but weights are"});
248       \}
249     \}
250   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer_aec4298146845489597126503177d3127_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_aaf38e55b232b1bb2a6336ff1807b5a17}\label{classlbann_1_1fully__connected__layer_aaf38e55b232b1bb2a6336ff1807b5a17}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!setup\+\_\+dims@{setup\+\_\+dims}}
\index{setup\+\_\+dims@{setup\+\_\+dims}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{setup\+\_\+dims()}{setup\_dims()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::setup\+\_\+dims (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Setup tensor dimensions Called by the setup function. The base method sets the dimensions of the activation tensors equal to the dimensions of the first previous activation tensor. 

Reimplemented from \hyperlink{classlbann_1_1Layer_a90fce1b06c1f2abb480e18cfe08a9746}{lbann\+::\+Layer}.



Definition at line 169 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
169                              \{
170     \textcolor{comment}{// Store neuron tensor dimensions}
171     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_neurons = this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons};
172     \textcolor{keyword}{const} \textcolor{keywordtype}{int} num\_neuron\_dims = this->\hyperlink{classlbann_1_1Layer_adfd6178d21498c9095cd947ae1eb2d6a}{m\_num\_neuron\_dims};
173     \textcolor{keyword}{const} std::vector<int> neuron\_dims = this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims};
174 
175     \textcolor{comment}{// Initialize previous neuron tensor dimensions}
176     \hyperlink{classlbann_1_1Layer_a90fce1b06c1f2abb480e18cfe08a9746}{learning\_layer::setup\_dims}();
177 
178     \textcolor{comment}{// Initialize neuron tensor dimensions}
179     this->\hyperlink{classlbann_1_1Layer_a6b5ebc8a7d9329d8a773ed787e7b41d8}{m\_num\_neurons} = num\_neurons;
180     this->\hyperlink{classlbann_1_1Layer_adfd6178d21498c9095cd947ae1eb2d6a}{m\_num\_neuron\_dims} = num\_neuron\_dims;
181     this->\hyperlink{classlbann_1_1Layer_abb34bb8031f57a483e2e327a5f229f48}{m\_neuron\_dims} = neuron\_dims;
182   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer_aaf38e55b232b1bb2a6336ff1807b5a17_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a95c96742a67f2e9398e608b244c2d121}\label{classlbann_1_1fully__connected__layer_a95c96742a67f2e9398e608b244c2d121}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!setup\+\_\+gpu@{setup\+\_\+gpu}}
\index{setup\+\_\+gpu@{setup\+\_\+gpu}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{setup\+\_\+gpu()}{setup\_gpu()}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::setup\+\_\+gpu (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}, {\ttfamily [virtual]}}

Setup G\+PU objects. Called by the setup function if G\+P\+Us are enabled. The base method initializes G\+PU matrices for the previous activations, activations, previous error signals, and error signals. It also initializes cu\+D\+NN tensor descriptors. 

Reimplemented from \hyperlink{classlbann_1_1Layer_a36aa22ef90ce4de65abe729d38490863}{lbann\+::\+Layer}.



Definition at line 252 of file fully\+\_\+connected.\+hpp.


\begin{DoxyCode}
252                             \{
253     \hyperlink{classlbann_1_1Layer_a36aa22ef90ce4de65abe729d38490863}{learning\_layer::setup\_gpu}();
254 \textcolor{preprocessor}{#ifndef LBANN\_HAS\_CUDNN}
255     \textcolor{keywordflow}{throw} lbann\_exception(\textcolor{stringliteral}{"fully\_connected\_layer: CUDA not detected"});
256 \textcolor{preprocessor}{#else}
257     m\_linearity\_gradient\_d = cudnn::matrix(\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn},
258                                            \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient}->Height(),
259                                            \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient}->Width());
260     \textcolor{keywordflow}{if}(\hyperlink{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}{m\_bias\_scaling\_factor} != DataType(0)) \{
261       m\_bias\_gradient\_d = cudnn::matrix(\hyperlink{classlbann_1_1Layer_a08dbb94239e3b8c96329786c57c72e21}{m\_cudnn},
262                                         \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient}->Height(),
263                                         \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient}->Width());
264     \}
265 \textcolor{preprocessor}{#endif // LBANN\_HAS\_CUDNN}
266   \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer_a95c96742a67f2e9398e608b244c2d121_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a1f0ae7a5f172e5ced011eaa2755fd04e}\label{classlbann_1_1fully__connected__layer_a1f0ae7a5f172e5ced011eaa2755fd04e}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!setup\+\_\+matrices@{setup\+\_\+matrices}}
\index{setup\+\_\+matrices@{setup\+\_\+matrices}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{setup\+\_\+matrices()}{setup\_matrices()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily template$<$$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ \hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08dbac94d7b0e44ab8bdcdad694a673cdeae0}{data\+\_\+layout\+::\+M\+O\+D\+E\+L\+\_\+\+P\+A\+R\+A\+L\+L\+EL} $>$\+::setup\+\_\+matrices (\begin{DoxyParamCaption}\item[{const \hyperlink{base_8hpp_a9951bb1719d534e0401b1f06cad19eab}{El\+::\+Grid} \&}]{grid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}

Instantiate distributed matrices. If the layer has already been setup, this function should destroy all matrices and reinstantiate them. However, it is not guaranteed that derived classes will obey this behavior. 

Reimplemented from \hyperlink{classlbann_1_1Layer_a57bbe21131dc00ab5cf9ea5e3656808e}{lbann\+::\+Layer}.



Definition at line 33 of file fully\+\_\+connected.\+cpp.


\begin{DoxyCode}
33                                      \{
34   \hyperlink{classlbann_1_1Layer_a57bbe21131dc00ab5cf9ea5e3656808e}{learning\_layer::setup\_matrices}(grid);
35   \hyperlink{classlbann_1_1fully__connected__layer_a91f359a41cfbab6f21bd67bccb8409b1}{deallocate\_matrices}();
36   \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient} = \textcolor{keyword}{new} \hyperlink{base_8hpp_a50f80e25e2fbefe6b32d270b8d4f8d19}{MCMRMat}(grid);
37   \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient} = \textcolor{keyword}{new} \hyperlink{base_8hpp_a287f9e47262ac9f90fe0cf35073b9839}{MCStarMat}(grid);
38 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer_a1f0ae7a5f172e5ced011eaa2755fd04e_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a9af60f901a84d5604badf078ecbae082}\label{classlbann_1_1fully__connected__layer_a9af60f901a84d5604badf078ecbae082}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!setup\+\_\+matrices@{setup\+\_\+matrices}}
\index{setup\+\_\+matrices@{setup\+\_\+matrices}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{setup\+\_\+matrices()}{setup\_matrices()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily template$<$$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ \hyperlink{base_8hpp_a786677cbfb3f5677b4d84f3056eb08dba37d2a3465f7cbf4ab60f4e79944d0638}{data\+\_\+layout\+::\+D\+A\+T\+A\+\_\+\+P\+A\+R\+A\+L\+L\+EL} $>$\+::setup\+\_\+matrices (\begin{DoxyParamCaption}\item[{const \hyperlink{base_8hpp_a9951bb1719d534e0401b1f06cad19eab}{El\+::\+Grid} \&}]{grid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}

Instantiate distributed matrices. If the layer has already been setup, this function should destroy all matrices and reinstantiate them. However, it is not guaranteed that derived classes will obey this behavior. 

Reimplemented from \hyperlink{classlbann_1_1Layer_a57bbe21131dc00ab5cf9ea5e3656808e}{lbann\+::\+Layer}.



Definition at line 42 of file fully\+\_\+connected.\+cpp.


\begin{DoxyCode}
42                                      \{
43   \hyperlink{classlbann_1_1Layer_a57bbe21131dc00ab5cf9ea5e3656808e}{learning\_layer::setup\_matrices}(grid);
44   \hyperlink{classlbann_1_1fully__connected__layer_a91f359a41cfbab6f21bd67bccb8409b1}{deallocate\_matrices}();
45   \hyperlink{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}{m\_linearity\_gradient} = \textcolor{keyword}{new} \hyperlink{base_8hpp_aba08580d21767b53d0737e115d738dbe}{StarMat}(grid);
46   \hyperlink{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}{m\_bias\_gradient} = \textcolor{keyword}{new} \hyperlink{base_8hpp_aba08580d21767b53d0737e115d738dbe}{StarMat}(grid);
47 \}
\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classlbann_1_1fully__connected__layer_a9af60f901a84d5604badf078ecbae082_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a4f26e5923a82f11c2c7658a27903f83b}\label{classlbann_1_1fully__connected__layer_a4f26e5923a82f11c2c7658a27903f83b}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!setup\+\_\+matrices@{setup\+\_\+matrices}}
\index{setup\+\_\+matrices@{setup\+\_\+matrices}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{setup\+\_\+matrices()}{setup\_matrices()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
void \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::setup\+\_\+matrices (\begin{DoxyParamCaption}\item[{const \hyperlink{base_8hpp_a9951bb1719d534e0401b1f06cad19eab}{El\+::\+Grid} \&}]{grid }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}

Instantiate distributed matrices. If the layer has already been setup, this function should destroy all matrices and reinstantiate them. However, it is not guaranteed that derived classes will obey this behavior. 

Reimplemented from \hyperlink{classlbann_1_1Layer_a57bbe21131dc00ab5cf9ea5e3656808e}{lbann\+::\+Layer}.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=349pt]{classlbann_1_1fully__connected__layer_a4f26e5923a82f11c2c7658a27903f83b_icgraph}
\end{center}
\end{figure}


\subsection{Member Data Documentation}
\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}\label{classlbann_1_1fully__connected__layer_a6510917c573378f40789a1d16db22b4e}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!m\+\_\+bias\+\_\+gradient@{m\+\_\+bias\+\_\+gradient}}
\index{m\+\_\+bias\+\_\+gradient@{m\+\_\+bias\+\_\+gradient}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+bias\+\_\+gradient}{m\_bias\_gradient}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
\hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat}$\ast$ \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::m\+\_\+bias\+\_\+gradient\hspace{0.3cm}{\ttfamily [private]}}

Bias weights gradient. This is this layer\textquotesingle{}s contribution to the objective function gradient w.\+r.\+t. the bias weights. 

Definition at line 66 of file fully\+\_\+connected.\+hpp.

\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}\label{classlbann_1_1fully__connected__layer_ae02eaffd5528bf572883f8b06d1b40c0}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!m\+\_\+bias\+\_\+scaling\+\_\+factor@{m\+\_\+bias\+\_\+scaling\+\_\+factor}}
\index{m\+\_\+bias\+\_\+scaling\+\_\+factor@{m\+\_\+bias\+\_\+scaling\+\_\+factor}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+bias\+\_\+scaling\+\_\+factor}{m\_bias\_scaling\_factor}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
Data\+Type \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::m\+\_\+bias\+\_\+scaling\+\_\+factor\hspace{0.3cm}{\ttfamily [private]}}

Scaling factor for bias term. If the scaling factor is zero, bias is not applied. 

Definition at line 55 of file fully\+\_\+connected.\+hpp.

\mbox{\Hypertarget{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}\label{classlbann_1_1fully__connected__layer_ab80f9cb94662ce4d90aa6d8b5cfa0803}} 
\index{lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}!m\+\_\+linearity\+\_\+gradient@{m\+\_\+linearity\+\_\+gradient}}
\index{m\+\_\+linearity\+\_\+gradient@{m\+\_\+linearity\+\_\+gradient}!lbann\+::fully\+\_\+connected\+\_\+layer@{lbann\+::fully\+\_\+connected\+\_\+layer}}
\subsubsection{\texorpdfstring{m\+\_\+linearity\+\_\+gradient}{m\_linearity\_gradient}}
{\footnotesize\ttfamily template$<$data\+\_\+layout T\+\_\+layout$>$ \\
\hyperlink{base_8hpp_a9a697a504ae84010e7439ffec862b470}{Abs\+Dist\+Mat}$\ast$ \hyperlink{classlbann_1_1fully__connected__layer}{lbann\+::fully\+\_\+connected\+\_\+layer}$<$ T\+\_\+layout $>$\+::m\+\_\+linearity\+\_\+gradient\hspace{0.3cm}{\ttfamily [private]}}

Linearity gradient. This is this layer\textquotesingle{}s contribution to the objective function gradient w.\+r.\+t. the linearity weights (i.\+e. its matrix weights). 

Definition at line 61 of file fully\+\_\+connected.\+hpp.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/\+Users/mckinney27/doxy-\/testbed/lbann/include/lbann/layers/learning/\hyperlink{fully__connected_8hpp}{fully\+\_\+connected.\+hpp}\end{DoxyCompactItemize}
