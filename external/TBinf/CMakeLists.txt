if (LBANN_HAS_PROTOBUF)

  protobuf_generate_cpp(PROTO_SRCS PROTO_HDRS
    summary.proto
    event.proto
    )

  set_full_path(TB_SRCS TBinf.cpp)
  set_full_path(TB_HDRS TBinf.hpp tbext.hpp)

  add_library(TBinf ${TB_SRCS} ${TB_HDRS} ${PROTO_SRCS} ${PROTO_HDRS})
  target_link_libraries(TBinf PUBLIC protobuf::libprotobuf)
  target_include_directories(TBinf SYSTEM PUBLIC
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
    $<BUILD_INTERFACE:${CMAKE_CURRENT_BINARY_DIR}>
    $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/lbann>)

  # Install the library
  install(TARGETS TBinf
    EXPORT LBANNTargets
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
    ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
    INCLUDES DESTINATION ${CMAKE_INSTALL_INCLUDEDIR/lbann}
    )

  # Install the newly created headers
  install(FILES ${PROTO_HDRS} ${TB_HDRS}
    DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/lbann)

  set(LBANN_HAS_TBINF TRUE PARENT_SCOPE)

endif (LBANN_HAS_PROTOBUF)
