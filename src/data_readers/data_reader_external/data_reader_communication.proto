syntax = "proto3";
/* only including functions used in data_reader_numpy */

message Request {
  oneof request {
    InitRequest           init_request            = 1;
    TypeRequest           type_request            = 2;
    ConfigRequest         config_request          = 3;
    FetchDatumRequest     fetch_datum_request     = 4;
    FetchLabelRequest     fetch_label_request     = 5;
    FetchResponseRequest  fetch_response_request  = 6;
  }
}

message Response {
  oneof response {
    InitResponse          init_response           = 1;
    TypeResponse          type_response           = 2;
    ConfigResponse        config_response         = 3;
    FetchDatumResponse    fetch_datum_response    = 4;
    FetchLabelResponse    fetch_label_response    = 5;
    FetchResponseResponse fetch_response_response = 6;
  }
}

/* initialize external reader */
message InitRequest {
  string filename = 1;
}

message InitResponse {
  int32 num_samples = 1;
  int32 num_features = 2;
  int32 num_labels = 3;
  bool has_labels = 4;
  bool has_responses = 5;
}

/* get the type of the external reader */
message TypeRequest {}

message TypeResponse {
  string type = 1;
}

/* get metadata */
message ConfigRequest {}

message ConfigResponse {
  int32 label_count = 1;
  int32 data_size = 2;
  int32 label_size = 3;
  repeated int32 dims = 4;
}

/* fetch datum */
message FetchDatumRequest {
  int32 data_id = 1;
  int32 mb_idx = 2;
  int32 tid = 3;
}

message FetchDatumResponse {
  repeated double datum = 1; 
}

/* fetch label */
message FetchLabelRequest {
  int32 data_id = 1;
  int32 mb_idx = 2;
  int32 tid = 3;
}

message FetchLabelResponse {
  repeated double label = 1; 
}

/* fetch response */
message FetchResponseRequest {
  int32 data_id = 1;
  int32 mb_idx = 2;
  int32 tid = 3;
}

message FetchResponseResponse {
  repeated double response = 1; 
}

/* the following functions are not used in data_reader_numpy
message SetFileDir

message GetFileDir

message SetDataFilename

message GetDataFilename

message SetLabelFilename

message GetLabelFilename

message SetShuffle

message IsShuffled

message SetShuffledIndices

message GetShuffledIndices

message SetFirstN

message SetAbsoluteSampleCount

message GetAbsoluteSampleCount

message SetUsePercent

message GetUsePercent

message SetValidationPercent

message GetValidationPercent

message SetRole

message SwapRole

message GetRole

message Setup

message FetchData

message FetchLabels

message FetchResponses

message IsDataReaderDone

message Update

message GetNumResponses

message GetLinearizedResponseSize

message PositionValid

message AtNewEpoch

message SetMiniBatchSize

message GetMiniBatchSize

message GetLoadedMiniBatchSize

message GetCurrentMiniBatchSize

message GetCurrentGlobalMiniBatchSize

message GetCurrentWorldMasterMiniBatchAdjustment

message GetMiniBatchMax

message SetGlobalMiniBatchSize

message GetGlobalMiniBatchSize

message SetStrideToNextMiniBatch

message GetStrideToNextMiniBatch

message SetSampleStride

message GetSampleStride

message SetIterationStride

message GetIterationStride

message SetBaseOffset

message GetBaseOffset

message SetModelOffset

message GetModelOffset

message SetLastMiniBatchSize

message GetLastMiniBatchSize

message SetGlobalLastMiniBatchSize

message GetGlobalLastMiniBatchSize

message SetWorldMasterMiniBatchAdjustment

message GetWorldMasterMiniBatchAdjustment

message SetStrideToLastMiniBatch

message GetStrideToLastMiniBatch

message SetNumParallelReaders

message GetNumParallelReaders

message SetResetMiniBatchIndex

message GetResetMiniBatchIndex

message GetLoadedMiniBatchIndex

message GetCurrentMiniBatchIndex

message SetInitialPosition

message GetPosition

message GetNextPosition

message GetIndices

message GetNumData

message GetNumUnusedData

message GetUnusedData

message GetIndicesFetchedPerMB

message SetNumIterationsPerEpoch

message GetNumIterationsPerEpoch

message GetCurrentStepInEpoch

message SetRank

message GetRank

message SelectSubsetOfData

message UseUnusedIndexSet

message SaveToCheckpointShared

message LoadFromCheckpointShared

message GetDataStore

message SetupDataStore

message SetSaveMiniBatchEntries

message GetMiniBatchIndices

message PreprocessDataSource

message PostprocessDataSource

message ShuffleIndices

*/